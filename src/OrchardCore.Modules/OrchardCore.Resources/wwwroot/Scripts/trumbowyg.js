/*
** NOTE: This file is generated by Gulp and should not be edited directly!
** Any changes made directly to this file will be overwritten next time its asset group is processed by Gulp.
*/

/**
 * Trumbowyg v2.10.0 - A lightweight WYSIWYG editor
 * Trumbowyg core file
 * ------------------------
 * @link http://alex-d.github.io/Trumbowyg
 * @license MIT
 * @author Alexandre Demode (Alex-D)
 *         Twitter : @AlexandreDemode
 *         Website : alex-d.fr
 */

jQuery.trumbowyg = {
    langs: {
        en: {
            viewHTML: 'View HTML',

            undo: 'Undo',
            redo: 'Redo',

            formatting: 'Formatting',
            p: 'Paragraph',
            blockquote: 'Quote',
            code: 'Code',
            header: 'Header',

            bold: 'Bold',
            italic: 'Italic',
            strikethrough: 'Stroke',
            underline: 'Underline',

            strong: 'Strong',
            em: 'Emphasis',
            del: 'Deleted',

            superscript: 'Superscript',
            subscript: 'Subscript',

            unorderedList: 'Unordered list',
            orderedList: 'Ordered list',

            insertImage: 'Insert Image',
            link: 'Link',
            createLink: 'Insert link',
            unlink: 'Remove link',

            justifyLeft: 'Align Left',
            justifyCenter: 'Align Center',
            justifyRight: 'Align Right',
            justifyFull: 'Align Justify',

            horizontalRule: 'Insert horizontal rule',
            removeformat: 'Remove format',

            fullscreen: 'Fullscreen',

            close: 'Close',

            submit: 'Confirm',
            reset: 'Cancel',

            required: 'Required',
            description: 'Description',
            title: 'Title',
            text: 'Text',
            target: 'Target',
            width: 'Width'
        }
    },

    // Plugins
    plugins: {},

    // SVG Path globally
    svgPath: null,

    hideButtonTexts: null
};

// Makes default options read-only
Object.defineProperty(jQuery.trumbowyg, 'defaultOptions', {
    value: {
        lang: 'en',

        fixedBtnPane: false,
        fixedFullWidth: false,
        autogrow: false,
        autogrowOnEnter: false,
        imageWidthModalEdit: false,

        prefix: 'trumbowyg-',

        semantic: true,
        resetCss: false,
        removeformatPasted: false,
        tagsToRemove: [],
        btns: [
            ['viewHTML'],
            ['undo', 'redo'], // Only supported in Blink browsers
            ['formatting'],
            ['strong', 'em', 'del'],
            ['foreColor', 'backColor'],
            ['superscript', 'subscript'],
            ['link'],
            ['image'],
            ['align'],
            ['unorderedList', 'orderedList'],
            ['horizontalRule'],
            ['removeformat'],
            ['fullscreen']
        ],
        // For custom button definitions        
        btnsDef: {
            align: {
                dropdown: ['justifyLeft', 'justifyCenter', 'justifyRight', 'justifyFull'],
                ico: 'justifyLeft'
            },
            image: {
                dropdown: ['insertImage', 'base64', 'noembed'],
                ico: 'insertImage'
            }
        },

        inlineElementsSelector: 'a,abbr,acronym,b,caption,cite,code,col,dfn,dir,dt,dd,em,font,hr,i,kbd,li,q,span,strikeout,strong,sub,sup,u',

        pasteHandlers: [],

        // imgDblClickHandler: default is defined in constructor

        plugins: {},
        urlProtocol: false,
        minimalLinks: false
    },
        writable: false,
        enumerable: true,
        configurable: false
});

(function (navigator, window, document, $) {
    'use strict';

    var CONFIRM_EVENT = 'tbwconfirm',
        CANCEL_EVENT = 'tbwcancel';

    $.fn.trumbowyg = function (options, params) {
        var trumbowygDataName = 'trumbowyg';
        if (options === Object(options) || !options) {
            return this.each(function () {
                if (!$(this).data(trumbowygDataName)) {
                    $(this).data(trumbowygDataName, new Trumbowyg(this, options));
                }
            });
        }
        if (this.length === 1) {
            try {
                var t = $(this).data(trumbowygDataName);
                switch (options) {
                    // Exec command
                    case 'execCmd':
                        return t.execCmd(params.cmd, params.param, params.forceCss);

                    // Modal box
                    case 'openModal':
                        return t.openModal(params.title, params.content);
                    case 'closeModal':
                        return t.closeModal();
                    case 'openModalInsert':
                        return t.openModalInsert(params.title, params.fields, params.callback);

                    // Range
                    case 'saveRange':
                        return t.saveRange();
                    case 'getRange':
                        return t.range;
                    case 'getRangeText':
                        return t.getRangeText();
                    case 'restoreRange':
                        return t.restoreRange();

                    // Enable/disable
                    case 'enable':
                        return t.setDisabled(false);
                    case 'disable':
                        return t.setDisabled(true);

                    // Toggle
                    case 'toggle':
                        return t.toggle();

                    // Destroy
                    case 'destroy':
                        return t.destroy();

                    // Empty
                    case 'empty':
                        return t.empty();

                    // HTML
                    case 'html':
                        return t.html(params);
                }
            } catch (c) {
            }
        }

        return false;
    };

    // @param: editorElem is the DOM element
    var Trumbowyg = function (editorElem, options) {
        var t = this,
            trumbowygIconsId = 'trumbowyg-icons',
            $trumbowyg = $.trumbowyg;

        // Get the document of the element. It use to makes the plugin
        // compatible on iframes.
        t.doc = editorElem.ownerDocument || document;

        // jQuery object of the editor
        t.$ta = $(editorElem); // $ta : Textarea
        t.$c = $(editorElem); // $c : creator

        options = options || {};

        // Localization management
        if (options.lang != null || $trumbowyg.langs[options.lang] != null) {
            t.lang = $.extend(true, {}, $trumbowyg.langs.en, $trumbowyg.langs[options.lang]);
        } else {
            t.lang = $trumbowyg.langs.en;
        }

        t.hideButtonTexts = $trumbowyg.hideButtonTexts != null ? $trumbowyg.hideButtonTexts : options.hideButtonTexts;

        // SVG path
        var svgPathOption = $trumbowyg.svgPath != null ? $trumbowyg.svgPath : options.svgPath;
        t.hasSvg = svgPathOption !== false;
        t.svgPath = !!t.doc.querySelector('base') ? window.location.href.split('#')[0] : '';
        if ($('#' + trumbowygIconsId, t.doc).length === 0 && svgPathOption !== false) {
            if (svgPathOption == null) {
                // Hack to get svgPathOption based on trumbowyg.js path
                var scriptElements = document.getElementsByTagName('script');
                for (var i = 0; i < scriptElements.length; i += 1) {
                    var source = scriptElements[i].src;
                    var matches = source.match('trumbowyg(\.min)?\.js');
                    if (matches != null) {
                        svgPathOption = source.substring(0, source.indexOf(matches[0])) + 'ui/icons.svg';
                    }
                }
                if (svgPathOption == null) {
                    console.warn('You must define svgPath: https://goo.gl/CfTY9U'); // jshint ignore:line
                }
            }

            var div = t.doc.createElement('div');
            div.id = trumbowygIconsId;
            t.doc.body.insertBefore(div, t.doc.body.childNodes[0]);
            $.ajax({
                async: true,
                type: 'GET',
                contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
                dataType: 'xml',
                crossDomain: true,
                url: svgPathOption,
                data: null,
                beforeSend: null,
                complete: null,
                success: function (data) {
                    div.innerHTML = new XMLSerializer().serializeToString(data.documentElement);
                }
            });
        }


        /**
         * When the button is associated to a empty object
         * fn and title attributs are defined from the button key value
         *
         * For example
         *      foo: {}
         * is equivalent to :
         *      foo: {
         *          fn: 'foo',
         *          title: this.lang.foo
         *      }
         */
        var h = t.lang.header, // Header translation
            isBlinkFunction = function () {
                return (window.chrome || (window.Intl && Intl.v8BreakIterator)) && 'CSS' in window;
            };
        t.btnsDef = {
            viewHTML: {
                fn: 'toggle'
            },

            undo: {
                isSupported: isBlinkFunction,
                key: 'Z'
            },
            redo: {
                isSupported: isBlinkFunction,
                key: 'Y'
            },

            p: {
                fn: 'formatBlock'
            },
            blockquote: {
                fn: 'formatBlock'
            },
            h1: {
                fn: 'formatBlock',
                title: h + ' 1'
            },
            h2: {
                fn: 'formatBlock',
                title: h + ' 2'
            },
            h3: {
                fn: 'formatBlock',
                title: h + ' 3'
            },
            h4: {
                fn: 'formatBlock',
                title: h + ' 4'
            },
            subscript: {
                tag: 'sub'
            },
            superscript: {
                tag: 'sup'
            },

            bold: {
                key: 'B',
                tag: 'b'
            },
            italic: {
                key: 'I',
                tag: 'i'
            },
            underline: {
                tag: 'u'
            },
            strikethrough: {
                tag: 'strike'
            },

            strong: {
                fn: 'bold',
                key: 'B'
            },
            em: {
                fn: 'italic',
                key: 'I'
            },
            del: {
                fn: 'strikethrough'
            },

            createLink: {
                key: 'K',
                tag: 'a'
            },
            unlink: {},

            insertImage: {},

            justifyLeft: {
                tag: 'left',
                forceCss: true
            },
            justifyCenter: {
                tag: 'center',
                forceCss: true
            },
            justifyRight: {
                tag: 'right',
                forceCss: true
            },
            justifyFull: {
                tag: 'justify',
                forceCss: true
            },

            unorderedList: {
                fn: 'insertUnorderedList',
                tag: 'ul'
            },
            orderedList: {
                fn: 'insertOrderedList',
                tag: 'ol'
            },

            horizontalRule: {
                fn: 'insertHorizontalRule'
            },

            removeformat: {},

            fullscreen: {
                class: 'trumbowyg-not-disable'
            },
            close: {
                fn: 'destroy',
                class: 'trumbowyg-not-disable'
            },

            // Dropdowns
            formatting: {
                dropdown: ['p', 'blockquote', 'h1', 'h2', 'h3', 'h4'],
                ico: 'p'
            },
            link: {
                dropdown: ['createLink', 'unlink']
            }
        };

        // Defaults Options
        t.o = $.extend(true, {}, $trumbowyg.defaultOptions, options);
        if (!t.o.hasOwnProperty('imgDblClickHandler')) {
            t.o.imgDblClickHandler = t.getDefaultImgDblClickHandler();
        }

        t.urlPrefix = t.setupUrlPrefix();

        t.disabled = t.o.disabled || (editorElem.nodeName === 'TEXTAREA' && editorElem.disabled);

        if (options.btns) {
            t.o.btns = options.btns;
        } else if (!t.o.semantic) {
            t.o.btns[3] = ['bold', 'italic', 'underline', 'strikethrough'];
        }

        $.each(t.o.btnsDef, function (btnName, btnDef) {
            t.addBtnDef(btnName, btnDef);
        });

        // put this here in the event it would be merged in with options
        t.eventNamespace = 'trumbowyg-event';

        // Keyboard shortcuts are load in this array
        t.keys = [];

        // Tag to button dynamically hydrated
        t.tagToButton = {};
        t.tagHandlers = [];

        // Admit multiple paste handlers
        t.pasteHandlers = [].concat(t.o.pasteHandlers);

        // Check if browser is IE
        t.isIE = (navigator.userAgent.indexOf('MSIE') !== -1 || navigator.appVersion.indexOf('Trident/') !== -1);

        t.init();
    };

    Trumbowyg.prototype = {
        DEFAULT_SEMANTIC_MAP: {
            'b': 'strong',
            'i': 'em',
            's': 'del',
            'strike': 'del',
            'div': 'p'
        },

        init: function () {
            var t = this;
            t.height = t.$ta.height();

            t.initPlugins();

            try {
                // Disable image resize, try-catch for old IE
                t.doc.execCommand('enableObjectResizing', false, false);
                t.doc.execCommand('defaultParagraphSeparator', false, 'p');
            } catch (e) {
            }

            t.buildEditor();
            t.buildBtnPane();

            t.fixedBtnPaneEvents();

            t.buildOverlay();

            setTimeout(function () {
                if (t.disabled) {
                    t.setDisabled(true);
                }
                t.$c.trigger('tbwinit');
            });
        },

        addBtnDef: function (btnName, btnDef) {
            this.btnsDef[btnName] = btnDef;
        },

        setupUrlPrefix: function () {
            var protocol = this.o.urlProtocol;
            if (!protocol) {
                return;
            }

            if (typeof (protocol) !== 'string') {
                return 'https://';
            }
            return /:\/\/$/.test(protocol) ? protocol : protocol + '://';
        },

        buildEditor: function () {
            var t = this,
                prefix = t.o.prefix,
                html = '';

            t.$box = $('<div/>', {
                class: prefix + 'box ' + prefix + 'editor-visible ' + prefix + t.o.lang + ' trumbowyg'
            });

            // $ta = Textarea
            // $ed = Editor
            t.isTextarea = t.$ta.is('textarea');
            if (t.isTextarea) {
                html = t.$ta.val();
                t.$ed = $('<div/>');
                t.$box
                    .insertAfter(t.$ta)
                    .append(t.$ed, t.$ta);
            } else {
                t.$ed = t.$ta;
                html = t.$ed.html();

                t.$ta = $('<textarea/>', {
                    name: t.$ta.attr('id'),
                    height: t.height
                }).val(html);

                t.$box
                    .insertAfter(t.$ed)
                    .append(t.$ta, t.$ed);
                t.syncCode();
            }

            t.$ta
                .addClass(prefix + 'textarea')
                .attr('tabindex', -1)
                ;

            t.$ed
                .addClass(prefix + 'editor')
                .attr({
                    contenteditable: true,
                    dir: t.lang._dir || 'ltr'
                })
                .html(html)
                ;

            if (t.o.tabindex) {
                t.$ed.attr('tabindex', t.o.tabindex);
            }

            if (t.$c.is('[placeholder]')) {
                t.$ed.attr('placeholder', t.$c.attr('placeholder'));
            }

            if (t.$c.is('[spellcheck]')) {
                t.$ed.attr('spellcheck', t.$c.attr('spellcheck'));
            }

            if (t.o.resetCss) {
                t.$ed.addClass(prefix + 'reset-css');
            }

            if (!t.o.autogrow) {
                t.$ta.add(t.$ed).css({
                    height: t.height
                });
            }

            t.semanticCode();

            if (t.o.autogrowOnEnter) {
                t.$ed.addClass(prefix + 'autogrow-on-enter');
            }

            var ctrl = false,
                composition = false,
                debounceButtonPaneStatus,
                updateEventName = 'keyup';

            t.$ed
                .on('dblclick', 'img', t.o.imgDblClickHandler)
                .on('keydown', function (e) {
                    if ((e.ctrlKey || e.metaKey) && !e.altKey) {
                        ctrl = true;
                        var key = t.keys[String.fromCharCode(e.which).toUpperCase()];

                        try {
                            t.execCmd(key.fn, key.param);
                            return false;
                        } catch (c) {
                        }
                    }
                })
                .on('compositionstart compositionupdate', function () {
                    composition = true;
                })
                .on(updateEventName + ' compositionend', function (e) {
                    if (e.type === 'compositionend') {
                        composition = false;
                    } else if (composition) {
                        return;
                    }

                    var keyCode = e.which;

                    if (keyCode >= 37 && keyCode <= 40) {
                        return;
                    }

                    if ((e.ctrlKey || e.metaKey) && (keyCode === 89 || keyCode === 90)) {
                        t.$c.trigger('tbwchange');
                    } else if (!ctrl && keyCode !== 17) {
                        var compositionEndIE = t.isIE ? e.type === 'compositionend' : true;
                        t.semanticCode(false, compositionEndIE && keyCode === 13);
                        t.$c.trigger('tbwchange');
                    } else if (typeof e.which === 'undefined') {
                        t.semanticCode(false, false, true);
                    }

                    setTimeout(function () {
                        ctrl = false;
                    }, 50);
                })
                .on('mouseup keydown keyup', function (e) {
                    if ((!e.ctrlKey && !e.metaKey) || e.altKey) {
                        setTimeout(function () { // "hold on" to the ctrl key for 50ms
                            ctrl = false;
                        }, 50);
                    }
                    clearTimeout(debounceButtonPaneStatus);
                    debounceButtonPaneStatus = setTimeout(function () {
                        t.updateButtonPaneStatus();
                    }, 50);
                })
                .on('focus blur', function (e) {
                    t.$c.trigger('tbw' + e.type);
                    if (e.type === 'blur') {
                        $('.' + prefix + 'active-button', t.$btnPane).removeClass(prefix + 'active-button ' + prefix + 'active');
                    }
                    if (t.o.autogrowOnEnter) {
                        if (t.autogrowOnEnterDontClose) {
                            return;
                        }
                        if (e.type === 'focus') {
                            t.autogrowOnEnterWasFocused = true;
                            t.autogrowEditorOnEnter();
                        }
                        else if (!t.o.autogrow) {
                            t.$ed.css({ height: t.$ed.css('min-height') });
                            t.$c.trigger('tbwresize');
                        }
                    }
                })
                .on('cut', function () {
                    setTimeout(function () {
                        t.semanticCode(false, true);
                        t.$c.trigger('tbwchange');
                    }, 0);
                })
                .on('paste', function (e) {
                    if (t.o.removeformatPasted) {
                        e.preventDefault();

                        if (window.getSelection && window.getSelection().deleteFromDocument) {
                            window.getSelection().deleteFromDocument();
                        }

                        try {
                            // IE
                            var text = window.clipboardData.getData('Text');

                            try {
                                // <= IE10
                                t.doc.selection.createRange().pasteHTML(text);
                            } catch (c) {
                                // IE 11
                                t.doc.getSelection().getRangeAt(0).insertNode(t.doc.createTextNode(text));
                            }
                            t.$c.trigger('tbwchange', e);
                        } catch (d) {
                            // Not IE
                            t.execCmd('insertText', (e.originalEvent || e).clipboardData.getData('text/plain'));
                        }
                    }

                    // Call pasteHandlers
                    $.each(t.pasteHandlers, function (i, pasteHandler) {
                        pasteHandler(e);
                    });

                    setTimeout(function () {
                        t.semanticCode(false, true);
                        t.$c.trigger('tbwpaste', e);
                    }, 0);
                });

            t.$ta
                .on('keyup', function () {
                    t.$c.trigger('tbwchange');
                })
                .on('paste', function () {
                    setTimeout(function () {
                        t.$c.trigger('tbwchange');
                    }, 0);
                });

            t.$box.on('keydown', function (e) {
                if (e.which === 27 && $('.' + prefix + 'modal-box', t.$box).length === 1) {
                    t.closeModal();
                    return false;
                }
            });
        },

        //autogrow when entering logic
        autogrowEditorOnEnter: function () {
            var t = this;
            t.$ed.removeClass('autogrow-on-enter');
            var oldHeight = t.$ed[0].clientHeight;
            t.$ed.height('auto');
            var totalHeight = t.$ed[0].scrollHeight;
            t.$ed.addClass('autogrow-on-enter');
            if (oldHeight !== totalHeight) {
                t.$ed.height(oldHeight);
                setTimeout(function () {
                    t.$ed.css({ height: totalHeight });
                    t.$c.trigger('tbwresize');
                }, 0);
            }
        },


        // Build button pane, use o.btns option
        buildBtnPane: function () {
            var t = this,
                prefix = t.o.prefix;

            var $btnPane = t.$btnPane = $('<div/>', {
                class: prefix + 'button-pane'
            });

            $.each(t.o.btns, function (i, btnGrp) {
                if (!$.isArray(btnGrp)) {
                    btnGrp = [btnGrp];
                }

                var $btnGroup = $('<div/>', {
                    class: prefix + 'button-group ' + ((btnGrp.indexOf('fullscreen') >= 0) ? prefix + 'right' : '')
                });
                $.each(btnGrp, function (i, btn) {
                    try { // Prevent buildBtn error
                        if (t.isSupportedBtn(btn)) { // It's a supported button
                            $btnGroup.append(t.buildBtn(btn));
                        }
                    } catch (c) {
                    }
                });

                if ($btnGroup.html().trim().length > 0) {
                    $btnPane.append($btnGroup);
                }
            });

            t.$box.prepend($btnPane);
        },


        // Build a button and his action
        buildBtn: function (btnName) { // btnName is name of the button
            var t = this,
                prefix = t.o.prefix,
                btn = t.btnsDef[btnName],
                isDropdown = btn.dropdown,
                hasIcon = btn.hasIcon != null ? btn.hasIcon : true,
                textDef = t.lang[btnName] || btnName,

                $btn = $('<button/>', {
                    type: 'button',
                    class: prefix + btnName + '-button ' + (btn.class || '') + (!hasIcon ? ' ' + prefix + 'textual-button' : ''),
                    html: t.hasSvg && hasIcon ?
                        '<svg><use xlink:href="' + t.svgPath + '#' + prefix + (btn.ico || btnName).replace(/([A-Z]+)/g, '-$1').toLowerCase() + '"/></svg>' :
                        t.hideButtonTexts ? '' : (btn.text || btn.title || t.lang[btnName] || btnName),
                    title: (btn.title || btn.text || textDef) + ((btn.key) ? ' (Ctrl + ' + btn.key + ')' : ''),
                    tabindex: -1,
                    mousedown: function () {
                        if (!isDropdown || $('.' + btnName + '-' + prefix + 'dropdown', t.$box).is(':hidden')) {
                            $('body', t.doc).trigger('mousedown');
                        }

                        if ((t.$btnPane.hasClass(prefix + 'disable') || t.$box.hasClass(prefix + 'disabled')) &&
                            !$(this).hasClass(prefix + 'active') &&
                            !$(this).hasClass(prefix + 'not-disable')) {
                            return false;
                        }

                        t.execCmd((isDropdown ? 'dropdown' : false) || btn.fn || btnName, btn.param || btnName, btn.forceCss);

                        return false;
                    }
                });

            if (isDropdown) {
                $btn.addClass(prefix + 'open-dropdown');
                var dropdownPrefix = prefix + 'dropdown',
                    dropdownOptions = { // the dropdown
                        class: dropdownPrefix + '-' + btnName + ' ' + dropdownPrefix + ' ' + prefix + 'fixed-top'
                    };
                dropdownOptions['data-' + dropdownPrefix] = btnName;
                var $dropdown = $('<div/>', dropdownOptions);
                $.each(isDropdown, function (i, def) {
                    if (t.btnsDef[def] && t.isSupportedBtn(def)) {
                        $dropdown.append(t.buildSubBtn(def));
                    }
                });
                t.$box.append($dropdown.hide());
            } else if (btn.key) {
                t.keys[btn.key] = {
                    fn: btn.fn || btnName,
                    param: btn.param || btnName
                };
            }

            if (!isDropdown) {
                t.tagToButton[(btn.tag || btnName).toLowerCase()] = btnName;
            }

            return $btn;
        },
        // Build a button for dropdown menu
        // @param n : name of the subbutton
        buildSubBtn: function (btnName) {
            var t = this,
                prefix = t.o.prefix,
                btn = t.btnsDef[btnName],
                hasIcon = btn.hasIcon != null ? btn.hasIcon : true;

            if (btn.key) {
                t.keys[btn.key] = {
                    fn: btn.fn || btnName,
                    param: btn.param || btnName
                };
            }

            t.tagToButton[(btn.tag || btnName).toLowerCase()] = btnName;

            return $('<button/>', {
                type: 'button',
                class: prefix + btnName + '-dropdown-button' + (btn.ico ? ' ' + prefix + btn.ico + '-button' : ''),
                html: t.hasSvg && hasIcon ? '<svg><use xlink:href="' + t.svgPath + '#' + prefix + (btn.ico || btnName).replace(/([A-Z]+)/g, '-$1').toLowerCase() + '"/></svg>' + (btn.text || btn.title || t.lang[btnName] || btnName) : (btn.text || btn.title || t.lang[btnName] || btnName),
                title: ((btn.key) ? ' (Ctrl + ' + btn.key + ')' : null),
                style: btn.style || null,
                mousedown: function () {
                    $('body', t.doc).trigger('mousedown');

                    t.execCmd(btn.fn || btnName, btn.param || btnName, btn.forceCss);

                    return false;
                }
            });
        },
        // Check if button is supported
        isSupportedBtn: function (b) {
            try {
                return this.btnsDef[b].isSupported();
            } catch (c) {
            }
            return true;
        },

        // Build overlay for modal box
        buildOverlay: function () {
            var t = this;
            t.$overlay = $('<div/>', {
                class: t.o.prefix + 'overlay'
            }).appendTo(t.$box);
            return t.$overlay;
        },
        showOverlay: function () {
            var t = this;
            $(window).trigger('scroll');
            t.$overlay.fadeIn(200);
            t.$box.addClass(t.o.prefix + 'box-blur');
        },
        hideOverlay: function () {
            var t = this;
            t.$overlay.fadeOut(50);
            t.$box.removeClass(t.o.prefix + 'box-blur');
        },

        // Management of fixed button pane
        fixedBtnPaneEvents: function () {
            var t = this,
                fixedFullWidth = t.o.fixedFullWidth,
                $box = t.$box;

            if (!t.o.fixedBtnPane) {
                return;
            }

            t.isFixed = false;

            $(window)
                .on('scroll.' + t.eventNamespace + ' resize.' + t.eventNamespace, function () {
                    if (!$box) {
                        return;
                    }

                    t.syncCode();

                    var scrollTop = $(window).scrollTop(),
                        offset = $box.offset().top + 1,
                        bp = t.$btnPane,
                        oh = bp.outerHeight() - 2;

                    if ((scrollTop - offset > 0) && ((scrollTop - offset - t.height) < 0)) {
                        if (!t.isFixed) {
                            t.isFixed = true;
                            bp.css({
                                position: 'fixed',
                                top: 0,
                                left: fixedFullWidth ? '0' : 'auto',
                                zIndex: 7
                            });
                            $([t.$ta, t.$ed]).css({ marginTop: bp.height() });
                        }
                        bp.css({
                            width: fixedFullWidth ? '100%' : (($box.width() - 1) + 'px')
                        });

                        $('.' + t.o.prefix + 'fixed-top', $box).css({
                            position: fixedFullWidth ? 'fixed' : 'absolute',
                            top: fixedFullWidth ? oh : oh + (scrollTop - offset) + 'px',
                            zIndex: 15
                        });
                    } else if (t.isFixed) {
                        t.isFixed = false;
                        bp.removeAttr('style');
                        $([t.$ta, t.$ed]).css({ marginTop: 0 });
                        $('.' + t.o.prefix + 'fixed-top', $box).css({
                            position: 'absolute',
                            top: oh
                        });
                    }
                });
        },

        // Disable editor
        setDisabled: function (disable) {
            var t = this,
                prefix = t.o.prefix;

            t.disabled = disable;

            if (disable) {
                t.$ta.attr('disabled', true);
            } else {
                t.$ta.removeAttr('disabled');
            }
            t.$box.toggleClass(prefix + 'disabled', disable);
            t.$ed.attr('contenteditable', !disable);
        },

        // Destroy the editor
        destroy: function () {
            var t = this,
                prefix = t.o.prefix;

            if (t.isTextarea) {
                t.$box.after(
                    t.$ta
                        .css({ height: '' })
                        .val(t.html())
                        .removeClass(prefix + 'textarea')
                        .show()
                );
            } else {
                t.$box.after(
                    t.$ed
                        .css({ height: '' })
                        .removeClass(prefix + 'editor')
                        .removeAttr('contenteditable')
                        .removeAttr('dir')
                        .html(t.html())
                        .show()
                );
            }

            t.$ed.off('dblclick', 'img');

            t.destroyPlugins();

            t.$box.remove();
            t.$c.removeData('trumbowyg');
            $('body').removeClass(prefix + 'body-fullscreen');
            t.$c.trigger('tbwclose');
            $(window).off('scroll.' + t.eventNamespace + ' resize.' + t.eventNamespace);
        },


        // Empty the editor
        empty: function () {
            this.$ta.val('');
            this.syncCode(true);
        },


        // Function call when click on viewHTML button
        toggle: function () {
            var t = this,
                prefix = t.o.prefix;

            if (t.o.autogrowOnEnter) {
                t.autogrowOnEnterDontClose = !t.$box.hasClass(prefix + 'editor-hidden');
            }

            t.semanticCode(false, true);

            setTimeout(function () {
                t.doc.activeElement.blur();
                t.$box.toggleClass(prefix + 'editor-hidden ' + prefix + 'editor-visible');
                t.$btnPane.toggleClass(prefix + 'disable');
                $('.' + prefix + 'viewHTML-button', t.$btnPane).toggleClass(prefix + 'active');
                if (t.$box.hasClass(prefix + 'editor-visible')) {
                    t.$ta.attr('tabindex', -1);
                } else {
                    t.$ta.removeAttr('tabindex');
                }

                if (t.o.autogrowOnEnter && !t.autogrowOnEnterDontClose) {
                    t.autogrowEditorOnEnter();
                }
            }, 0);
        },

        // Open dropdown when click on a button which open that
        dropdown: function (name) {
            var t = this,
                d = t.doc,
                prefix = t.o.prefix,
                $dropdown = $('[data-' + prefix + 'dropdown=' + name + ']', t.$box),
                $btn = $('.' + prefix + name + '-button', t.$btnPane),
                show = $dropdown.is(':hidden');

            $('body', d).trigger('mousedown');

            if (show) {
                var o = $btn.offset().left;
                $btn.addClass(prefix + 'active');

                $dropdown.css({
                    position: 'absolute',
                    top: $btn.offset().top - t.$btnPane.offset().top + $btn.outerHeight(),
                    left: (t.o.fixedFullWidth && t.isFixed) ? o + 'px' : (o - t.$btnPane.offset().left) + 'px'
                }).show();

                $(window).trigger('scroll');

                $('body', d).on('mousedown.' + t.eventNamespace, function (e) {
                    if (!$dropdown.is(e.target)) {
                        $('.' + prefix + 'dropdown', t.$box).hide();
                        $('.' + prefix + 'active', t.$btnPane).removeClass(prefix + 'active');
                        $('body', d).off('mousedown.' + t.eventNamespace);
                    }
                });
            }
        },


        // HTML Code management
        html: function (html) {
            var t = this;

            if (html != null) {
                t.$ta.val(html);
                t.syncCode(true);
                t.$c.trigger('tbwchange');
                return t;
            }

            return t.$ta.val();
        },
        syncTextarea: function () {
            var t = this;
            t.$ta.val(t.$ed.text().trim().length > 0 || t.$ed.find('hr,img,embed,iframe,input').length > 0 ? t.$ed.html() : '');
        },
        syncCode: function (force) {
            var t = this;
            if (!force && t.$ed.is(':visible')) {
                t.syncTextarea();
            } else {
                // wrap the content in a div it's easier to get the innerhtml
                var html = $('<div>').html(t.$ta.val());
                //scrub the html before loading into the doc
                var safe = $('<div>').append(html);
                $(t.o.tagsToRemove.join(','), safe).remove();
                t.$ed.html(safe.contents().html());
            }

            if (t.o.autogrow) {
                t.height = t.$ed.height();
                if (t.height !== t.$ta.css('height')) {
                    t.$ta.css({ height: t.height });
                    t.$c.trigger('tbwresize');
                }
            }
            if (t.o.autogrowOnEnter) {
                // t.autogrowEditorOnEnter();
                t.$ed.height('auto');
                var totalheight = t.autogrowOnEnterWasFocused ? t.$ed[0].scrollHeight : t.$ed.css('min-height');
                if (totalheight !== t.$ta.css('height')) {
                    t.$ed.css({ height: totalheight });
                    t.$c.trigger('tbwresize');
                }
            }
        },

        // Analyse and update to semantic code
        // @param force : force to sync code from textarea
        // @param full  : wrap text nodes in <p>
        // @param keepRange  : leave selection range as it is
        semanticCode: function (force, full, keepRange) {
            var t = this;
            t.saveRange();
            t.syncCode(force);

            if (t.o.semantic) {
                t.semanticTag('b');
                t.semanticTag('i');
                t.semanticTag('s');
                t.semanticTag('strike');

                if (full) {
                    var inlineElementsSelector = t.o.inlineElementsSelector,
                        blockElementsSelector = ':not(' + inlineElementsSelector + ')';

                    // Wrap text nodes in span for easier processing
                    t.$ed.contents().filter(function () {
                        return this.nodeType === 3 && this.nodeValue.trim().length > 0;
                    }).wrap('<span data-tbw/>');

                    // Wrap groups of inline elements in paragraphs (recursive)
                    var wrapInlinesInParagraphsFrom = function ($from) {
                        if ($from.length !== 0) {
                            var $finalParagraph = $from.nextUntil(blockElementsSelector).addBack().wrapAll('<p/>').parent(),
                                $nextElement = $finalParagraph.nextAll(inlineElementsSelector).first();
                            $finalParagraph.next('br').remove();
                            wrapInlinesInParagraphsFrom($nextElement);
                        }
                    };
                    wrapInlinesInParagraphsFrom(t.$ed.children(inlineElementsSelector).first());

                    t.semanticTag('div', true);

                    // Unwrap paragraphs content, containing nothing usefull
                    t.$ed.find('p').filter(function () {
                        // Don't remove currently being edited element
                        if (t.range && this === t.range.startContainer) {
                            return false;
                        }
                        return $(this).text().trim().length === 0 && $(this).children().not('br,span').length === 0;
                    }).contents().unwrap();

                    // Get rid of temporial span's
                    $('[data-tbw]', t.$ed).contents().unwrap();

                    // Remove empty <p>
                    t.$ed.find('p:empty').remove();
                }

                if (!keepRange) {
                    t.restoreRange();
                }

                t.syncTextarea();
            }
        },

        semanticTag: function (oldTag, copyAttributes) {
            var newTag;

            if (this.o.semantic != null && typeof this.o.semantic === 'object' && this.o.semantic.hasOwnProperty(oldTag)) {
                newTag = this.o.semantic[oldTag];
            } else if (this.o.semantic === true && this.DEFAULT_SEMANTIC_MAP.hasOwnProperty(oldTag)) {
                newTag = this.DEFAULT_SEMANTIC_MAP[oldTag];
            } else {
                return;
            }

            $(oldTag, this.$ed).each(function () {
                var $oldTag = $(this);
                $oldTag.wrap('<' + newTag + '/>');
                if (copyAttributes) {
                    $.each($oldTag.prop('attributes'), function () {
                        $oldTag.parent().attr(this.name, this.value);
                    });
                }
                $oldTag.contents().unwrap();
            });
        },

        // Function call when user click on "Insert Link"
        createLink: function () {
            var t = this,
                documentSelection = t.doc.getSelection(),
                node = documentSelection.focusNode,
                text = new XMLSerializer().serializeToString(documentSelection.getRangeAt(0).cloneContents()),
                url,
                title,
                target;

            while (['A', 'DIV'].indexOf(node.nodeName) < 0) {
                node = node.parentNode;
            }

            if (node && node.nodeName === 'A') {
                var $a = $(node);
                text = $a.text();
                url = $a.attr('href');
                if (!t.o.minimalLinks) {
                    title = $a.attr('title');
                    target = $a.attr('target');
                }
                var range = t.doc.createRange();
                range.selectNode(node);
                documentSelection.removeAllRanges();
                documentSelection.addRange(range);
            }

            t.saveRange();

            var options = {
                url: {
                    label: 'URL',
                    required: true,
                    value: url
                },
                text: {
                    label: t.lang.text,
                    value: text
                }
            };
            if (!t.o.minimalLinks) {
                Object.assign(options, {
                    title: {
                        label: t.lang.title,
                        value: title
                    },
                    target: {
                        label: t.lang.target,
                        value: target
                    }
                });
            }

            t.openModalInsert(t.lang.createLink, options, function (v) { // v is value
                var url = t.prependUrlPrefix(v.url);
                if (!url.length) {
                    return false;
                }

                var link = $(['<a href="', v.url, '">', v.text || v.url, '</a>'].join(''));

                if (!t.o.minimalLinks) {
                    if (v.title.length > 0) {
                        link.attr('title', v.title);
                    }
                    if (v.target.length > 0) {
                        link.attr('target', v.target);
                    }
                }
                t.range.deleteContents();
                t.range.insertNode(link[0]);
                t.syncCode();
                t.$c.trigger('tbwchange');
                return true;
            });
        },
        prependUrlPrefix: function (url) {
            var t = this;
            if (!t.urlPrefix) {
                return url;
            }

            //const VALID_LINK_PREFIX = /^([a-z][-+.a-z0-9]*:|\/|#)/i;
            //if (VALID_LINK_PREFIX.test(url)) {
            //    return url;
            //}

            //const SIMPLE_EMAIL_REGEX = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            //if (SIMPLE_EMAIL_REGEX.test(url)) {
            //    return 'mailto:' + url;
            //}

            return t.urlPrefix + url;
        },
        unlink: function () {
            var t = this,
                documentSelection = t.doc.getSelection(),
                node = documentSelection.focusNode;

            if (documentSelection.isCollapsed) {
                while (['A', 'DIV'].indexOf(node.nodeName) < 0) {
                    node = node.parentNode;
                }

                if (node && node.nodeName === 'A') {
                    var range = t.doc.createRange();
                    range.selectNode(node);
                    documentSelection.removeAllRanges();
                    documentSelection.addRange(range);
                }
            }
            t.execCmd('unlink', undefined, undefined, true);
        },
        insertImage: function () {
            var t = this;
            t.saveRange();

            var options = {
                url: {
                    label: 'URL',
                    required: true
                },
                alt: {
                    label: t.lang.description,
                    value: t.getRangeText()
                }
            };

            if (t.o.imageWidthModalEdit) {
                options.width = {};
            }

            t.openModalInsert(t.lang.insertImage, options, function (v) { // v are values
                t.execCmd('insertImage', v.url);
                var $img = $('img[src="' + v.url + '"]:not([alt])', t.$box);
                $img.attr('alt', v.alt);

                if (t.o.imageWidthModalEdit) {
                    $img.attr({
                        width: v.width
                    });
                }

                t.syncCode();
                t.$c.trigger('tbwchange');

                return true;
            });
        },
        fullscreen: function () {
            var t = this,
                prefix = t.o.prefix,
                fullscreenCssClass = prefix + 'fullscreen',
                isFullscreen;

            t.$box.toggleClass(fullscreenCssClass);
            isFullscreen = t.$box.hasClass(fullscreenCssClass);
            $('body').toggleClass(prefix + 'body-fullscreen', isFullscreen);
            $(window).trigger('scroll');
            t.$c.trigger('tbw' + (isFullscreen ? 'open' : 'close') + 'fullscreen');
        },


        /*
         * Call method of trumbowyg if exist
         * else try to call anonymous function
         * and finaly native execCommand
         */
        execCmd: function (cmd, param, forceCss, skipTrumbowyg) {
            var t = this;
            skipTrumbowyg = !!skipTrumbowyg || '';

            if (cmd !== 'dropdown') {
                t.$ed.focus();
            }

            try {
                t.doc.execCommand('styleWithCSS', false, forceCss || false);
            } catch (c) {
            }

            try {
                t[cmd + skipTrumbowyg](param);
            } catch (c) {
                try {
                    cmd(param);
                } catch (e2) {
                    if (cmd === 'insertHorizontalRule') {
                        param = undefined;
                    } else if (cmd === 'formatBlock' && t.isIE) {
                        param = '<' + param + '>';
                    }

                    t.doc.execCommand(cmd, false, param);

                    t.syncCode();
                    t.semanticCode(false, true);
                }

                if (cmd !== 'dropdown') {
                    t.updateButtonPaneStatus();
                    t.$c.trigger('tbwchange');
                }
            }
        },


        // Open a modal box
        openModal: function (title, content) {
            var t = this,
                prefix = t.o.prefix;

            // No open a modal box when exist other modal box
            if ($('.' + prefix + 'modal-box', t.$box).length > 0) {
                return false;
            }
            if (t.o.autogrowOnEnter) {
                t.autogrowOnEnterDontClose = true;
            }

            t.saveRange();
            t.showOverlay();

            // Disable all btnPane btns
            t.$btnPane.addClass(prefix + 'disable');

            // Build out of ModalBox, it's the mask for animations
            var $modal = $('<div/>', {
                class: prefix + 'modal ' + prefix + 'fixed-top'
            }).css({
                top: t.$btnPane.height()
            }).appendTo(t.$box);

            // Click on overlay close modal by cancelling them
            t.$overlay.one('click', function () {
                $modal.trigger(CANCEL_EVENT);
                return false;
            });

            // Build the form
            var $form = $('<form/>', {
                action: '',
                html: content
            })
                .on('submit', function () {
                    $modal.trigger(CONFIRM_EVENT);
                    return false;
                })
                .on('reset', function () {
                    $modal.trigger(CANCEL_EVENT);
                    return false;
                })
                .on('submit reset', function () {
                    if (t.o.autogrowOnEnter) {
                        t.autogrowOnEnterDontClose = false;
                    }
                });


            // Build ModalBox and animate to show them
            var $box = $('<div/>', {
                class: prefix + 'modal-box',
                html: $form
            })
                .css({
                    top: '-' + t.$btnPane.outerHeight() + 'px',
                    opacity: 0
                })
                .appendTo($modal)
                .animate({
                    top: 0,
                    opacity: 1
                }, 100);


            // Append title
            $('<span/>', {
                text: title,
                class: prefix + 'modal-title'
            }).prependTo($box);

            $modal.height($box.outerHeight() + 10);


            // Focus in modal box
            $('input:first', $box).focus();


            // Append Confirm and Cancel buttons
            t.buildModalBtn('submit', $box);
            t.buildModalBtn('reset', $box);


            $(window).trigger('scroll');

            return $modal;
        },
        // @param n is name of modal
        buildModalBtn: function (n, $modal) {
            var t = this,
                prefix = t.o.prefix;

            return $('<button/>', {
                class: prefix + 'modal-button ' + prefix + 'modal-' + n,
                type: n,
                text: t.lang[n] || n
            }).appendTo($('form', $modal));
        },
        // close current modal box
        closeModal: function () {
            var t = this,
                prefix = t.o.prefix;

            t.$btnPane.removeClass(prefix + 'disable');
            t.$overlay.off();

            // Find the modal box
            var $modalBox = $('.' + prefix + 'modal-box', t.$box);

            $modalBox.animate({
                top: '-' + $modalBox.height()
            }, 100, function () {
                $modalBox.parent().remove();
                t.hideOverlay();
            });

            t.restoreRange();
        },
        // Preformated build and management modal
        openModalInsert: function (title, fields, cmd) {
            var t = this,
                prefix = t.o.prefix,
                lg = t.lang,
                html = '';

            $.each(fields, function (fieldName, field) {
                var l = field.label || fieldName,
                    n = field.name || fieldName,
                    a = field.attributes || {};

                var attr = Object.keys(a).map(function (prop) {
                    return prop + '="' + a[prop] + '"';
                }).join(' ');

                html += '<label><input type="' + (field.type || 'text') + '" name="' + n + '"' +
                    (field.type === 'checkbox' && field.value ? ' checked="checked"' : ' value="' + (field.value || '').replace(/"/g, '&quot;')) +
                    '"' + attr + '><span class="' + prefix + 'input-infos"><span>' +
                    (lg[l] ? lg[l] : l) +
                    '</span></span></label>';
            });

            return t.openModal(title, html)
                .on(CONFIRM_EVENT, function () {
                    var $form = $('form', $(this)),
                        valid = true,
                        values = {};

                    $.each(fields, function (fieldName, field) {
                        var n = field.name || fieldName;

                        var $field = $('input[name="' + n + '"]', $form),
                            inputType = $field.attr('type');

                        switch (inputType.toLowerCase()) {
                            case 'checkbox':
                                values[n] = $field.is(':checked');
                                break;
                            case 'radio':
                                values[n] = $field.filter(':checked').val();
                                break;
                            default:
                                values[n] = $.trim($field.val());
                                break;
                        }
                        // Validate value
                        if (field.required && values[n] === '') {
                            valid = false;
                            t.addErrorOnModalField($field, t.lang.required);
                        } else if (field.pattern && !field.pattern.test(values[n])) {
                            valid = false;
                            t.addErrorOnModalField($field, field.patternError);
                        }
                    });

                    if (valid) {
                        t.restoreRange();

                        if (cmd(values, fields)) {
                            t.syncCode();
                            t.$c.trigger('tbwchange');
                            t.closeModal();
                            $(this).off(CONFIRM_EVENT);
                        }
                    }
                })
                .one(CANCEL_EVENT, function () {
                    $(this).off(CONFIRM_EVENT);
                    t.closeModal();
                });
        },
        addErrorOnModalField: function ($field, err) {
            var prefix = this.o.prefix,
                $label = $field.parent();

            $field
                .on('change keyup', function () {
                    $label.removeClass(prefix + 'input-error');
                });

            $label
                .addClass(prefix + 'input-error')
                .find('input+span')
                .append(
                    $('<span/>', {
                        class: prefix + 'msg-error',
                        text: err
                    })
                );
        },

        getDefaultImgDblClickHandler: function () {
            var t = this;

            return function () {
                var $img = $(this),
                    src = $img.attr('src'),
                    base64 = '(Base64)';

                if (src.indexOf('data:image') === 0) {
                    src = base64;
                }

                var options = {
                    url: {
                        label: 'URL',
                        value: src,
                        required: true
                    },
                    alt: {
                        label: t.lang.description,
                        value: $img.attr('alt')
                    }
                };

                if (t.o.imageWidthModalEdit) {
                    options.width = {
                        value: $img.attr('width') ? $img.attr('width') : ''
                    };
                }

                t.openModalInsert(t.lang.insertImage, options, function (v) {
                    if (v.src !== base64) {
                        $img.attr({
                            src: v.url
                        });
                    }
                    $img.attr({
                        alt: v.alt
                    });

                    if (t.o.imageWidthModalEdit) {
                        if (parseInt(v.width) > 0) {
                            $img.attr({
                                width: v.width
                            });
                        } else {
                            $img.removeAttr('width');
                        }
                    }

                    return true;
                });
                return false;
            };
        },

        // Range management
        saveRange: function () {
            var t = this,
                documentSelection = t.doc.getSelection();

            t.range = null;

            if (documentSelection.rangeCount) {
                var savedRange = t.range = documentSelection.getRangeAt(0),
                    range = t.doc.createRange(),
                    rangeStart;
                range.selectNodeContents(t.$ed[0]);
                range.setEnd(savedRange.startContainer, savedRange.startOffset);
                rangeStart = (range + '').length;
                t.metaRange = {
                    start: rangeStart,
                    end: rangeStart + (savedRange + '').length
                };
            }
        },
        restoreRange: function () {
            var t = this,
                metaRange = t.metaRange,
                savedRange = t.range,
                documentSelection = t.doc.getSelection(),
                range;

            if (!savedRange) {
                return;
            }

            if (metaRange && metaRange.start !== metaRange.end) { // Algorithm from http://jsfiddle.net/WeWy7/3/
                var charIndex = 0,
                    nodeStack = [t.$ed[0]],
                    node,
                    foundStart = false,
                    stop = false;

                range = t.doc.createRange();

                while (!stop && (node = nodeStack.pop())) {
                    if (node.nodeType === 3) {
                        var nextCharIndex = charIndex + node.length;
                        if (!foundStart && metaRange.start >= charIndex && metaRange.start <= nextCharIndex) {
                            range.setStart(node, metaRange.start - charIndex);
                            foundStart = true;
                        }
                        if (foundStart && metaRange.end >= charIndex && metaRange.end <= nextCharIndex) {
                            range.setEnd(node, metaRange.end - charIndex);
                            stop = true;
                        }
                        charIndex = nextCharIndex;
                    } else {
                        var cn = node.childNodes,
                            i = cn.length;

                        while (i > 0) {
                            i -= 1;
                            nodeStack.push(cn[i]);
                        }
                    }
                }
            }

            documentSelection.removeAllRanges();
            documentSelection.addRange(range || savedRange);
        },
        getRangeText: function () {
            return this.range + '';
        },

        updateButtonPaneStatus: function () {
            var t = this,
                prefix = t.o.prefix,
                tags = t.getTagsRecursive(t.doc.getSelection().focusNode),
                activeClasses = prefix + 'active-button ' + prefix + 'active';

            $('.' + prefix + 'active-button', t.$btnPane).removeClass(activeClasses);
            $.each(tags, function (i, tag) {
                var btnName = t.tagToButton[tag.toLowerCase()],
                    $btn = $('.' + prefix + btnName + '-button', t.$btnPane);

                if ($btn.length > 0) {
                    $btn.addClass(activeClasses);
                } else {
                    try {
                        $btn = $('.' + prefix + 'dropdown .' + prefix + btnName + '-dropdown-button', t.$box);
                        var dropdownBtnName = $btn.parent().data('dropdown');
                        $('.' + prefix + dropdownBtnName + '-button', t.$box).addClass(activeClasses);
                    } catch (e) {
                    }
                }
            });
        },
        getTagsRecursive: function (element, tags) {
            var t = this;
            tags = tags || (element && element.tagName ? [element.tagName] : []);

            if (element && element.parentNode) {
                element = element.parentNode;
            } else {
                return tags;
            }

            var tag = element.tagName;
            if (tag === 'DIV') {
                return tags;
            }
            if (tag === 'P' && element.style.textAlign !== '') {
                tags.push(element.style.textAlign);
            }

            $.each(t.tagHandlers, function (i, tagHandler) {
                tags = tags.concat(tagHandler(element, t));
            });

            tags.push(tag);

            return t.getTagsRecursive(element, tags).filter(function (tag) {
                return tag != null;
            });
        },

        // Plugins
        initPlugins: function () {
            var t = this;
            t.loadedPlugins = [];
            $.each($.trumbowyg.plugins, function (name, plugin) {
                if (!plugin.shouldInit || plugin.shouldInit(t)) {
                    plugin.init(t);
                    if (plugin.tagHandler) {
                        t.tagHandlers.push(plugin.tagHandler);
                    }
                    t.loadedPlugins.push(plugin);
                }
            });
        },
        destroyPlugins: function () {
            $.each(this.loadedPlugins, function (i, plugin) {
                if (plugin.destroy) {
                    plugin.destroy();
                }
            });
        }
    };
})(navigator, window, document, jQuery);

/* ===========================================================
 * trumbowyg.colors.js v1.2
 * Colors picker plugin for Trumbowyg
 * http://alex-d.github.com/Trumbowyg
 * ===========================================================
 * Author : Alexandre Demode (Alex-D)
 *          Twitter : @AlexandreDemode
 *          Website : alex-d.fr
 */

(function ($) {
    'use strict';

    $.extend(true, $.trumbowyg, {
        langs: {
            // jshint camelcase:false
            cs: {
                foreColor: 'Barva textu',
                backColor: 'Barva pozadí'
            },
            en: {
                foreColor: 'Text color',
                backColor: 'Background color'
            },
            fr: {
                foreColor: 'Couleur du texte',
                backColor: 'Couleur de fond'
            },
            nl: {
                foreColor: 'Tekstkleur',
                backColor: 'Achtergrondkleur'
            },
            sk: {
                foreColor: 'Farba textu',
                backColor: 'Farba pozadia'
            },
            zh_cn: {
                foreColor: '文字颜色',
                backColor: '背景颜色'
            },
            ru: {
                foreColor: 'Цвет текста',
                backColor: 'Цвет выделения текста'
            },
            ja: {
                foreColor: '文字色',
                backColor: '背景色'
            },
            tr: {
                foreColor: 'Yazı rengi',
                backColor: 'Arkaplan rengi'
            }
        }
    });

    // jshint camelcase:true


    function hex(x) {
        return ('0' + parseInt(x).toString(16)).slice(-2);
    }

    function colorToHex(rgb) {
        if (rgb.search('rgb') === -1) {
            return rgb.replace('#', '');
        } else if (rgb === 'rgba(0, 0, 0, 0)') {
            return 'transparent';
        } else {
            rgb = rgb.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+))?\)$/);
            return hex(rgb[1]) + hex(rgb[2]) + hex(rgb[3]);
        }
    }

    function colorTagHandler(element, trumbowyg) {
        var tags = [];

        if (!element.style) {
            return tags;
        }

        // background color
        if (element.style.backgroundColor !== '') {
            var backColor = colorToHex(element.style.backgroundColor);
            if (trumbowyg.o.plugins.colors.colorList.indexOf(backColor) >= 0) {
                tags.push('backColor' + backColor);
            } else {
                tags.push('backColorFree');
            }
        }

        // text color
        var foreColor;
        if (element.style.color !== '') {
            foreColor = colorToHex(element.style.color);
        } else if (element.hasAttribute('color')) {
            foreColor = colorToHex(element.getAttribute('color'));
        }
        if (foreColor) {
            if (trumbowyg.o.plugins.colors.colorList.indexOf(foreColor) >= 0) {
                tags.push('foreColor' + foreColor);
            } else {
                tags.push('foreColorFree');
            }
        }

        return tags;
    }

    var defaultOptions = {
        colorList: ['ffffff', '000000', 'eeece1', '1f497d', '4f81bd', 'c0504d', '9bbb59', '8064a2', '4bacc6', 'f79646', 'ffff00', 'f2f2f2', '7f7f7f', 'ddd9c3', 'c6d9f0', 'dbe5f1', 'f2dcdb', 'ebf1dd', 'e5e0ec', 'dbeef3', 'fdeada', 'fff2ca', 'd8d8d8', '595959', 'c4bd97', '8db3e2', 'b8cce4', 'e5b9b7', 'd7e3bc', 'ccc1d9', 'b7dde8', 'fbd5b5', 'ffe694', 'bfbfbf', '3f3f3f', '938953', '548dd4', '95b3d7', 'd99694', 'c3d69b', 'b2a2c7', 'b7dde8', 'fac08f', 'f2c314', 'a5a5a5', '262626', '494429', '17365d', '366092', '953734', '76923c', '5f497a', '92cddc', 'e36c09', 'c09100', '7f7f7f', '0c0c0c', '1d1b10', '0f243e', '244061', '632423', '4f6128', '3f3151', '31859b', '974806', '7f6000']
    };

    // Add all colors in two dropdowns
    $.extend(true, $.trumbowyg, {
        plugins: {
            color: {
                init: function (trumbowyg) {
                    trumbowyg.o.plugins.colors = trumbowyg.o.plugins.colors || defaultOptions;
                    var foreColorBtnDef = {
                            dropdown: buildDropdown('foreColor', trumbowyg)
                        },
                        backColorBtnDef = {
                            dropdown: buildDropdown('backColor', trumbowyg)
                        };

                    trumbowyg.addBtnDef('foreColor', foreColorBtnDef);
                    trumbowyg.addBtnDef('backColor', backColorBtnDef);
                },
                tagHandler: colorTagHandler
            }
        }
    });

    function buildDropdown(fn, trumbowyg) {
        var dropdown = [];

        $.each(trumbowyg.o.plugins.colors.colorList, function (i, color) {
            var btn = fn + color,
                btnDef = {
                    fn: fn,
                    forceCss: true,
                    param: '#' + color,
                    style: 'background-color: #' + color + ';'
                };
            trumbowyg.addBtnDef(btn, btnDef);
            dropdown.push(btn);
        });

        var removeColorButtonName = fn + 'Remove',
            removeColorBtnDef = {
                fn: 'removeFormat',
                param: fn,
                style: 'background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAAECAYAAACp8Z5+AAAAG0lEQVQIW2NkQAAfEJMRmwBYhoGBYQtMBYoAADziAp0jtJTgAAAAAElFTkSuQmCC);'
            };
        trumbowyg.addBtnDef(removeColorButtonName, removeColorBtnDef);
        dropdown.push(removeColorButtonName);

        // add free color btn
        var freeColorButtonName = fn + 'Free',
            freeColorBtnDef = {
                fn: function () {
                    trumbowyg.openModalInsert(trumbowyg.lang[fn],
                        {
                            color: {
                                label: fn,
                                value: '#FFFFFF'
                            }
                        },
                        // callback
                        function (values) {
                            trumbowyg.execCmd(fn, values.color);
                            return true;
                        }
                    );
                },
                text: '#',
                // style adjust for displaying the text
                style: 'text-indent: 0;line-height: 20px;padding: 0 5px;'
            };
        trumbowyg.addBtnDef(freeColorButtonName, freeColorBtnDef);
        dropdown.push(freeColorButtonName);

        return dropdown;
    }
})(jQuery);

/* ===========================================================
 * trumbowyg.base64.js v1.0
 * Base64 plugin for Trumbowyg
 * http://alex-d.github.com/Trumbowyg
 * ===========================================================
 * Author : Cyril Biencourt (lizardK)
 */

(function ($) {
    'use strict';

    var isSupported = function () {
        return typeof FileReader !== 'undefined';
    };

    var isValidImage = function (type) {
        return /^data:image\/[a-z]?/i.test(type);
    };

    $.extend(true, $.trumbowyg, {
        langs: {
            // jshint camelcase:false
            en: {
                base64: 'Image as base64',
                file: 'File',
                errFileReaderNotSupported: 'FileReader is not supported by your browser.',
                errInvalidImage: 'Invalid image file.'
            },
            fr: {
                base64: 'Image en base64',
                file: 'Fichier'
            },
            cs: {
                base64: 'Vložit obrázek',
                file: 'Soubor'
            },
            zh_cn: {
                base64: '图片（Base64编码）',
                file: '文件'
            },
            nl: {
                base64: 'Afbeelding inline',
                file: 'Bestand',
                errFileReaderNotSupported: 'Uw browser ondersteunt deze functionaliteit niet.',
                errInvalidImage: 'De gekozen afbeelding is ongeldig.'
            },
            ru: {
                base64: 'Изображение как код в base64',
                file: 'Файл',
                errFileReaderNotSupported: 'FileReader не поддерживается вашим браузером.',
                errInvalidImage: 'Недопустимый файл изображения.'
            },
            ja: {
                base64: '画像 (Base64形式)',
                file: 'ファイル',
                errFileReaderNotSupported: 'あなたのブラウザーはFileReaderをサポートしていません',
                errInvalidImage: '画像形式が正しくありません'
            },
            tr: {
                base64: 'Base64 olarak resim',
                file: 'Dosya',
                errFileReaderNotSupported: 'FileReader tarayıcınız tarafından desteklenmiyor.',
                errInvalidImage: 'Geçersiz resim dosyası.'
            }
        },
        // jshint camelcase:true

        plugins: {
            base64: {
                shouldInit: isSupported,
                init: function (trumbowyg) {
                    var btnDef = {
                        isSupported: isSupported,
                        fn: function () {
                            trumbowyg.saveRange();

                            var file;
                            var $modal = trumbowyg.openModalInsert(
                                // Title
                                trumbowyg.lang.base64,

                                // Fields
                                {
                                    file: {
                                        type: 'file',
                                        required: true,
                                        attributes: {
                                            accept: 'image/*'
                                        }
                                    },
                                    alt: {
                                        label: 'description',
                                        value: trumbowyg.getRangeText()
                                    }
                                },

                                // Callback
                                function (values) {
                                    var fReader = new FileReader();

                                    fReader.onloadend = function (e) {
                                        if (isValidImage(e.target.result)) {
                                            trumbowyg.execCmd('insertImage', fReader.result);
                                            $(['img[src="', fReader.result, '"]:not([alt])'].join(''), trumbowyg.$box).attr('alt', values.alt);
                                            trumbowyg.closeModal();
                                        } else {
                                            trumbowyg.addErrorOnModalField(
                                                $('input[type=file]', $modal),
                                                trumbowyg.lang.errInvalidImage
                                            );
                                        }
                                    };

                                    fReader.readAsDataURL(file);
                                }
                            );

                            $('input[type=file]').on('change', function (e) {
                                file = e.target.files[0];
                            });
                        }
                    };

                    trumbowyg.addBtnDef('base64', btnDef);
                }
            }
        }
    });
})(jQuery);

/* ===========================================================
 * trumbowyg.noembed.js v1.0
 * noEmbed plugin for Trumbowyg
 * http://alex-d.github.com/Trumbowyg
 * ===========================================================
 * Author : Jake Johns (jakejohns)
 */

(function ($) {
    'use strict';

    var defaultOptions = {
        proxy: 'https://noembed.com/embed?nowrap=on',
        urlFiled: 'url',
        data: [],
        success: undefined,
        error: undefined
    };

    $.extend(true, $.trumbowyg, {
        langs: {
            en: {
                noembed: 'Noembed',
                noembedError: 'Error'
            },
            sk: {
                noembedError: 'Chyba'
            },
            fr: {
                noembedError: 'Erreur'
            },
            cs: {
                noembedError: 'Chyba'
            },
            ru: {
                noembedError: 'Ошибка'
            },
            ja: {
                noembedError: 'エラー'
            },
            tr: {
                noembedError: 'Hata'
            }
        },

        plugins: {
            noembed: {
                init: function (trumbowyg) {
                    trumbowyg.o.plugins.noembed = $.extend(true, {}, defaultOptions, trumbowyg.o.plugins.noembed || {});

                    var btnDef = {
                        fn: function () {
                            var $modal = trumbowyg.openModalInsert(
                                // Title
                                trumbowyg.lang.noembed,

                                // Fields
                                {
                                    url: {
                                        label: 'URL',
                                        required: true
                                    }
                                },

                                // Callback
                                function (data) {
                                    $.ajax({
                                        url: trumbowyg.o.plugins.noembed.proxy,
                                        type: 'GET',
                                        data: data,
                                        cache: false,
                                        dataType: 'json',

                                        success: trumbowyg.o.plugins.noembed.success || function (data) {
                                            if (data.html) {
                                                trumbowyg.execCmd('insertHTML', data.html);
                                                setTimeout(function () {
                                                    trumbowyg.closeModal();
                                                }, 250);
                                            } else {
                                                trumbowyg.addErrorOnModalField(
                                                    $('input[type=text]', $modal),
                                                    data.error
                                                );
                                            }
                                        },
                                        error: trumbowyg.o.plugins.noembed.error || function () {
                                            trumbowyg.addErrorOnModalField(
                                                $('input[type=text]', $modal),
                                                trumbowyg.lang.noembedError
                                            );
                                        }
                                    });
                                }
                            );
                        }
                    };

                    trumbowyg.addBtnDef('noembed', btnDef);
                }
            }
        }
    });
})(jQuery);

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRydW1ib3d5Zy5qcyIsImNvbG9ycy90cnVtYm93eWcuY29sb3JzLmpzIiwiYmFzZTY0L3RydW1ib3d5Zy5iYXNlNjQuanMiLCJub2VtYmVkL3RydW1ib3d5Zy5ub2VtYmVkLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDeHlEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN6TEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNqSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6InRydW1ib3d5Zy5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBUcnVtYm93eWcgdjIuMTAuMCAtIEEgbGlnaHR3ZWlnaHQgV1lTSVdZRyBlZGl0b3JcclxuICogVHJ1bWJvd3lnIGNvcmUgZmlsZVxyXG4gKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuICogQGxpbmsgaHR0cDovL2FsZXgtZC5naXRodWIuaW8vVHJ1bWJvd3lnXHJcbiAqIEBsaWNlbnNlIE1JVFxyXG4gKiBAYXV0aG9yIEFsZXhhbmRyZSBEZW1vZGUgKEFsZXgtRClcclxuICogICAgICAgICBUd2l0dGVyIDogQEFsZXhhbmRyZURlbW9kZVxyXG4gKiAgICAgICAgIFdlYnNpdGUgOiBhbGV4LWQuZnJcclxuICovXHJcblxyXG5qUXVlcnkudHJ1bWJvd3lnID0ge1xyXG4gICAgbGFuZ3M6IHtcclxuICAgICAgICBlbjoge1xyXG4gICAgICAgICAgICB2aWV3SFRNTDogJ1ZpZXcgSFRNTCcsXHJcblxyXG4gICAgICAgICAgICB1bmRvOiAnVW5kbycsXHJcbiAgICAgICAgICAgIHJlZG86ICdSZWRvJyxcclxuXHJcbiAgICAgICAgICAgIGZvcm1hdHRpbmc6ICdGb3JtYXR0aW5nJyxcclxuICAgICAgICAgICAgcDogJ1BhcmFncmFwaCcsXHJcbiAgICAgICAgICAgIGJsb2NrcXVvdGU6ICdRdW90ZScsXHJcbiAgICAgICAgICAgIGNvZGU6ICdDb2RlJyxcclxuICAgICAgICAgICAgaGVhZGVyOiAnSGVhZGVyJyxcclxuXHJcbiAgICAgICAgICAgIGJvbGQ6ICdCb2xkJyxcclxuICAgICAgICAgICAgaXRhbGljOiAnSXRhbGljJyxcclxuICAgICAgICAgICAgc3RyaWtldGhyb3VnaDogJ1N0cm9rZScsXHJcbiAgICAgICAgICAgIHVuZGVybGluZTogJ1VuZGVybGluZScsXHJcblxyXG4gICAgICAgICAgICBzdHJvbmc6ICdTdHJvbmcnLFxyXG4gICAgICAgICAgICBlbTogJ0VtcGhhc2lzJyxcclxuICAgICAgICAgICAgZGVsOiAnRGVsZXRlZCcsXHJcblxyXG4gICAgICAgICAgICBzdXBlcnNjcmlwdDogJ1N1cGVyc2NyaXB0JyxcclxuICAgICAgICAgICAgc3Vic2NyaXB0OiAnU3Vic2NyaXB0JyxcclxuXHJcbiAgICAgICAgICAgIHVub3JkZXJlZExpc3Q6ICdVbm9yZGVyZWQgbGlzdCcsXHJcbiAgICAgICAgICAgIG9yZGVyZWRMaXN0OiAnT3JkZXJlZCBsaXN0JyxcclxuXHJcbiAgICAgICAgICAgIGluc2VydEltYWdlOiAnSW5zZXJ0IEltYWdlJyxcclxuICAgICAgICAgICAgbGluazogJ0xpbmsnLFxyXG4gICAgICAgICAgICBjcmVhdGVMaW5rOiAnSW5zZXJ0IGxpbmsnLFxyXG4gICAgICAgICAgICB1bmxpbms6ICdSZW1vdmUgbGluaycsXHJcblxyXG4gICAgICAgICAgICBqdXN0aWZ5TGVmdDogJ0FsaWduIExlZnQnLFxyXG4gICAgICAgICAgICBqdXN0aWZ5Q2VudGVyOiAnQWxpZ24gQ2VudGVyJyxcclxuICAgICAgICAgICAganVzdGlmeVJpZ2h0OiAnQWxpZ24gUmlnaHQnLFxyXG4gICAgICAgICAgICBqdXN0aWZ5RnVsbDogJ0FsaWduIEp1c3RpZnknLFxyXG5cclxuICAgICAgICAgICAgaG9yaXpvbnRhbFJ1bGU6ICdJbnNlcnQgaG9yaXpvbnRhbCBydWxlJyxcclxuICAgICAgICAgICAgcmVtb3ZlZm9ybWF0OiAnUmVtb3ZlIGZvcm1hdCcsXHJcblxyXG4gICAgICAgICAgICBmdWxsc2NyZWVuOiAnRnVsbHNjcmVlbicsXHJcblxyXG4gICAgICAgICAgICBjbG9zZTogJ0Nsb3NlJyxcclxuXHJcbiAgICAgICAgICAgIHN1Ym1pdDogJ0NvbmZpcm0nLFxyXG4gICAgICAgICAgICByZXNldDogJ0NhbmNlbCcsXHJcblxyXG4gICAgICAgICAgICByZXF1aXJlZDogJ1JlcXVpcmVkJyxcclxuICAgICAgICAgICAgZGVzY3JpcHRpb246ICdEZXNjcmlwdGlvbicsXHJcbiAgICAgICAgICAgIHRpdGxlOiAnVGl0bGUnLFxyXG4gICAgICAgICAgICB0ZXh0OiAnVGV4dCcsXHJcbiAgICAgICAgICAgIHRhcmdldDogJ1RhcmdldCcsXHJcbiAgICAgICAgICAgIHdpZHRoOiAnV2lkdGgnXHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuXHJcbiAgICAvLyBQbHVnaW5zXHJcbiAgICBwbHVnaW5zOiB7fSxcclxuXHJcbiAgICAvLyBTVkcgUGF0aCBnbG9iYWxseVxyXG4gICAgc3ZnUGF0aDogbnVsbCxcclxuXHJcbiAgICBoaWRlQnV0dG9uVGV4dHM6IG51bGxcclxufTtcclxuXHJcbi8vIE1ha2VzIGRlZmF1bHQgb3B0aW9ucyByZWFkLW9ubHlcclxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGpRdWVyeS50cnVtYm93eWcsICdkZWZhdWx0T3B0aW9ucycsIHtcclxuICAgIHZhbHVlOiB7XHJcbiAgICAgICAgbGFuZzogJ2VuJyxcclxuXHJcbiAgICAgICAgZml4ZWRCdG5QYW5lOiBmYWxzZSxcclxuICAgICAgICBmaXhlZEZ1bGxXaWR0aDogZmFsc2UsXHJcbiAgICAgICAgYXV0b2dyb3c6IGZhbHNlLFxyXG4gICAgICAgIGF1dG9ncm93T25FbnRlcjogZmFsc2UsXHJcbiAgICAgICAgaW1hZ2VXaWR0aE1vZGFsRWRpdDogZmFsc2UsXHJcblxyXG4gICAgICAgIHByZWZpeDogJ3RydW1ib3d5Zy0nLFxyXG5cclxuICAgICAgICBzZW1hbnRpYzogdHJ1ZSxcclxuICAgICAgICByZXNldENzczogZmFsc2UsXHJcbiAgICAgICAgcmVtb3ZlZm9ybWF0UGFzdGVkOiBmYWxzZSxcclxuICAgICAgICB0YWdzVG9SZW1vdmU6IFtdLFxyXG4gICAgICAgIGJ0bnM6IFtcclxuICAgICAgICAgICAgWyd2aWV3SFRNTCddLFxyXG4gICAgICAgICAgICBbJ3VuZG8nLCAncmVkbyddLCAvLyBPbmx5IHN1cHBvcnRlZCBpbiBCbGluayBicm93c2Vyc1xyXG4gICAgICAgICAgICBbJ2Zvcm1hdHRpbmcnXSxcclxuICAgICAgICAgICAgWydzdHJvbmcnLCAnZW0nLCAnZGVsJ10sXHJcbiAgICAgICAgICAgIFsnZm9yZUNvbG9yJywgJ2JhY2tDb2xvciddLFxyXG4gICAgICAgICAgICBbJ3N1cGVyc2NyaXB0JywgJ3N1YnNjcmlwdCddLFxyXG4gICAgICAgICAgICBbJ2xpbmsnXSxcclxuICAgICAgICAgICAgWydpbWFnZSddLFxyXG4gICAgICAgICAgICBbJ2FsaWduJ10sXHJcbiAgICAgICAgICAgIFsndW5vcmRlcmVkTGlzdCcsICdvcmRlcmVkTGlzdCddLFxyXG4gICAgICAgICAgICBbJ2hvcml6b250YWxSdWxlJ10sXHJcbiAgICAgICAgICAgIFsncmVtb3ZlZm9ybWF0J10sXHJcbiAgICAgICAgICAgIFsnZnVsbHNjcmVlbiddXHJcbiAgICAgICAgXSxcclxuICAgICAgICAvLyBGb3IgY3VzdG9tIGJ1dHRvbiBkZWZpbml0aW9ucyAgICAgICAgXHJcbiAgICAgICAgYnRuc0RlZjoge1xyXG4gICAgICAgICAgICBhbGlnbjoge1xyXG4gICAgICAgICAgICAgICAgZHJvcGRvd246IFsnanVzdGlmeUxlZnQnLCAnanVzdGlmeUNlbnRlcicsICdqdXN0aWZ5UmlnaHQnLCAnanVzdGlmeUZ1bGwnXSxcclxuICAgICAgICAgICAgICAgIGljbzogJ2p1c3RpZnlMZWZ0J1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBpbWFnZToge1xyXG4gICAgICAgICAgICAgICAgZHJvcGRvd246IFsnaW5zZXJ0SW1hZ2UnLCAnYmFzZTY0JywgJ25vZW1iZWQnXSxcclxuICAgICAgICAgICAgICAgIGljbzogJ2luc2VydEltYWdlJ1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgaW5saW5lRWxlbWVudHNTZWxlY3RvcjogJ2EsYWJicixhY3JvbnltLGIsY2FwdGlvbixjaXRlLGNvZGUsY29sLGRmbixkaXIsZHQsZGQsZW0sZm9udCxocixpLGtiZCxsaSxxLHNwYW4sc3RyaWtlb3V0LHN0cm9uZyxzdWIsc3VwLHUnLFxyXG5cclxuICAgICAgICBwYXN0ZUhhbmRsZXJzOiBbXSxcclxuXHJcbiAgICAgICAgLy8gaW1nRGJsQ2xpY2tIYW5kbGVyOiBkZWZhdWx0IGlzIGRlZmluZWQgaW4gY29uc3RydWN0b3JcclxuXHJcbiAgICAgICAgcGx1Z2luczoge30sXHJcbiAgICAgICAgdXJsUHJvdG9jb2w6IGZhbHNlLFxyXG4gICAgICAgIG1pbmltYWxMaW5rczogZmFsc2VcclxuICAgIH0sXHJcbiAgICAgICAgd3JpdGFibGU6IGZhbHNlLFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiBmYWxzZVxyXG59KTtcclxuXHJcbihmdW5jdGlvbiAobmF2aWdhdG9yLCB3aW5kb3csIGRvY3VtZW50LCAkKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgdmFyIENPTkZJUk1fRVZFTlQgPSAndGJ3Y29uZmlybScsXHJcbiAgICAgICAgQ0FOQ0VMX0VWRU5UID0gJ3Rid2NhbmNlbCc7XHJcblxyXG4gICAgJC5mbi50cnVtYm93eWcgPSBmdW5jdGlvbiAob3B0aW9ucywgcGFyYW1zKSB7XHJcbiAgICAgICAgdmFyIHRydW1ib3d5Z0RhdGFOYW1lID0gJ3RydW1ib3d5Zyc7XHJcbiAgICAgICAgaWYgKG9wdGlvbnMgPT09IE9iamVjdChvcHRpb25zKSB8fCAhb3B0aW9ucykge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIGlmICghJCh0aGlzKS5kYXRhKHRydW1ib3d5Z0RhdGFOYW1lKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICQodGhpcykuZGF0YSh0cnVtYm93eWdEYXRhTmFtZSwgbmV3IFRydW1ib3d5Zyh0aGlzLCBvcHRpb25zKSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5sZW5ndGggPT09IDEpIHtcclxuICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgIHZhciB0ID0gJCh0aGlzKS5kYXRhKHRydW1ib3d5Z0RhdGFOYW1lKTtcclxuICAgICAgICAgICAgICAgIHN3aXRjaCAob3B0aW9ucykge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIEV4ZWMgY29tbWFuZFxyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2V4ZWNDbWQnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdC5leGVjQ21kKHBhcmFtcy5jbWQsIHBhcmFtcy5wYXJhbSwgcGFyYW1zLmZvcmNlQ3NzKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gTW9kYWwgYm94XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnb3Blbk1vZGFsJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHQub3Blbk1vZGFsKHBhcmFtcy50aXRsZSwgcGFyYW1zLmNvbnRlbnQpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2Nsb3NlTW9kYWwnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdC5jbG9zZU1vZGFsKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnb3Blbk1vZGFsSW5zZXJ0JzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHQub3Blbk1vZGFsSW5zZXJ0KHBhcmFtcy50aXRsZSwgcGFyYW1zLmZpZWxkcywgcGFyYW1zLmNhbGxiYWNrKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gUmFuZ2VcclxuICAgICAgICAgICAgICAgICAgICBjYXNlICdzYXZlUmFuZ2UnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdC5zYXZlUmFuZ2UoKTtcclxuICAgICAgICAgICAgICAgICAgICBjYXNlICdnZXRSYW5nZSc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0LnJhbmdlO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2dldFJhbmdlVGV4dCc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0LmdldFJhbmdlVGV4dCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ3Jlc3RvcmVSYW5nZSc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0LnJlc3RvcmVSYW5nZSgpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyBFbmFibGUvZGlzYWJsZVxyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2VuYWJsZSc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0LnNldERpc2FibGVkKGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICBjYXNlICdkaXNhYmxlJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHQuc2V0RGlzYWJsZWQodHJ1ZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIFRvZ2dsZVxyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ3RvZ2dsZSc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0LnRvZ2dsZSgpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyBEZXN0cm95XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnZGVzdHJveSc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0LmRlc3Ryb3koKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gRW1wdHlcclxuICAgICAgICAgICAgICAgICAgICBjYXNlICdlbXB0eSc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0LmVtcHR5KCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIEhUTUxcclxuICAgICAgICAgICAgICAgICAgICBjYXNlICdodG1sJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHQuaHRtbChwYXJhbXMpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGNhdGNoIChjKSB7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH07XHJcblxyXG4gICAgLy8gQHBhcmFtOiBlZGl0b3JFbGVtIGlzIHRoZSBET00gZWxlbWVudFxyXG4gICAgdmFyIFRydW1ib3d5ZyA9IGZ1bmN0aW9uIChlZGl0b3JFbGVtLCBvcHRpb25zKSB7XHJcbiAgICAgICAgdmFyIHQgPSB0aGlzLFxyXG4gICAgICAgICAgICB0cnVtYm93eWdJY29uc0lkID0gJ3RydW1ib3d5Zy1pY29ucycsXHJcbiAgICAgICAgICAgICR0cnVtYm93eWcgPSAkLnRydW1ib3d5ZztcclxuXHJcbiAgICAgICAgLy8gR2V0IHRoZSBkb2N1bWVudCBvZiB0aGUgZWxlbWVudC4gSXQgdXNlIHRvIG1ha2VzIHRoZSBwbHVnaW5cclxuICAgICAgICAvLyBjb21wYXRpYmxlIG9uIGlmcmFtZXMuXHJcbiAgICAgICAgdC5kb2MgPSBlZGl0b3JFbGVtLm93bmVyRG9jdW1lbnQgfHwgZG9jdW1lbnQ7XHJcblxyXG4gICAgICAgIC8vIGpRdWVyeSBvYmplY3Qgb2YgdGhlIGVkaXRvclxyXG4gICAgICAgIHQuJHRhID0gJChlZGl0b3JFbGVtKTsgLy8gJHRhIDogVGV4dGFyZWFcclxuICAgICAgICB0LiRjID0gJChlZGl0b3JFbGVtKTsgLy8gJGMgOiBjcmVhdG9yXHJcblxyXG4gICAgICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xyXG5cclxuICAgICAgICAvLyBMb2NhbGl6YXRpb24gbWFuYWdlbWVudFxyXG4gICAgICAgIGlmIChvcHRpb25zLmxhbmcgIT0gbnVsbCB8fCAkdHJ1bWJvd3lnLmxhbmdzW29wdGlvbnMubGFuZ10gIT0gbnVsbCkge1xyXG4gICAgICAgICAgICB0LmxhbmcgPSAkLmV4dGVuZCh0cnVlLCB7fSwgJHRydW1ib3d5Zy5sYW5ncy5lbiwgJHRydW1ib3d5Zy5sYW5nc1tvcHRpb25zLmxhbmddKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0LmxhbmcgPSAkdHJ1bWJvd3lnLmxhbmdzLmVuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdC5oaWRlQnV0dG9uVGV4dHMgPSAkdHJ1bWJvd3lnLmhpZGVCdXR0b25UZXh0cyAhPSBudWxsID8gJHRydW1ib3d5Zy5oaWRlQnV0dG9uVGV4dHMgOiBvcHRpb25zLmhpZGVCdXR0b25UZXh0cztcclxuXHJcbiAgICAgICAgLy8gU1ZHIHBhdGhcclxuICAgICAgICB2YXIgc3ZnUGF0aE9wdGlvbiA9ICR0cnVtYm93eWcuc3ZnUGF0aCAhPSBudWxsID8gJHRydW1ib3d5Zy5zdmdQYXRoIDogb3B0aW9ucy5zdmdQYXRoO1xyXG4gICAgICAgIHQuaGFzU3ZnID0gc3ZnUGF0aE9wdGlvbiAhPT0gZmFsc2U7XHJcbiAgICAgICAgdC5zdmdQYXRoID0gISF0LmRvYy5xdWVyeVNlbGVjdG9yKCdiYXNlJykgPyB3aW5kb3cubG9jYXRpb24uaHJlZi5zcGxpdCgnIycpWzBdIDogJyc7XHJcbiAgICAgICAgaWYgKCQoJyMnICsgdHJ1bWJvd3lnSWNvbnNJZCwgdC5kb2MpLmxlbmd0aCA9PT0gMCAmJiBzdmdQYXRoT3B0aW9uICE9PSBmYWxzZSkge1xyXG4gICAgICAgICAgICBpZiAoc3ZnUGF0aE9wdGlvbiA9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBIYWNrIHRvIGdldCBzdmdQYXRoT3B0aW9uIGJhc2VkIG9uIHRydW1ib3d5Zy5qcyBwYXRoXHJcbiAgICAgICAgICAgICAgICB2YXIgc2NyaXB0RWxlbWVudHMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnc2NyaXB0Jyk7XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNjcmlwdEVsZW1lbnRzLmxlbmd0aDsgaSArPSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHNvdXJjZSA9IHNjcmlwdEVsZW1lbnRzW2ldLnNyYztcclxuICAgICAgICAgICAgICAgICAgICB2YXIgbWF0Y2hlcyA9IHNvdXJjZS5tYXRjaCgndHJ1bWJvd3lnKFxcLm1pbik/XFwuanMnKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAobWF0Y2hlcyAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN2Z1BhdGhPcHRpb24gPSBzb3VyY2Uuc3Vic3RyaW5nKDAsIHNvdXJjZS5pbmRleE9mKG1hdGNoZXNbMF0pKSArICd1aS9pY29ucy5zdmcnO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChzdmdQYXRoT3B0aW9uID09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oJ1lvdSBtdXN0IGRlZmluZSBzdmdQYXRoOiBodHRwczovL2dvby5nbC9DZlRZOVUnKTsgLy8ganNoaW50IGlnbm9yZTpsaW5lXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHZhciBkaXYgPSB0LmRvYy5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgICAgICAgZGl2LmlkID0gdHJ1bWJvd3lnSWNvbnNJZDtcclxuICAgICAgICAgICAgdC5kb2MuYm9keS5pbnNlcnRCZWZvcmUoZGl2LCB0LmRvYy5ib2R5LmNoaWxkTm9kZXNbMF0pO1xyXG4gICAgICAgICAgICAkLmFqYXgoe1xyXG4gICAgICAgICAgICAgICAgYXN5bmM6IHRydWUsXHJcbiAgICAgICAgICAgICAgICB0eXBlOiAnR0VUJyxcclxuICAgICAgICAgICAgICAgIGNvbnRlbnRUeXBlOiAnYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkOyBjaGFyc2V0PVVURi04JyxcclxuICAgICAgICAgICAgICAgIGRhdGFUeXBlOiAneG1sJyxcclxuICAgICAgICAgICAgICAgIGNyb3NzRG9tYWluOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgdXJsOiBzdmdQYXRoT3B0aW9uLFxyXG4gICAgICAgICAgICAgICAgZGF0YTogbnVsbCxcclxuICAgICAgICAgICAgICAgIGJlZm9yZVNlbmQ6IG51bGwsXHJcbiAgICAgICAgICAgICAgICBjb21wbGV0ZTogbnVsbCxcclxuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGl2LmlubmVySFRNTCA9IG5ldyBYTUxTZXJpYWxpemVyKCkuc2VyaWFsaXplVG9TdHJpbmcoZGF0YS5kb2N1bWVudEVsZW1lbnQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBXaGVuIHRoZSBidXR0b24gaXMgYXNzb2NpYXRlZCB0byBhIGVtcHR5IG9iamVjdFxyXG4gICAgICAgICAqIGZuIGFuZCB0aXRsZSBhdHRyaWJ1dHMgYXJlIGRlZmluZWQgZnJvbSB0aGUgYnV0dG9uIGtleSB2YWx1ZVxyXG4gICAgICAgICAqXHJcbiAgICAgICAgICogRm9yIGV4YW1wbGVcclxuICAgICAgICAgKiAgICAgIGZvbzoge31cclxuICAgICAgICAgKiBpcyBlcXVpdmFsZW50IHRvIDpcclxuICAgICAgICAgKiAgICAgIGZvbzoge1xyXG4gICAgICAgICAqICAgICAgICAgIGZuOiAnZm9vJyxcclxuICAgICAgICAgKiAgICAgICAgICB0aXRsZTogdGhpcy5sYW5nLmZvb1xyXG4gICAgICAgICAqICAgICAgfVxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIHZhciBoID0gdC5sYW5nLmhlYWRlciwgLy8gSGVhZGVyIHRyYW5zbGF0aW9uXHJcbiAgICAgICAgICAgIGlzQmxpbmtGdW5jdGlvbiA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiAod2luZG93LmNocm9tZSB8fCAod2luZG93LkludGwgJiYgSW50bC52OEJyZWFrSXRlcmF0b3IpKSAmJiAnQ1NTJyBpbiB3aW5kb3c7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgdC5idG5zRGVmID0ge1xyXG4gICAgICAgICAgICB2aWV3SFRNTDoge1xyXG4gICAgICAgICAgICAgICAgZm46ICd0b2dnbGUnXHJcbiAgICAgICAgICAgIH0sXHJcblxyXG4gICAgICAgICAgICB1bmRvOiB7XHJcbiAgICAgICAgICAgICAgICBpc1N1cHBvcnRlZDogaXNCbGlua0Z1bmN0aW9uLFxyXG4gICAgICAgICAgICAgICAga2V5OiAnWidcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgcmVkbzoge1xyXG4gICAgICAgICAgICAgICAgaXNTdXBwb3J0ZWQ6IGlzQmxpbmtGdW5jdGlvbixcclxuICAgICAgICAgICAgICAgIGtleTogJ1knXHJcbiAgICAgICAgICAgIH0sXHJcblxyXG4gICAgICAgICAgICBwOiB7XHJcbiAgICAgICAgICAgICAgICBmbjogJ2Zvcm1hdEJsb2NrJ1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBibG9ja3F1b3RlOiB7XHJcbiAgICAgICAgICAgICAgICBmbjogJ2Zvcm1hdEJsb2NrJ1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBoMToge1xyXG4gICAgICAgICAgICAgICAgZm46ICdmb3JtYXRCbG9jaycsXHJcbiAgICAgICAgICAgICAgICB0aXRsZTogaCArICcgMSdcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgaDI6IHtcclxuICAgICAgICAgICAgICAgIGZuOiAnZm9ybWF0QmxvY2snLFxyXG4gICAgICAgICAgICAgICAgdGl0bGU6IGggKyAnIDInXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGgzOiB7XHJcbiAgICAgICAgICAgICAgICBmbjogJ2Zvcm1hdEJsb2NrJyxcclxuICAgICAgICAgICAgICAgIHRpdGxlOiBoICsgJyAzJ1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBoNDoge1xyXG4gICAgICAgICAgICAgICAgZm46ICdmb3JtYXRCbG9jaycsXHJcbiAgICAgICAgICAgICAgICB0aXRsZTogaCArICcgNCdcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgc3Vic2NyaXB0OiB7XHJcbiAgICAgICAgICAgICAgICB0YWc6ICdzdWInXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHN1cGVyc2NyaXB0OiB7XHJcbiAgICAgICAgICAgICAgICB0YWc6ICdzdXAnXHJcbiAgICAgICAgICAgIH0sXHJcblxyXG4gICAgICAgICAgICBib2xkOiB7XHJcbiAgICAgICAgICAgICAgICBrZXk6ICdCJyxcclxuICAgICAgICAgICAgICAgIHRhZzogJ2InXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGl0YWxpYzoge1xyXG4gICAgICAgICAgICAgICAga2V5OiAnSScsXHJcbiAgICAgICAgICAgICAgICB0YWc6ICdpJ1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB1bmRlcmxpbmU6IHtcclxuICAgICAgICAgICAgICAgIHRhZzogJ3UnXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHN0cmlrZXRocm91Z2g6IHtcclxuICAgICAgICAgICAgICAgIHRhZzogJ3N0cmlrZSdcclxuICAgICAgICAgICAgfSxcclxuXHJcbiAgICAgICAgICAgIHN0cm9uZzoge1xyXG4gICAgICAgICAgICAgICAgZm46ICdib2xkJyxcclxuICAgICAgICAgICAgICAgIGtleTogJ0InXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGVtOiB7XHJcbiAgICAgICAgICAgICAgICBmbjogJ2l0YWxpYycsXHJcbiAgICAgICAgICAgICAgICBrZXk6ICdJJ1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBkZWw6IHtcclxuICAgICAgICAgICAgICAgIGZuOiAnc3RyaWtldGhyb3VnaCdcclxuICAgICAgICAgICAgfSxcclxuXHJcbiAgICAgICAgICAgIGNyZWF0ZUxpbms6IHtcclxuICAgICAgICAgICAgICAgIGtleTogJ0snLFxyXG4gICAgICAgICAgICAgICAgdGFnOiAnYSdcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgdW5saW5rOiB7fSxcclxuXHJcbiAgICAgICAgICAgIGluc2VydEltYWdlOiB7fSxcclxuXHJcbiAgICAgICAgICAgIGp1c3RpZnlMZWZ0OiB7XHJcbiAgICAgICAgICAgICAgICB0YWc6ICdsZWZ0JyxcclxuICAgICAgICAgICAgICAgIGZvcmNlQ3NzOiB0cnVlXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGp1c3RpZnlDZW50ZXI6IHtcclxuICAgICAgICAgICAgICAgIHRhZzogJ2NlbnRlcicsXHJcbiAgICAgICAgICAgICAgICBmb3JjZUNzczogdHJ1ZVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBqdXN0aWZ5UmlnaHQ6IHtcclxuICAgICAgICAgICAgICAgIHRhZzogJ3JpZ2h0JyxcclxuICAgICAgICAgICAgICAgIGZvcmNlQ3NzOiB0cnVlXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGp1c3RpZnlGdWxsOiB7XHJcbiAgICAgICAgICAgICAgICB0YWc6ICdqdXN0aWZ5JyxcclxuICAgICAgICAgICAgICAgIGZvcmNlQ3NzOiB0cnVlXHJcbiAgICAgICAgICAgIH0sXHJcblxyXG4gICAgICAgICAgICB1bm9yZGVyZWRMaXN0OiB7XHJcbiAgICAgICAgICAgICAgICBmbjogJ2luc2VydFVub3JkZXJlZExpc3QnLFxyXG4gICAgICAgICAgICAgICAgdGFnOiAndWwnXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIG9yZGVyZWRMaXN0OiB7XHJcbiAgICAgICAgICAgICAgICBmbjogJ2luc2VydE9yZGVyZWRMaXN0JyxcclxuICAgICAgICAgICAgICAgIHRhZzogJ29sJ1xyXG4gICAgICAgICAgICB9LFxyXG5cclxuICAgICAgICAgICAgaG9yaXpvbnRhbFJ1bGU6IHtcclxuICAgICAgICAgICAgICAgIGZuOiAnaW5zZXJ0SG9yaXpvbnRhbFJ1bGUnXHJcbiAgICAgICAgICAgIH0sXHJcblxyXG4gICAgICAgICAgICByZW1vdmVmb3JtYXQ6IHt9LFxyXG5cclxuICAgICAgICAgICAgZnVsbHNjcmVlbjoge1xyXG4gICAgICAgICAgICAgICAgY2xhc3M6ICd0cnVtYm93eWctbm90LWRpc2FibGUnXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGNsb3NlOiB7XHJcbiAgICAgICAgICAgICAgICBmbjogJ2Rlc3Ryb3knLFxyXG4gICAgICAgICAgICAgICAgY2xhc3M6ICd0cnVtYm93eWctbm90LWRpc2FibGUnXHJcbiAgICAgICAgICAgIH0sXHJcblxyXG4gICAgICAgICAgICAvLyBEcm9wZG93bnNcclxuICAgICAgICAgICAgZm9ybWF0dGluZzoge1xyXG4gICAgICAgICAgICAgICAgZHJvcGRvd246IFsncCcsICdibG9ja3F1b3RlJywgJ2gxJywgJ2gyJywgJ2gzJywgJ2g0J10sXHJcbiAgICAgICAgICAgICAgICBpY286ICdwJ1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBsaW5rOiB7XHJcbiAgICAgICAgICAgICAgICBkcm9wZG93bjogWydjcmVhdGVMaW5rJywgJ3VubGluayddXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvLyBEZWZhdWx0cyBPcHRpb25zXHJcbiAgICAgICAgdC5vID0gJC5leHRlbmQodHJ1ZSwge30sICR0cnVtYm93eWcuZGVmYXVsdE9wdGlvbnMsIG9wdGlvbnMpO1xyXG4gICAgICAgIGlmICghdC5vLmhhc093blByb3BlcnR5KCdpbWdEYmxDbGlja0hhbmRsZXInKSkge1xyXG4gICAgICAgICAgICB0Lm8uaW1nRGJsQ2xpY2tIYW5kbGVyID0gdC5nZXREZWZhdWx0SW1nRGJsQ2xpY2tIYW5kbGVyKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0LnVybFByZWZpeCA9IHQuc2V0dXBVcmxQcmVmaXgoKTtcclxuXHJcbiAgICAgICAgdC5kaXNhYmxlZCA9IHQuby5kaXNhYmxlZCB8fCAoZWRpdG9yRWxlbS5ub2RlTmFtZSA9PT0gJ1RFWFRBUkVBJyAmJiBlZGl0b3JFbGVtLmRpc2FibGVkKTtcclxuXHJcbiAgICAgICAgaWYgKG9wdGlvbnMuYnRucykge1xyXG4gICAgICAgICAgICB0Lm8uYnRucyA9IG9wdGlvbnMuYnRucztcclxuICAgICAgICB9IGVsc2UgaWYgKCF0Lm8uc2VtYW50aWMpIHtcclxuICAgICAgICAgICAgdC5vLmJ0bnNbM10gPSBbJ2JvbGQnLCAnaXRhbGljJywgJ3VuZGVybGluZScsICdzdHJpa2V0aHJvdWdoJ107XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkLmVhY2godC5vLmJ0bnNEZWYsIGZ1bmN0aW9uIChidG5OYW1lLCBidG5EZWYpIHtcclxuICAgICAgICAgICAgdC5hZGRCdG5EZWYoYnRuTmFtZSwgYnRuRGVmKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgLy8gcHV0IHRoaXMgaGVyZSBpbiB0aGUgZXZlbnQgaXQgd291bGQgYmUgbWVyZ2VkIGluIHdpdGggb3B0aW9uc1xyXG4gICAgICAgIHQuZXZlbnROYW1lc3BhY2UgPSAndHJ1bWJvd3lnLWV2ZW50JztcclxuXHJcbiAgICAgICAgLy8gS2V5Ym9hcmQgc2hvcnRjdXRzIGFyZSBsb2FkIGluIHRoaXMgYXJyYXlcclxuICAgICAgICB0LmtleXMgPSBbXTtcclxuXHJcbiAgICAgICAgLy8gVGFnIHRvIGJ1dHRvbiBkeW5hbWljYWxseSBoeWRyYXRlZFxyXG4gICAgICAgIHQudGFnVG9CdXR0b24gPSB7fTtcclxuICAgICAgICB0LnRhZ0hhbmRsZXJzID0gW107XHJcblxyXG4gICAgICAgIC8vIEFkbWl0IG11bHRpcGxlIHBhc3RlIGhhbmRsZXJzXHJcbiAgICAgICAgdC5wYXN0ZUhhbmRsZXJzID0gW10uY29uY2F0KHQuby5wYXN0ZUhhbmRsZXJzKTtcclxuXHJcbiAgICAgICAgLy8gQ2hlY2sgaWYgYnJvd3NlciBpcyBJRVxyXG4gICAgICAgIHQuaXNJRSA9IChuYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoJ01TSUUnKSAhPT0gLTEgfHwgbmF2aWdhdG9yLmFwcFZlcnNpb24uaW5kZXhPZignVHJpZGVudC8nKSAhPT0gLTEpO1xyXG5cclxuICAgICAgICB0LmluaXQoKTtcclxuICAgIH07XHJcblxyXG4gICAgVHJ1bWJvd3lnLnByb3RvdHlwZSA9IHtcclxuICAgICAgICBERUZBVUxUX1NFTUFOVElDX01BUDoge1xyXG4gICAgICAgICAgICAnYic6ICdzdHJvbmcnLFxyXG4gICAgICAgICAgICAnaSc6ICdlbScsXHJcbiAgICAgICAgICAgICdzJzogJ2RlbCcsXHJcbiAgICAgICAgICAgICdzdHJpa2UnOiAnZGVsJyxcclxuICAgICAgICAgICAgJ2Rpdic6ICdwJ1xyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIGluaXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyIHQgPSB0aGlzO1xyXG4gICAgICAgICAgICB0LmhlaWdodCA9IHQuJHRhLmhlaWdodCgpO1xyXG5cclxuICAgICAgICAgICAgdC5pbml0UGx1Z2lucygpO1xyXG5cclxuICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgIC8vIERpc2FibGUgaW1hZ2UgcmVzaXplLCB0cnktY2F0Y2ggZm9yIG9sZCBJRVxyXG4gICAgICAgICAgICAgICAgdC5kb2MuZXhlY0NvbW1hbmQoJ2VuYWJsZU9iamVjdFJlc2l6aW5nJywgZmFsc2UsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgIHQuZG9jLmV4ZWNDb21tYW5kKCdkZWZhdWx0UGFyYWdyYXBoU2VwYXJhdG9yJywgZmFsc2UsICdwJyk7XHJcbiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdC5idWlsZEVkaXRvcigpO1xyXG4gICAgICAgICAgICB0LmJ1aWxkQnRuUGFuZSgpO1xyXG5cclxuICAgICAgICAgICAgdC5maXhlZEJ0blBhbmVFdmVudHMoKTtcclxuXHJcbiAgICAgICAgICAgIHQuYnVpbGRPdmVybGF5KCk7XHJcblxyXG4gICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIGlmICh0LmRpc2FibGVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdC5zZXREaXNhYmxlZCh0cnVlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHQuJGMudHJpZ2dlcigndGJ3aW5pdCcpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICBhZGRCdG5EZWY6IGZ1bmN0aW9uIChidG5OYW1lLCBidG5EZWYpIHtcclxuICAgICAgICAgICAgdGhpcy5idG5zRGVmW2J0bk5hbWVdID0gYnRuRGVmO1xyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIHNldHVwVXJsUHJlZml4OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciBwcm90b2NvbCA9IHRoaXMuby51cmxQcm90b2NvbDtcclxuICAgICAgICAgICAgaWYgKCFwcm90b2NvbCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAodHlwZW9mIChwcm90b2NvbCkgIT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gJ2h0dHBzOi8vJztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gLzpcXC9cXC8kLy50ZXN0KHByb3RvY29sKSA/IHByb3RvY29sIDogcHJvdG9jb2wgKyAnOi8vJztcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICBidWlsZEVkaXRvcjogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2YXIgdCA9IHRoaXMsXHJcbiAgICAgICAgICAgICAgICBwcmVmaXggPSB0Lm8ucHJlZml4LFxyXG4gICAgICAgICAgICAgICAgaHRtbCA9ICcnO1xyXG5cclxuICAgICAgICAgICAgdC4kYm94ID0gJCgnPGRpdi8+Jywge1xyXG4gICAgICAgICAgICAgICAgY2xhc3M6IHByZWZpeCArICdib3ggJyArIHByZWZpeCArICdlZGl0b3ItdmlzaWJsZSAnICsgcHJlZml4ICsgdC5vLmxhbmcgKyAnIHRydW1ib3d5ZydcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAvLyAkdGEgPSBUZXh0YXJlYVxyXG4gICAgICAgICAgICAvLyAkZWQgPSBFZGl0b3JcclxuICAgICAgICAgICAgdC5pc1RleHRhcmVhID0gdC4kdGEuaXMoJ3RleHRhcmVhJyk7XHJcbiAgICAgICAgICAgIGlmICh0LmlzVGV4dGFyZWEpIHtcclxuICAgICAgICAgICAgICAgIGh0bWwgPSB0LiR0YS52YWwoKTtcclxuICAgICAgICAgICAgICAgIHQuJGVkID0gJCgnPGRpdi8+Jyk7XHJcbiAgICAgICAgICAgICAgICB0LiRib3hcclxuICAgICAgICAgICAgICAgICAgICAuaW5zZXJ0QWZ0ZXIodC4kdGEpXHJcbiAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCh0LiRlZCwgdC4kdGEpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdC4kZWQgPSB0LiR0YTtcclxuICAgICAgICAgICAgICAgIGh0bWwgPSB0LiRlZC5odG1sKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgdC4kdGEgPSAkKCc8dGV4dGFyZWEvPicsIHtcclxuICAgICAgICAgICAgICAgICAgICBuYW1lOiB0LiR0YS5hdHRyKCdpZCcpLFxyXG4gICAgICAgICAgICAgICAgICAgIGhlaWdodDogdC5oZWlnaHRcclxuICAgICAgICAgICAgICAgIH0pLnZhbChodG1sKTtcclxuXHJcbiAgICAgICAgICAgICAgICB0LiRib3hcclxuICAgICAgICAgICAgICAgICAgICAuaW5zZXJ0QWZ0ZXIodC4kZWQpXHJcbiAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCh0LiR0YSwgdC4kZWQpO1xyXG4gICAgICAgICAgICAgICAgdC5zeW5jQ29kZSgpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0LiR0YVxyXG4gICAgICAgICAgICAgICAgLmFkZENsYXNzKHByZWZpeCArICd0ZXh0YXJlYScpXHJcbiAgICAgICAgICAgICAgICAuYXR0cigndGFiaW5kZXgnLCAtMSlcclxuICAgICAgICAgICAgICAgIDtcclxuXHJcbiAgICAgICAgICAgIHQuJGVkXHJcbiAgICAgICAgICAgICAgICAuYWRkQ2xhc3MocHJlZml4ICsgJ2VkaXRvcicpXHJcbiAgICAgICAgICAgICAgICAuYXR0cih7XHJcbiAgICAgICAgICAgICAgICAgICAgY29udGVudGVkaXRhYmxlOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgIGRpcjogdC5sYW5nLl9kaXIgfHwgJ2x0cidcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAuaHRtbChodG1sKVxyXG4gICAgICAgICAgICAgICAgO1xyXG5cclxuICAgICAgICAgICAgaWYgKHQuby50YWJpbmRleCkge1xyXG4gICAgICAgICAgICAgICAgdC4kZWQuYXR0cigndGFiaW5kZXgnLCB0Lm8udGFiaW5kZXgpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAodC4kYy5pcygnW3BsYWNlaG9sZGVyXScpKSB7XHJcbiAgICAgICAgICAgICAgICB0LiRlZC5hdHRyKCdwbGFjZWhvbGRlcicsIHQuJGMuYXR0cigncGxhY2Vob2xkZXInKSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmICh0LiRjLmlzKCdbc3BlbGxjaGVja10nKSkge1xyXG4gICAgICAgICAgICAgICAgdC4kZWQuYXR0cignc3BlbGxjaGVjaycsIHQuJGMuYXR0cignc3BlbGxjaGVjaycpKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKHQuby5yZXNldENzcykge1xyXG4gICAgICAgICAgICAgICAgdC4kZWQuYWRkQ2xhc3MocHJlZml4ICsgJ3Jlc2V0LWNzcycpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoIXQuby5hdXRvZ3Jvdykge1xyXG4gICAgICAgICAgICAgICAgdC4kdGEuYWRkKHQuJGVkKS5jc3Moe1xyXG4gICAgICAgICAgICAgICAgICAgIGhlaWdodDogdC5oZWlnaHRcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0LnNlbWFudGljQ29kZSgpO1xyXG5cclxuICAgICAgICAgICAgaWYgKHQuby5hdXRvZ3Jvd09uRW50ZXIpIHtcclxuICAgICAgICAgICAgICAgIHQuJGVkLmFkZENsYXNzKHByZWZpeCArICdhdXRvZ3Jvdy1vbi1lbnRlcicpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB2YXIgY3RybCA9IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgY29tcG9zaXRpb24gPSBmYWxzZSxcclxuICAgICAgICAgICAgICAgIGRlYm91bmNlQnV0dG9uUGFuZVN0YXR1cyxcclxuICAgICAgICAgICAgICAgIHVwZGF0ZUV2ZW50TmFtZSA9ICdrZXl1cCc7XHJcblxyXG4gICAgICAgICAgICB0LiRlZFxyXG4gICAgICAgICAgICAgICAgLm9uKCdkYmxjbGljaycsICdpbWcnLCB0Lm8uaW1nRGJsQ2xpY2tIYW5kbGVyKVxyXG4gICAgICAgICAgICAgICAgLm9uKCdrZXlkb3duJywgZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoKGUuY3RybEtleSB8fCBlLm1ldGFLZXkpICYmICFlLmFsdEtleSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjdHJsID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGtleSA9IHQua2V5c1tTdHJpbmcuZnJvbUNoYXJDb2RlKGUud2hpY2gpLnRvVXBwZXJDYXNlKCldO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQuZXhlY0NtZChrZXkuZm4sIGtleS5wYXJhbSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAub24oJ2NvbXBvc2l0aW9uc3RhcnQgY29tcG9zaXRpb251cGRhdGUnLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29tcG9zaXRpb24gPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIC5vbih1cGRhdGVFdmVudE5hbWUgKyAnIGNvbXBvc2l0aW9uZW5kJywgZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZS50eXBlID09PSAnY29tcG9zaXRpb25lbmQnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBvc2l0aW9uID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChjb21wb3NpdGlvbikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICB2YXIga2V5Q29kZSA9IGUud2hpY2g7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChrZXlDb2RlID49IDM3ICYmIGtleUNvZGUgPD0gNDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKChlLmN0cmxLZXkgfHwgZS5tZXRhS2V5KSAmJiAoa2V5Q29kZSA9PT0gODkgfHwga2V5Q29kZSA9PT0gOTApKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHQuJGMudHJpZ2dlcigndGJ3Y2hhbmdlJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICghY3RybCAmJiBrZXlDb2RlICE9PSAxNykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY29tcG9zaXRpb25FbmRJRSA9IHQuaXNJRSA/IGUudHlwZSA9PT0gJ2NvbXBvc2l0aW9uZW5kJyA6IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHQuc2VtYW50aWNDb2RlKGZhbHNlLCBjb21wb3NpdGlvbkVuZElFICYmIGtleUNvZGUgPT09IDEzKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdC4kYy50cmlnZ2VyKCd0YndjaGFuZ2UnKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBlLndoaWNoID09PSAndW5kZWZpbmVkJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0LnNlbWFudGljQ29kZShmYWxzZSwgZmFsc2UsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGN0cmwgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICB9LCA1MCk7XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgLm9uKCdtb3VzZXVwIGtleWRvd24ga2V5dXAnLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICgoIWUuY3RybEtleSAmJiAhZS5tZXRhS2V5KSB8fCBlLmFsdEtleSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsgLy8gXCJob2xkIG9uXCIgdG8gdGhlIGN0cmwga2V5IGZvciA1MG1zXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHJsID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIDUwKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KGRlYm91bmNlQnV0dG9uUGFuZVN0YXR1cyk7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVib3VuY2VCdXR0b25QYW5lU3RhdHVzID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHQudXBkYXRlQnV0dG9uUGFuZVN0YXR1cygpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0sIDUwKTtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAub24oJ2ZvY3VzIGJsdXInLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHQuJGMudHJpZ2dlcigndGJ3JyArIGUudHlwZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGUudHlwZSA9PT0gJ2JsdXInKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJy4nICsgcHJlZml4ICsgJ2FjdGl2ZS1idXR0b24nLCB0LiRidG5QYW5lKS5yZW1vdmVDbGFzcyhwcmVmaXggKyAnYWN0aXZlLWJ1dHRvbiAnICsgcHJlZml4ICsgJ2FjdGl2ZScpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAodC5vLmF1dG9ncm93T25FbnRlcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodC5hdXRvZ3Jvd09uRW50ZXJEb250Q2xvc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZS50eXBlID09PSAnZm9jdXMnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0LmF1dG9ncm93T25FbnRlcldhc0ZvY3VzZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdC5hdXRvZ3Jvd0VkaXRvck9uRW50ZXIoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICghdC5vLmF1dG9ncm93KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0LiRlZC5jc3MoeyBoZWlnaHQ6IHQuJGVkLmNzcygnbWluLWhlaWdodCcpIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdC4kYy50cmlnZ2VyKCd0YndyZXNpemUnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAub24oJ2N1dCcsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdC5zZW1hbnRpY0NvZGUoZmFsc2UsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0LiRjLnRyaWdnZXIoJ3Rid2NoYW5nZScpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0sIDApO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIC5vbigncGFzdGUnLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0Lm8ucmVtb3ZlZm9ybWF0UGFzdGVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh3aW5kb3cuZ2V0U2VsZWN0aW9uICYmIHdpbmRvdy5nZXRTZWxlY3Rpb24oKS5kZWxldGVGcm9tRG9jdW1lbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5nZXRTZWxlY3Rpb24oKS5kZWxldGVGcm9tRG9jdW1lbnQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIElFXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdGV4dCA9IHdpbmRvdy5jbGlwYm9hcmREYXRhLmdldERhdGEoJ1RleHQnKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIDw9IElFMTBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0LmRvYy5zZWxlY3Rpb24uY3JlYXRlUmFuZ2UoKS5wYXN0ZUhUTUwodGV4dCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChjKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gSUUgMTFcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0LmRvYy5nZXRTZWxlY3Rpb24oKS5nZXRSYW5nZUF0KDApLmluc2VydE5vZGUodC5kb2MuY3JlYXRlVGV4dE5vZGUodGV4dCkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdC4kYy50cmlnZ2VyKCd0YndjaGFuZ2UnLCBlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gTm90IElFXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0LmV4ZWNDbWQoJ2luc2VydFRleHQnLCAoZS5vcmlnaW5hbEV2ZW50IHx8IGUpLmNsaXBib2FyZERhdGEuZ2V0RGF0YSgndGV4dC9wbGFpbicpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gQ2FsbCBwYXN0ZUhhbmRsZXJzXHJcbiAgICAgICAgICAgICAgICAgICAgJC5lYWNoKHQucGFzdGVIYW5kbGVycywgZnVuY3Rpb24gKGksIHBhc3RlSGFuZGxlcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwYXN0ZUhhbmRsZXIoZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0LnNlbWFudGljQ29kZShmYWxzZSwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHQuJGMudHJpZ2dlcigndGJ3cGFzdGUnLCBlKTtcclxuICAgICAgICAgICAgICAgICAgICB9LCAwKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgdC4kdGFcclxuICAgICAgICAgICAgICAgIC5vbigna2V5dXAnLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdC4kYy50cmlnZ2VyKCd0YndjaGFuZ2UnKTtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAub24oJ3Bhc3RlJywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0LiRjLnRyaWdnZXIoJ3Rid2NoYW5nZScpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0sIDApO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICB0LiRib3gub24oJ2tleWRvd24nLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGUud2hpY2ggPT09IDI3ICYmICQoJy4nICsgcHJlZml4ICsgJ21vZGFsLWJveCcsIHQuJGJveCkubGVuZ3RoID09PSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdC5jbG9zZU1vZGFsKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICAvL2F1dG9ncm93IHdoZW4gZW50ZXJpbmcgbG9naWNcclxuICAgICAgICBhdXRvZ3Jvd0VkaXRvck9uRW50ZXI6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyIHQgPSB0aGlzO1xyXG4gICAgICAgICAgICB0LiRlZC5yZW1vdmVDbGFzcygnYXV0b2dyb3ctb24tZW50ZXInKTtcclxuICAgICAgICAgICAgdmFyIG9sZEhlaWdodCA9IHQuJGVkWzBdLmNsaWVudEhlaWdodDtcclxuICAgICAgICAgICAgdC4kZWQuaGVpZ2h0KCdhdXRvJyk7XHJcbiAgICAgICAgICAgIHZhciB0b3RhbEhlaWdodCA9IHQuJGVkWzBdLnNjcm9sbEhlaWdodDtcclxuICAgICAgICAgICAgdC4kZWQuYWRkQ2xhc3MoJ2F1dG9ncm93LW9uLWVudGVyJyk7XHJcbiAgICAgICAgICAgIGlmIChvbGRIZWlnaHQgIT09IHRvdGFsSGVpZ2h0KSB7XHJcbiAgICAgICAgICAgICAgICB0LiRlZC5oZWlnaHQob2xkSGVpZ2h0KTtcclxuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHQuJGVkLmNzcyh7IGhlaWdodDogdG90YWxIZWlnaHQgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdC4kYy50cmlnZ2VyKCd0YndyZXNpemUnKTtcclxuICAgICAgICAgICAgICAgIH0sIDApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSxcclxuXHJcblxyXG4gICAgICAgIC8vIEJ1aWxkIGJ1dHRvbiBwYW5lLCB1c2Ugby5idG5zIG9wdGlvblxyXG4gICAgICAgIGJ1aWxkQnRuUGFuZTogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2YXIgdCA9IHRoaXMsXHJcbiAgICAgICAgICAgICAgICBwcmVmaXggPSB0Lm8ucHJlZml4O1xyXG5cclxuICAgICAgICAgICAgdmFyICRidG5QYW5lID0gdC4kYnRuUGFuZSA9ICQoJzxkaXYvPicsIHtcclxuICAgICAgICAgICAgICAgIGNsYXNzOiBwcmVmaXggKyAnYnV0dG9uLXBhbmUnXHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgJC5lYWNoKHQuby5idG5zLCBmdW5jdGlvbiAoaSwgYnRuR3JwKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoISQuaXNBcnJheShidG5HcnApKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYnRuR3JwID0gW2J0bkdycF07XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyICRidG5Hcm91cCA9ICQoJzxkaXYvPicsIHtcclxuICAgICAgICAgICAgICAgICAgICBjbGFzczogcHJlZml4ICsgJ2J1dHRvbi1ncm91cCAnICsgKChidG5HcnAuaW5kZXhPZignZnVsbHNjcmVlbicpID49IDApID8gcHJlZml4ICsgJ3JpZ2h0JyA6ICcnKVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAkLmVhY2goYnRuR3JwLCBmdW5jdGlvbiAoaSwgYnRuKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdHJ5IHsgLy8gUHJldmVudCBidWlsZEJ0biBlcnJvclxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodC5pc1N1cHBvcnRlZEJ0bihidG4pKSB7IC8vIEl0J3MgYSBzdXBwb3J0ZWQgYnV0dG9uXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYnRuR3JvdXAuYXBwZW5kKHQuYnVpbGRCdG4oYnRuKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChjKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKCRidG5Hcm91cC5odG1sKCkudHJpbSgpLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAkYnRuUGFuZS5hcHBlbmQoJGJ0bkdyb3VwKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICB0LiRib3gucHJlcGVuZCgkYnRuUGFuZSk7XHJcbiAgICAgICAgfSxcclxuXHJcblxyXG4gICAgICAgIC8vIEJ1aWxkIGEgYnV0dG9uIGFuZCBoaXMgYWN0aW9uXHJcbiAgICAgICAgYnVpbGRCdG46IGZ1bmN0aW9uIChidG5OYW1lKSB7IC8vIGJ0bk5hbWUgaXMgbmFtZSBvZiB0aGUgYnV0dG9uXHJcbiAgICAgICAgICAgIHZhciB0ID0gdGhpcyxcclxuICAgICAgICAgICAgICAgIHByZWZpeCA9IHQuby5wcmVmaXgsXHJcbiAgICAgICAgICAgICAgICBidG4gPSB0LmJ0bnNEZWZbYnRuTmFtZV0sXHJcbiAgICAgICAgICAgICAgICBpc0Ryb3Bkb3duID0gYnRuLmRyb3Bkb3duLFxyXG4gICAgICAgICAgICAgICAgaGFzSWNvbiA9IGJ0bi5oYXNJY29uICE9IG51bGwgPyBidG4uaGFzSWNvbiA6IHRydWUsXHJcbiAgICAgICAgICAgICAgICB0ZXh0RGVmID0gdC5sYW5nW2J0bk5hbWVdIHx8IGJ0bk5hbWUsXHJcblxyXG4gICAgICAgICAgICAgICAgJGJ0biA9ICQoJzxidXR0b24vPicsIHtcclxuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnYnV0dG9uJyxcclxuICAgICAgICAgICAgICAgICAgICBjbGFzczogcHJlZml4ICsgYnRuTmFtZSArICctYnV0dG9uICcgKyAoYnRuLmNsYXNzIHx8ICcnKSArICghaGFzSWNvbiA/ICcgJyArIHByZWZpeCArICd0ZXh0dWFsLWJ1dHRvbicgOiAnJyksXHJcbiAgICAgICAgICAgICAgICAgICAgaHRtbDogdC5oYXNTdmcgJiYgaGFzSWNvbiA/XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICc8c3ZnPjx1c2UgeGxpbms6aHJlZj1cIicgKyB0LnN2Z1BhdGggKyAnIycgKyBwcmVmaXggKyAoYnRuLmljbyB8fCBidG5OYW1lKS5yZXBsYWNlKC8oW0EtWl0rKS9nLCAnLSQxJykudG9Mb3dlckNhc2UoKSArICdcIi8+PC9zdmc+JyA6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHQuaGlkZUJ1dHRvblRleHRzID8gJycgOiAoYnRuLnRleHQgfHwgYnRuLnRpdGxlIHx8IHQubGFuZ1tidG5OYW1lXSB8fCBidG5OYW1lKSxcclxuICAgICAgICAgICAgICAgICAgICB0aXRsZTogKGJ0bi50aXRsZSB8fCBidG4udGV4dCB8fCB0ZXh0RGVmKSArICgoYnRuLmtleSkgPyAnIChDdHJsICsgJyArIGJ0bi5rZXkgKyAnKScgOiAnJyksXHJcbiAgICAgICAgICAgICAgICAgICAgdGFiaW5kZXg6IC0xLFxyXG4gICAgICAgICAgICAgICAgICAgIG1vdXNlZG93bjogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWlzRHJvcGRvd24gfHwgJCgnLicgKyBidG5OYW1lICsgJy0nICsgcHJlZml4ICsgJ2Ryb3Bkb3duJywgdC4kYm94KS5pcygnOmhpZGRlbicpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCdib2R5JywgdC5kb2MpLnRyaWdnZXIoJ21vdXNlZG93bicpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoKHQuJGJ0blBhbmUuaGFzQ2xhc3MocHJlZml4ICsgJ2Rpc2FibGUnKSB8fCB0LiRib3guaGFzQ2xhc3MocHJlZml4ICsgJ2Rpc2FibGVkJykpICYmXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAhJCh0aGlzKS5oYXNDbGFzcyhwcmVmaXggKyAnYWN0aXZlJykgJiZcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICEkKHRoaXMpLmhhc0NsYXNzKHByZWZpeCArICdub3QtZGlzYWJsZScpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHQuZXhlY0NtZCgoaXNEcm9wZG93biA/ICdkcm9wZG93bicgOiBmYWxzZSkgfHwgYnRuLmZuIHx8IGJ0bk5hbWUsIGJ0bi5wYXJhbSB8fCBidG5OYW1lLCBidG4uZm9yY2VDc3MpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgaWYgKGlzRHJvcGRvd24pIHtcclxuICAgICAgICAgICAgICAgICRidG4uYWRkQ2xhc3MocHJlZml4ICsgJ29wZW4tZHJvcGRvd24nKTtcclxuICAgICAgICAgICAgICAgIHZhciBkcm9wZG93blByZWZpeCA9IHByZWZpeCArICdkcm9wZG93bicsXHJcbiAgICAgICAgICAgICAgICAgICAgZHJvcGRvd25PcHRpb25zID0geyAvLyB0aGUgZHJvcGRvd25cclxuICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3M6IGRyb3Bkb3duUHJlZml4ICsgJy0nICsgYnRuTmFtZSArICcgJyArIGRyb3Bkb3duUHJlZml4ICsgJyAnICsgcHJlZml4ICsgJ2ZpeGVkLXRvcCdcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgZHJvcGRvd25PcHRpb25zWydkYXRhLScgKyBkcm9wZG93blByZWZpeF0gPSBidG5OYW1lO1xyXG4gICAgICAgICAgICAgICAgdmFyICRkcm9wZG93biA9ICQoJzxkaXYvPicsIGRyb3Bkb3duT3B0aW9ucyk7XHJcbiAgICAgICAgICAgICAgICAkLmVhY2goaXNEcm9wZG93biwgZnVuY3Rpb24gKGksIGRlZikge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0LmJ0bnNEZWZbZGVmXSAmJiB0LmlzU3VwcG9ydGVkQnRuKGRlZikpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJGRyb3Bkb3duLmFwcGVuZCh0LmJ1aWxkU3ViQnRuKGRlZikpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgdC4kYm94LmFwcGVuZCgkZHJvcGRvd24uaGlkZSgpKTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChidG4ua2V5KSB7XHJcbiAgICAgICAgICAgICAgICB0LmtleXNbYnRuLmtleV0gPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZm46IGJ0bi5mbiB8fCBidG5OYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgIHBhcmFtOiBidG4ucGFyYW0gfHwgYnRuTmFtZVxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKCFpc0Ryb3Bkb3duKSB7XHJcbiAgICAgICAgICAgICAgICB0LnRhZ1RvQnV0dG9uWyhidG4udGFnIHx8IGJ0bk5hbWUpLnRvTG93ZXJDYXNlKCldID0gYnRuTmFtZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuICRidG47XHJcbiAgICAgICAgfSxcclxuICAgICAgICAvLyBCdWlsZCBhIGJ1dHRvbiBmb3IgZHJvcGRvd24gbWVudVxyXG4gICAgICAgIC8vIEBwYXJhbSBuIDogbmFtZSBvZiB0aGUgc3ViYnV0dG9uXHJcbiAgICAgICAgYnVpbGRTdWJCdG46IGZ1bmN0aW9uIChidG5OYW1lKSB7XHJcbiAgICAgICAgICAgIHZhciB0ID0gdGhpcyxcclxuICAgICAgICAgICAgICAgIHByZWZpeCA9IHQuby5wcmVmaXgsXHJcbiAgICAgICAgICAgICAgICBidG4gPSB0LmJ0bnNEZWZbYnRuTmFtZV0sXHJcbiAgICAgICAgICAgICAgICBoYXNJY29uID0gYnRuLmhhc0ljb24gIT0gbnVsbCA/IGJ0bi5oYXNJY29uIDogdHJ1ZTtcclxuXHJcbiAgICAgICAgICAgIGlmIChidG4ua2V5KSB7XHJcbiAgICAgICAgICAgICAgICB0LmtleXNbYnRuLmtleV0gPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZm46IGJ0bi5mbiB8fCBidG5OYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgIHBhcmFtOiBidG4ucGFyYW0gfHwgYnRuTmFtZVxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdC50YWdUb0J1dHRvblsoYnRuLnRhZyB8fCBidG5OYW1lKS50b0xvd2VyQ2FzZSgpXSA9IGJ0bk5hbWU7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gJCgnPGJ1dHRvbi8+Jywge1xyXG4gICAgICAgICAgICAgICAgdHlwZTogJ2J1dHRvbicsXHJcbiAgICAgICAgICAgICAgICBjbGFzczogcHJlZml4ICsgYnRuTmFtZSArICctZHJvcGRvd24tYnV0dG9uJyArIChidG4uaWNvID8gJyAnICsgcHJlZml4ICsgYnRuLmljbyArICctYnV0dG9uJyA6ICcnKSxcclxuICAgICAgICAgICAgICAgIGh0bWw6IHQuaGFzU3ZnICYmIGhhc0ljb24gPyAnPHN2Zz48dXNlIHhsaW5rOmhyZWY9XCInICsgdC5zdmdQYXRoICsgJyMnICsgcHJlZml4ICsgKGJ0bi5pY28gfHwgYnRuTmFtZSkucmVwbGFjZSgvKFtBLVpdKykvZywgJy0kMScpLnRvTG93ZXJDYXNlKCkgKyAnXCIvPjwvc3ZnPicgKyAoYnRuLnRleHQgfHwgYnRuLnRpdGxlIHx8IHQubGFuZ1tidG5OYW1lXSB8fCBidG5OYW1lKSA6IChidG4udGV4dCB8fCBidG4udGl0bGUgfHwgdC5sYW5nW2J0bk5hbWVdIHx8IGJ0bk5hbWUpLFxyXG4gICAgICAgICAgICAgICAgdGl0bGU6ICgoYnRuLmtleSkgPyAnIChDdHJsICsgJyArIGJ0bi5rZXkgKyAnKScgOiBudWxsKSxcclxuICAgICAgICAgICAgICAgIHN0eWxlOiBidG4uc3R5bGUgfHwgbnVsbCxcclxuICAgICAgICAgICAgICAgIG1vdXNlZG93bjogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICQoJ2JvZHknLCB0LmRvYykudHJpZ2dlcignbW91c2Vkb3duJyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHQuZXhlY0NtZChidG4uZm4gfHwgYnRuTmFtZSwgYnRuLnBhcmFtIHx8IGJ0bk5hbWUsIGJ0bi5mb3JjZUNzcyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICAvLyBDaGVjayBpZiBidXR0b24gaXMgc3VwcG9ydGVkXHJcbiAgICAgICAgaXNTdXBwb3J0ZWRCdG46IGZ1bmN0aW9uIChiKSB7XHJcbiAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5idG5zRGVmW2JdLmlzU3VwcG9ydGVkKCk7XHJcbiAgICAgICAgICAgIH0gY2F0Y2ggKGMpIHtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICAvLyBCdWlsZCBvdmVybGF5IGZvciBtb2RhbCBib3hcclxuICAgICAgICBidWlsZE92ZXJsYXk6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyIHQgPSB0aGlzO1xyXG4gICAgICAgICAgICB0LiRvdmVybGF5ID0gJCgnPGRpdi8+Jywge1xyXG4gICAgICAgICAgICAgICAgY2xhc3M6IHQuby5wcmVmaXggKyAnb3ZlcmxheSdcclxuICAgICAgICAgICAgfSkuYXBwZW5kVG8odC4kYm94KTtcclxuICAgICAgICAgICAgcmV0dXJuIHQuJG92ZXJsYXk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBzaG93T3ZlcmxheTogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2YXIgdCA9IHRoaXM7XHJcbiAgICAgICAgICAgICQod2luZG93KS50cmlnZ2VyKCdzY3JvbGwnKTtcclxuICAgICAgICAgICAgdC4kb3ZlcmxheS5mYWRlSW4oMjAwKTtcclxuICAgICAgICAgICAgdC4kYm94LmFkZENsYXNzKHQuby5wcmVmaXggKyAnYm94LWJsdXInKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGhpZGVPdmVybGF5OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciB0ID0gdGhpcztcclxuICAgICAgICAgICAgdC4kb3ZlcmxheS5mYWRlT3V0KDUwKTtcclxuICAgICAgICAgICAgdC4kYm94LnJlbW92ZUNsYXNzKHQuby5wcmVmaXggKyAnYm94LWJsdXInKTtcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICAvLyBNYW5hZ2VtZW50IG9mIGZpeGVkIGJ1dHRvbiBwYW5lXHJcbiAgICAgICAgZml4ZWRCdG5QYW5lRXZlbnRzOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciB0ID0gdGhpcyxcclxuICAgICAgICAgICAgICAgIGZpeGVkRnVsbFdpZHRoID0gdC5vLmZpeGVkRnVsbFdpZHRoLFxyXG4gICAgICAgICAgICAgICAgJGJveCA9IHQuJGJveDtcclxuXHJcbiAgICAgICAgICAgIGlmICghdC5vLmZpeGVkQnRuUGFuZSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0LmlzRml4ZWQgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgICAgICQod2luZG93KVxyXG4gICAgICAgICAgICAgICAgLm9uKCdzY3JvbGwuJyArIHQuZXZlbnROYW1lc3BhY2UgKyAnIHJlc2l6ZS4nICsgdC5ldmVudE5hbWVzcGFjZSwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghJGJveCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICB0LnN5bmNDb2RlKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBzY3JvbGxUb3AgPSAkKHdpbmRvdykuc2Nyb2xsVG9wKCksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9mZnNldCA9ICRib3gub2Zmc2V0KCkudG9wICsgMSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnAgPSB0LiRidG5QYW5lLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBvaCA9IGJwLm91dGVySGVpZ2h0KCkgLSAyO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoKHNjcm9sbFRvcCAtIG9mZnNldCA+IDApICYmICgoc2Nyb2xsVG9wIC0gb2Zmc2V0IC0gdC5oZWlnaHQpIDwgMCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0LmlzRml4ZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQuaXNGaXhlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicC5jc3Moe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAnZml4ZWQnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvcDogMCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZWZ0OiBmaXhlZEZ1bGxXaWR0aCA/ICcwJyA6ICdhdXRvJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB6SW5kZXg6IDdcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJChbdC4kdGEsIHQuJGVkXSkuY3NzKHsgbWFyZ2luVG9wOiBicC5oZWlnaHQoKSB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBicC5jc3Moe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IGZpeGVkRnVsbFdpZHRoID8gJzEwMCUnIDogKCgkYm94LndpZHRoKCkgLSAxKSArICdweCcpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgJCgnLicgKyB0Lm8ucHJlZml4ICsgJ2ZpeGVkLXRvcCcsICRib3gpLmNzcyh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogZml4ZWRGdWxsV2lkdGggPyAnZml4ZWQnIDogJ2Fic29sdXRlJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvcDogZml4ZWRGdWxsV2lkdGggPyBvaCA6IG9oICsgKHNjcm9sbFRvcCAtIG9mZnNldCkgKyAncHgnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgekluZGV4OiAxNVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHQuaXNGaXhlZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0LmlzRml4ZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnAucmVtb3ZlQXR0cignc3R5bGUnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJChbdC4kdGEsIHQuJGVkXSkuY3NzKHsgbWFyZ2luVG9wOiAwIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkKCcuJyArIHQuby5wcmVmaXggKyAnZml4ZWQtdG9wJywgJGJveCkuY3NzKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAnYWJzb2x1dGUnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9wOiBvaFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICAvLyBEaXNhYmxlIGVkaXRvclxyXG4gICAgICAgIHNldERpc2FibGVkOiBmdW5jdGlvbiAoZGlzYWJsZSkge1xyXG4gICAgICAgICAgICB2YXIgdCA9IHRoaXMsXHJcbiAgICAgICAgICAgICAgICBwcmVmaXggPSB0Lm8ucHJlZml4O1xyXG5cclxuICAgICAgICAgICAgdC5kaXNhYmxlZCA9IGRpc2FibGU7XHJcblxyXG4gICAgICAgICAgICBpZiAoZGlzYWJsZSkge1xyXG4gICAgICAgICAgICAgICAgdC4kdGEuYXR0cignZGlzYWJsZWQnLCB0cnVlKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHQuJHRhLnJlbW92ZUF0dHIoJ2Rpc2FibGVkJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdC4kYm94LnRvZ2dsZUNsYXNzKHByZWZpeCArICdkaXNhYmxlZCcsIGRpc2FibGUpO1xyXG4gICAgICAgICAgICB0LiRlZC5hdHRyKCdjb250ZW50ZWRpdGFibGUnLCAhZGlzYWJsZSk7XHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgLy8gRGVzdHJveSB0aGUgZWRpdG9yXHJcbiAgICAgICAgZGVzdHJveTogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2YXIgdCA9IHRoaXMsXHJcbiAgICAgICAgICAgICAgICBwcmVmaXggPSB0Lm8ucHJlZml4O1xyXG5cclxuICAgICAgICAgICAgaWYgKHQuaXNUZXh0YXJlYSkge1xyXG4gICAgICAgICAgICAgICAgdC4kYm94LmFmdGVyKFxyXG4gICAgICAgICAgICAgICAgICAgIHQuJHRhXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5jc3MoeyBoZWlnaHQ6ICcnIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC52YWwodC5odG1sKCkpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5yZW1vdmVDbGFzcyhwcmVmaXggKyAndGV4dGFyZWEnKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuc2hvdygpXHJcbiAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdC4kYm94LmFmdGVyKFxyXG4gICAgICAgICAgICAgICAgICAgIHQuJGVkXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5jc3MoeyBoZWlnaHQ6ICcnIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5yZW1vdmVDbGFzcyhwcmVmaXggKyAnZWRpdG9yJylcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnJlbW92ZUF0dHIoJ2NvbnRlbnRlZGl0YWJsZScpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5yZW1vdmVBdHRyKCdkaXInKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuaHRtbCh0Lmh0bWwoKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnNob3coKVxyXG4gICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdC4kZWQub2ZmKCdkYmxjbGljaycsICdpbWcnKTtcclxuXHJcbiAgICAgICAgICAgIHQuZGVzdHJveVBsdWdpbnMoKTtcclxuXHJcbiAgICAgICAgICAgIHQuJGJveC5yZW1vdmUoKTtcclxuICAgICAgICAgICAgdC4kYy5yZW1vdmVEYXRhKCd0cnVtYm93eWcnKTtcclxuICAgICAgICAgICAgJCgnYm9keScpLnJlbW92ZUNsYXNzKHByZWZpeCArICdib2R5LWZ1bGxzY3JlZW4nKTtcclxuICAgICAgICAgICAgdC4kYy50cmlnZ2VyKCd0YndjbG9zZScpO1xyXG4gICAgICAgICAgICAkKHdpbmRvdykub2ZmKCdzY3JvbGwuJyArIHQuZXZlbnROYW1lc3BhY2UgKyAnIHJlc2l6ZS4nICsgdC5ldmVudE5hbWVzcGFjZSk7XHJcbiAgICAgICAgfSxcclxuXHJcblxyXG4gICAgICAgIC8vIEVtcHR5IHRoZSBlZGl0b3JcclxuICAgICAgICBlbXB0eTogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB0aGlzLiR0YS52YWwoJycpO1xyXG4gICAgICAgICAgICB0aGlzLnN5bmNDb2RlKHRydWUpO1xyXG4gICAgICAgIH0sXHJcblxyXG5cclxuICAgICAgICAvLyBGdW5jdGlvbiBjYWxsIHdoZW4gY2xpY2sgb24gdmlld0hUTUwgYnV0dG9uXHJcbiAgICAgICAgdG9nZ2xlOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciB0ID0gdGhpcyxcclxuICAgICAgICAgICAgICAgIHByZWZpeCA9IHQuby5wcmVmaXg7XHJcblxyXG4gICAgICAgICAgICBpZiAodC5vLmF1dG9ncm93T25FbnRlcikge1xyXG4gICAgICAgICAgICAgICAgdC5hdXRvZ3Jvd09uRW50ZXJEb250Q2xvc2UgPSAhdC4kYm94Lmhhc0NsYXNzKHByZWZpeCArICdlZGl0b3ItaGlkZGVuJyk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHQuc2VtYW50aWNDb2RlKGZhbHNlLCB0cnVlKTtcclxuXHJcbiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgdC5kb2MuYWN0aXZlRWxlbWVudC5ibHVyKCk7XHJcbiAgICAgICAgICAgICAgICB0LiRib3gudG9nZ2xlQ2xhc3MocHJlZml4ICsgJ2VkaXRvci1oaWRkZW4gJyArIHByZWZpeCArICdlZGl0b3ItdmlzaWJsZScpO1xyXG4gICAgICAgICAgICAgICAgdC4kYnRuUGFuZS50b2dnbGVDbGFzcyhwcmVmaXggKyAnZGlzYWJsZScpO1xyXG4gICAgICAgICAgICAgICAgJCgnLicgKyBwcmVmaXggKyAndmlld0hUTUwtYnV0dG9uJywgdC4kYnRuUGFuZSkudG9nZ2xlQ2xhc3MocHJlZml4ICsgJ2FjdGl2ZScpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHQuJGJveC5oYXNDbGFzcyhwcmVmaXggKyAnZWRpdG9yLXZpc2libGUnKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHQuJHRhLmF0dHIoJ3RhYmluZGV4JywgLTEpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB0LiR0YS5yZW1vdmVBdHRyKCd0YWJpbmRleCcpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmICh0Lm8uYXV0b2dyb3dPbkVudGVyICYmICF0LmF1dG9ncm93T25FbnRlckRvbnRDbG9zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHQuYXV0b2dyb3dFZGl0b3JPbkVudGVyKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sIDApO1xyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIC8vIE9wZW4gZHJvcGRvd24gd2hlbiBjbGljayBvbiBhIGJ1dHRvbiB3aGljaCBvcGVuIHRoYXRcclxuICAgICAgICBkcm9wZG93bjogZnVuY3Rpb24gKG5hbWUpIHtcclxuICAgICAgICAgICAgdmFyIHQgPSB0aGlzLFxyXG4gICAgICAgICAgICAgICAgZCA9IHQuZG9jLFxyXG4gICAgICAgICAgICAgICAgcHJlZml4ID0gdC5vLnByZWZpeCxcclxuICAgICAgICAgICAgICAgICRkcm9wZG93biA9ICQoJ1tkYXRhLScgKyBwcmVmaXggKyAnZHJvcGRvd249JyArIG5hbWUgKyAnXScsIHQuJGJveCksXHJcbiAgICAgICAgICAgICAgICAkYnRuID0gJCgnLicgKyBwcmVmaXggKyBuYW1lICsgJy1idXR0b24nLCB0LiRidG5QYW5lKSxcclxuICAgICAgICAgICAgICAgIHNob3cgPSAkZHJvcGRvd24uaXMoJzpoaWRkZW4nKTtcclxuXHJcbiAgICAgICAgICAgICQoJ2JvZHknLCBkKS50cmlnZ2VyKCdtb3VzZWRvd24nKTtcclxuXHJcbiAgICAgICAgICAgIGlmIChzaG93KSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgbyA9ICRidG4ub2Zmc2V0KCkubGVmdDtcclxuICAgICAgICAgICAgICAgICRidG4uYWRkQ2xhc3MocHJlZml4ICsgJ2FjdGl2ZScpO1xyXG5cclxuICAgICAgICAgICAgICAgICRkcm9wZG93bi5jc3Moe1xyXG4gICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAnYWJzb2x1dGUnLFxyXG4gICAgICAgICAgICAgICAgICAgIHRvcDogJGJ0bi5vZmZzZXQoKS50b3AgLSB0LiRidG5QYW5lLm9mZnNldCgpLnRvcCArICRidG4ub3V0ZXJIZWlnaHQoKSxcclxuICAgICAgICAgICAgICAgICAgICBsZWZ0OiAodC5vLmZpeGVkRnVsbFdpZHRoICYmIHQuaXNGaXhlZCkgPyBvICsgJ3B4JyA6IChvIC0gdC4kYnRuUGFuZS5vZmZzZXQoKS5sZWZ0KSArICdweCdcclxuICAgICAgICAgICAgICAgIH0pLnNob3coKTtcclxuXHJcbiAgICAgICAgICAgICAgICAkKHdpbmRvdykudHJpZ2dlcignc2Nyb2xsJyk7XHJcblxyXG4gICAgICAgICAgICAgICAgJCgnYm9keScsIGQpLm9uKCdtb3VzZWRvd24uJyArIHQuZXZlbnROYW1lc3BhY2UsIGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCEkZHJvcGRvd24uaXMoZS50YXJnZXQpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJy4nICsgcHJlZml4ICsgJ2Ryb3Bkb3duJywgdC4kYm94KS5oaWRlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJy4nICsgcHJlZml4ICsgJ2FjdGl2ZScsIHQuJGJ0blBhbmUpLnJlbW92ZUNsYXNzKHByZWZpeCArICdhY3RpdmUnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJCgnYm9keScsIGQpLm9mZignbW91c2Vkb3duLicgKyB0LmV2ZW50TmFtZXNwYWNlKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sXHJcblxyXG5cclxuICAgICAgICAvLyBIVE1MIENvZGUgbWFuYWdlbWVudFxyXG4gICAgICAgIGh0bWw6IGZ1bmN0aW9uIChodG1sKSB7XHJcbiAgICAgICAgICAgIHZhciB0ID0gdGhpcztcclxuXHJcbiAgICAgICAgICAgIGlmIChodG1sICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIHQuJHRhLnZhbChodG1sKTtcclxuICAgICAgICAgICAgICAgIHQuc3luY0NvZGUodHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICB0LiRjLnRyaWdnZXIoJ3Rid2NoYW5nZScpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHQ7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiB0LiR0YS52YWwoKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIHN5bmNUZXh0YXJlYTogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2YXIgdCA9IHRoaXM7XHJcbiAgICAgICAgICAgIHQuJHRhLnZhbCh0LiRlZC50ZXh0KCkudHJpbSgpLmxlbmd0aCA+IDAgfHwgdC4kZWQuZmluZCgnaHIsaW1nLGVtYmVkLGlmcmFtZSxpbnB1dCcpLmxlbmd0aCA+IDAgPyB0LiRlZC5odG1sKCkgOiAnJyk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBzeW5jQ29kZTogZnVuY3Rpb24gKGZvcmNlKSB7XHJcbiAgICAgICAgICAgIHZhciB0ID0gdGhpcztcclxuICAgICAgICAgICAgaWYgKCFmb3JjZSAmJiB0LiRlZC5pcygnOnZpc2libGUnKSkge1xyXG4gICAgICAgICAgICAgICAgdC5zeW5jVGV4dGFyZWEoKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIC8vIHdyYXAgdGhlIGNvbnRlbnQgaW4gYSBkaXYgaXQncyBlYXNpZXIgdG8gZ2V0IHRoZSBpbm5lcmh0bWxcclxuICAgICAgICAgICAgICAgIHZhciBodG1sID0gJCgnPGRpdj4nKS5odG1sKHQuJHRhLnZhbCgpKTtcclxuICAgICAgICAgICAgICAgIC8vc2NydWIgdGhlIGh0bWwgYmVmb3JlIGxvYWRpbmcgaW50byB0aGUgZG9jXHJcbiAgICAgICAgICAgICAgICB2YXIgc2FmZSA9ICQoJzxkaXY+JykuYXBwZW5kKGh0bWwpO1xyXG4gICAgICAgICAgICAgICAgJCh0Lm8udGFnc1RvUmVtb3ZlLmpvaW4oJywnKSwgc2FmZSkucmVtb3ZlKCk7XHJcbiAgICAgICAgICAgICAgICB0LiRlZC5odG1sKHNhZmUuY29udGVudHMoKS5odG1sKCkpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAodC5vLmF1dG9ncm93KSB7XHJcbiAgICAgICAgICAgICAgICB0LmhlaWdodCA9IHQuJGVkLmhlaWdodCgpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHQuaGVpZ2h0ICE9PSB0LiR0YS5jc3MoJ2hlaWdodCcpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdC4kdGEuY3NzKHsgaGVpZ2h0OiB0LmhlaWdodCB9KTtcclxuICAgICAgICAgICAgICAgICAgICB0LiRjLnRyaWdnZXIoJ3Rid3Jlc2l6ZScpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh0Lm8uYXV0b2dyb3dPbkVudGVyKSB7XHJcbiAgICAgICAgICAgICAgICAvLyB0LmF1dG9ncm93RWRpdG9yT25FbnRlcigpO1xyXG4gICAgICAgICAgICAgICAgdC4kZWQuaGVpZ2h0KCdhdXRvJyk7XHJcbiAgICAgICAgICAgICAgICB2YXIgdG90YWxoZWlnaHQgPSB0LmF1dG9ncm93T25FbnRlcldhc0ZvY3VzZWQgPyB0LiRlZFswXS5zY3JvbGxIZWlnaHQgOiB0LiRlZC5jc3MoJ21pbi1oZWlnaHQnKTtcclxuICAgICAgICAgICAgICAgIGlmICh0b3RhbGhlaWdodCAhPT0gdC4kdGEuY3NzKCdoZWlnaHQnKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHQuJGVkLmNzcyh7IGhlaWdodDogdG90YWxoZWlnaHQgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdC4kYy50cmlnZ2VyKCd0YndyZXNpemUnKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIC8vIEFuYWx5c2UgYW5kIHVwZGF0ZSB0byBzZW1hbnRpYyBjb2RlXHJcbiAgICAgICAgLy8gQHBhcmFtIGZvcmNlIDogZm9yY2UgdG8gc3luYyBjb2RlIGZyb20gdGV4dGFyZWFcclxuICAgICAgICAvLyBAcGFyYW0gZnVsbCAgOiB3cmFwIHRleHQgbm9kZXMgaW4gPHA+XHJcbiAgICAgICAgLy8gQHBhcmFtIGtlZXBSYW5nZSAgOiBsZWF2ZSBzZWxlY3Rpb24gcmFuZ2UgYXMgaXQgaXNcclxuICAgICAgICBzZW1hbnRpY0NvZGU6IGZ1bmN0aW9uIChmb3JjZSwgZnVsbCwga2VlcFJhbmdlKSB7XHJcbiAgICAgICAgICAgIHZhciB0ID0gdGhpcztcclxuICAgICAgICAgICAgdC5zYXZlUmFuZ2UoKTtcclxuICAgICAgICAgICAgdC5zeW5jQ29kZShmb3JjZSk7XHJcblxyXG4gICAgICAgICAgICBpZiAodC5vLnNlbWFudGljKSB7XHJcbiAgICAgICAgICAgICAgICB0LnNlbWFudGljVGFnKCdiJyk7XHJcbiAgICAgICAgICAgICAgICB0LnNlbWFudGljVGFnKCdpJyk7XHJcbiAgICAgICAgICAgICAgICB0LnNlbWFudGljVGFnKCdzJyk7XHJcbiAgICAgICAgICAgICAgICB0LnNlbWFudGljVGFnKCdzdHJpa2UnKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoZnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBpbmxpbmVFbGVtZW50c1NlbGVjdG9yID0gdC5vLmlubGluZUVsZW1lbnRzU2VsZWN0b3IsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJsb2NrRWxlbWVudHNTZWxlY3RvciA9ICc6bm90KCcgKyBpbmxpbmVFbGVtZW50c1NlbGVjdG9yICsgJyknO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyBXcmFwIHRleHQgbm9kZXMgaW4gc3BhbiBmb3IgZWFzaWVyIHByb2Nlc3NpbmdcclxuICAgICAgICAgICAgICAgICAgICB0LiRlZC5jb250ZW50cygpLmZpbHRlcihmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLm5vZGVUeXBlID09PSAzICYmIHRoaXMubm9kZVZhbHVlLnRyaW0oKS5sZW5ndGggPiAwO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pLndyYXAoJzxzcGFuIGRhdGEtdGJ3Lz4nKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gV3JhcCBncm91cHMgb2YgaW5saW5lIGVsZW1lbnRzIGluIHBhcmFncmFwaHMgKHJlY3Vyc2l2ZSlcclxuICAgICAgICAgICAgICAgICAgICB2YXIgd3JhcElubGluZXNJblBhcmFncmFwaHNGcm9tID0gZnVuY3Rpb24gKCRmcm9tKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkZnJvbS5sZW5ndGggIT09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciAkZmluYWxQYXJhZ3JhcGggPSAkZnJvbS5uZXh0VW50aWwoYmxvY2tFbGVtZW50c1NlbGVjdG9yKS5hZGRCYWNrKCkud3JhcEFsbCgnPHAvPicpLnBhcmVudCgpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRuZXh0RWxlbWVudCA9ICRmaW5hbFBhcmFncmFwaC5uZXh0QWxsKGlubGluZUVsZW1lbnRzU2VsZWN0b3IpLmZpcnN0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZmluYWxQYXJhZ3JhcGgubmV4dCgnYnInKS5yZW1vdmUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdyYXBJbmxpbmVzSW5QYXJhZ3JhcGhzRnJvbSgkbmV4dEVsZW1lbnQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICB3cmFwSW5saW5lc0luUGFyYWdyYXBoc0Zyb20odC4kZWQuY2hpbGRyZW4oaW5saW5lRWxlbWVudHNTZWxlY3RvcikuZmlyc3QoKSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHQuc2VtYW50aWNUYWcoJ2RpdicsIHRydWUpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyBVbndyYXAgcGFyYWdyYXBocyBjb250ZW50LCBjb250YWluaW5nIG5vdGhpbmcgdXNlZnVsbFxyXG4gICAgICAgICAgICAgICAgICAgIHQuJGVkLmZpbmQoJ3AnKS5maWx0ZXIoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBEb24ndCByZW1vdmUgY3VycmVudGx5IGJlaW5nIGVkaXRlZCBlbGVtZW50XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0LnJhbmdlICYmIHRoaXMgPT09IHQucmFuZ2Uuc3RhcnRDb250YWluZXIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJCh0aGlzKS50ZXh0KCkudHJpbSgpLmxlbmd0aCA9PT0gMCAmJiAkKHRoaXMpLmNoaWxkcmVuKCkubm90KCdicixzcGFuJykubGVuZ3RoID09PSAwO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pLmNvbnRlbnRzKCkudW53cmFwKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIEdldCByaWQgb2YgdGVtcG9yaWFsIHNwYW4nc1xyXG4gICAgICAgICAgICAgICAgICAgICQoJ1tkYXRhLXRid10nLCB0LiRlZCkuY29udGVudHMoKS51bndyYXAoKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gUmVtb3ZlIGVtcHR5IDxwPlxyXG4gICAgICAgICAgICAgICAgICAgIHQuJGVkLmZpbmQoJ3A6ZW1wdHknKS5yZW1vdmUoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoIWtlZXBSYW5nZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHQucmVzdG9yZVJhbmdlKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgdC5zeW5jVGV4dGFyZWEoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIHNlbWFudGljVGFnOiBmdW5jdGlvbiAob2xkVGFnLCBjb3B5QXR0cmlidXRlcykge1xyXG4gICAgICAgICAgICB2YXIgbmV3VGFnO1xyXG5cclxuICAgICAgICAgICAgaWYgKHRoaXMuby5zZW1hbnRpYyAhPSBudWxsICYmIHR5cGVvZiB0aGlzLm8uc2VtYW50aWMgPT09ICdvYmplY3QnICYmIHRoaXMuby5zZW1hbnRpYy5oYXNPd25Qcm9wZXJ0eShvbGRUYWcpKSB7XHJcbiAgICAgICAgICAgICAgICBuZXdUYWcgPSB0aGlzLm8uc2VtYW50aWNbb2xkVGFnXTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLm8uc2VtYW50aWMgPT09IHRydWUgJiYgdGhpcy5ERUZBVUxUX1NFTUFOVElDX01BUC5oYXNPd25Qcm9wZXJ0eShvbGRUYWcpKSB7XHJcbiAgICAgICAgICAgICAgICBuZXdUYWcgPSB0aGlzLkRFRkFVTFRfU0VNQU5USUNfTUFQW29sZFRhZ107XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICQob2xkVGFnLCB0aGlzLiRlZCkuZWFjaChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgJG9sZFRhZyA9ICQodGhpcyk7XHJcbiAgICAgICAgICAgICAgICAkb2xkVGFnLndyYXAoJzwnICsgbmV3VGFnICsgJy8+Jyk7XHJcbiAgICAgICAgICAgICAgICBpZiAoY29weUF0dHJpYnV0ZXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAkLmVhY2goJG9sZFRhZy5wcm9wKCdhdHRyaWJ1dGVzJyksIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJG9sZFRhZy5wYXJlbnQoKS5hdHRyKHRoaXMubmFtZSwgdGhpcy52YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAkb2xkVGFnLmNvbnRlbnRzKCkudW53cmFwKCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIC8vIEZ1bmN0aW9uIGNhbGwgd2hlbiB1c2VyIGNsaWNrIG9uIFwiSW5zZXJ0IExpbmtcIlxyXG4gICAgICAgIGNyZWF0ZUxpbms6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyIHQgPSB0aGlzLFxyXG4gICAgICAgICAgICAgICAgZG9jdW1lbnRTZWxlY3Rpb24gPSB0LmRvYy5nZXRTZWxlY3Rpb24oKSxcclxuICAgICAgICAgICAgICAgIG5vZGUgPSBkb2N1bWVudFNlbGVjdGlvbi5mb2N1c05vZGUsXHJcbiAgICAgICAgICAgICAgICB0ZXh0ID0gbmV3IFhNTFNlcmlhbGl6ZXIoKS5zZXJpYWxpemVUb1N0cmluZyhkb2N1bWVudFNlbGVjdGlvbi5nZXRSYW5nZUF0KDApLmNsb25lQ29udGVudHMoKSksXHJcbiAgICAgICAgICAgICAgICB1cmwsXHJcbiAgICAgICAgICAgICAgICB0aXRsZSxcclxuICAgICAgICAgICAgICAgIHRhcmdldDtcclxuXHJcbiAgICAgICAgICAgIHdoaWxlIChbJ0EnLCAnRElWJ10uaW5kZXhPZihub2RlLm5vZGVOYW1lKSA8IDApIHtcclxuICAgICAgICAgICAgICAgIG5vZGUgPSBub2RlLnBhcmVudE5vZGU7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChub2RlICYmIG5vZGUubm9kZU5hbWUgPT09ICdBJykge1xyXG4gICAgICAgICAgICAgICAgdmFyICRhID0gJChub2RlKTtcclxuICAgICAgICAgICAgICAgIHRleHQgPSAkYS50ZXh0KCk7XHJcbiAgICAgICAgICAgICAgICB1cmwgPSAkYS5hdHRyKCdocmVmJyk7XHJcbiAgICAgICAgICAgICAgICBpZiAoIXQuby5taW5pbWFsTGlua3MpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aXRsZSA9ICRhLmF0dHIoJ3RpdGxlJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0ID0gJGEuYXR0cigndGFyZ2V0Jyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB2YXIgcmFuZ2UgPSB0LmRvYy5jcmVhdGVSYW5nZSgpO1xyXG4gICAgICAgICAgICAgICAgcmFuZ2Uuc2VsZWN0Tm9kZShub2RlKTtcclxuICAgICAgICAgICAgICAgIGRvY3VtZW50U2VsZWN0aW9uLnJlbW92ZUFsbFJhbmdlcygpO1xyXG4gICAgICAgICAgICAgICAgZG9jdW1lbnRTZWxlY3Rpb24uYWRkUmFuZ2UocmFuZ2UpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0LnNhdmVSYW5nZSgpO1xyXG5cclxuICAgICAgICAgICAgdmFyIG9wdGlvbnMgPSB7XHJcbiAgICAgICAgICAgICAgICB1cmw6IHtcclxuICAgICAgICAgICAgICAgICAgICBsYWJlbDogJ1VSTCcsXHJcbiAgICAgICAgICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHVybFxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIHRleHQ6IHtcclxuICAgICAgICAgICAgICAgICAgICBsYWJlbDogdC5sYW5nLnRleHQsXHJcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRleHRcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgaWYgKCF0Lm8ubWluaW1hbExpbmtzKSB7XHJcbiAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKG9wdGlvbnMsIHtcclxuICAgICAgICAgICAgICAgICAgICB0aXRsZToge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogdC5sYW5nLnRpdGxlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGl0bGVcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIHRhcmdldDoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogdC5sYW5nLnRhcmdldCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRhcmdldFxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0Lm9wZW5Nb2RhbEluc2VydCh0LmxhbmcuY3JlYXRlTGluaywgb3B0aW9ucywgZnVuY3Rpb24gKHYpIHsgLy8gdiBpcyB2YWx1ZVxyXG4gICAgICAgICAgICAgICAgdmFyIHVybCA9IHQucHJlcGVuZFVybFByZWZpeCh2LnVybCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoIXVybC5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIGxpbmsgPSAkKFsnPGEgaHJlZj1cIicsIHYudXJsLCAnXCI+Jywgdi50ZXh0IHx8IHYudXJsLCAnPC9hPiddLmpvaW4oJycpKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoIXQuby5taW5pbWFsTGlua3MpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodi50aXRsZS5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxpbmsuYXR0cigndGl0bGUnLCB2LnRpdGxlKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHYudGFyZ2V0Lmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGluay5hdHRyKCd0YXJnZXQnLCB2LnRhcmdldCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdC5yYW5nZS5kZWxldGVDb250ZW50cygpO1xyXG4gICAgICAgICAgICAgICAgdC5yYW5nZS5pbnNlcnROb2RlKGxpbmtbMF0pO1xyXG4gICAgICAgICAgICAgICAgdC5zeW5jQ29kZSgpO1xyXG4gICAgICAgICAgICAgICAgdC4kYy50cmlnZ2VyKCd0YndjaGFuZ2UnKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIHByZXBlbmRVcmxQcmVmaXg6IGZ1bmN0aW9uICh1cmwpIHtcclxuICAgICAgICAgICAgdmFyIHQgPSB0aGlzO1xyXG4gICAgICAgICAgICBpZiAoIXQudXJsUHJlZml4KSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdXJsO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvL2NvbnN0IFZBTElEX0xJTktfUFJFRklYID0gL14oW2Etel1bLSsuYS16MC05XSo6fFxcL3wjKS9pO1xyXG4gICAgICAgICAgICAvL2lmIChWQUxJRF9MSU5LX1BSRUZJWC50ZXN0KHVybCkpIHtcclxuICAgICAgICAgICAgLy8gICAgcmV0dXJuIHVybDtcclxuICAgICAgICAgICAgLy99XHJcblxyXG4gICAgICAgICAgICAvL2NvbnN0IFNJTVBMRV9FTUFJTF9SRUdFWCA9IC9eW15cXHNAXStAW15cXHNAXStcXC5bXlxcc0BdKyQvO1xyXG4gICAgICAgICAgICAvL2lmIChTSU1QTEVfRU1BSUxfUkVHRVgudGVzdCh1cmwpKSB7XHJcbiAgICAgICAgICAgIC8vICAgIHJldHVybiAnbWFpbHRvOicgKyB1cmw7XHJcbiAgICAgICAgICAgIC8vfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHQudXJsUHJlZml4ICsgdXJsO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgdW5saW5rOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciB0ID0gdGhpcyxcclxuICAgICAgICAgICAgICAgIGRvY3VtZW50U2VsZWN0aW9uID0gdC5kb2MuZ2V0U2VsZWN0aW9uKCksXHJcbiAgICAgICAgICAgICAgICBub2RlID0gZG9jdW1lbnRTZWxlY3Rpb24uZm9jdXNOb2RlO1xyXG5cclxuICAgICAgICAgICAgaWYgKGRvY3VtZW50U2VsZWN0aW9uLmlzQ29sbGFwc2VkKSB7XHJcbiAgICAgICAgICAgICAgICB3aGlsZSAoWydBJywgJ0RJViddLmluZGV4T2Yobm9kZS5ub2RlTmFtZSkgPCAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbm9kZSA9IG5vZGUucGFyZW50Tm9kZTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAobm9kZSAmJiBub2RlLm5vZGVOYW1lID09PSAnQScpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgcmFuZ2UgPSB0LmRvYy5jcmVhdGVSYW5nZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJhbmdlLnNlbGVjdE5vZGUobm9kZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnRTZWxlY3Rpb24ucmVtb3ZlQWxsUmFuZ2VzKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnRTZWxlY3Rpb24uYWRkUmFuZ2UocmFuZ2UpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHQuZXhlY0NtZCgndW5saW5rJywgdW5kZWZpbmVkLCB1bmRlZmluZWQsIHRydWUpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgaW5zZXJ0SW1hZ2U6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyIHQgPSB0aGlzO1xyXG4gICAgICAgICAgICB0LnNhdmVSYW5nZSgpO1xyXG5cclxuICAgICAgICAgICAgdmFyIG9wdGlvbnMgPSB7XHJcbiAgICAgICAgICAgICAgICB1cmw6IHtcclxuICAgICAgICAgICAgICAgICAgICBsYWJlbDogJ1VSTCcsXHJcbiAgICAgICAgICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWVcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBhbHQ6IHtcclxuICAgICAgICAgICAgICAgICAgICBsYWJlbDogdC5sYW5nLmRlc2NyaXB0aW9uLFxyXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0LmdldFJhbmdlVGV4dCgpXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICBpZiAodC5vLmltYWdlV2lkdGhNb2RhbEVkaXQpIHtcclxuICAgICAgICAgICAgICAgIG9wdGlvbnMud2lkdGggPSB7fTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdC5vcGVuTW9kYWxJbnNlcnQodC5sYW5nLmluc2VydEltYWdlLCBvcHRpb25zLCBmdW5jdGlvbiAodikgeyAvLyB2IGFyZSB2YWx1ZXNcclxuICAgICAgICAgICAgICAgIHQuZXhlY0NtZCgnaW5zZXJ0SW1hZ2UnLCB2LnVybCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgJGltZyA9ICQoJ2ltZ1tzcmM9XCInICsgdi51cmwgKyAnXCJdOm5vdChbYWx0XSknLCB0LiRib3gpO1xyXG4gICAgICAgICAgICAgICAgJGltZy5hdHRyKCdhbHQnLCB2LmFsdCk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHQuby5pbWFnZVdpZHRoTW9kYWxFZGl0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJGltZy5hdHRyKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IHYud2lkdGhcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICB0LnN5bmNDb2RlKCk7XHJcbiAgICAgICAgICAgICAgICB0LiRjLnRyaWdnZXIoJ3Rid2NoYW5nZScpO1xyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGZ1bGxzY3JlZW46IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyIHQgPSB0aGlzLFxyXG4gICAgICAgICAgICAgICAgcHJlZml4ID0gdC5vLnByZWZpeCxcclxuICAgICAgICAgICAgICAgIGZ1bGxzY3JlZW5Dc3NDbGFzcyA9IHByZWZpeCArICdmdWxsc2NyZWVuJyxcclxuICAgICAgICAgICAgICAgIGlzRnVsbHNjcmVlbjtcclxuXHJcbiAgICAgICAgICAgIHQuJGJveC50b2dnbGVDbGFzcyhmdWxsc2NyZWVuQ3NzQ2xhc3MpO1xyXG4gICAgICAgICAgICBpc0Z1bGxzY3JlZW4gPSB0LiRib3guaGFzQ2xhc3MoZnVsbHNjcmVlbkNzc0NsYXNzKTtcclxuICAgICAgICAgICAgJCgnYm9keScpLnRvZ2dsZUNsYXNzKHByZWZpeCArICdib2R5LWZ1bGxzY3JlZW4nLCBpc0Z1bGxzY3JlZW4pO1xyXG4gICAgICAgICAgICAkKHdpbmRvdykudHJpZ2dlcignc2Nyb2xsJyk7XHJcbiAgICAgICAgICAgIHQuJGMudHJpZ2dlcigndGJ3JyArIChpc0Z1bGxzY3JlZW4gPyAnb3BlbicgOiAnY2xvc2UnKSArICdmdWxsc2NyZWVuJyk7XHJcbiAgICAgICAgfSxcclxuXHJcblxyXG4gICAgICAgIC8qXHJcbiAgICAgICAgICogQ2FsbCBtZXRob2Qgb2YgdHJ1bWJvd3lnIGlmIGV4aXN0XHJcbiAgICAgICAgICogZWxzZSB0cnkgdG8gY2FsbCBhbm9ueW1vdXMgZnVuY3Rpb25cclxuICAgICAgICAgKiBhbmQgZmluYWx5IG5hdGl2ZSBleGVjQ29tbWFuZFxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIGV4ZWNDbWQ6IGZ1bmN0aW9uIChjbWQsIHBhcmFtLCBmb3JjZUNzcywgc2tpcFRydW1ib3d5Zykge1xyXG4gICAgICAgICAgICB2YXIgdCA9IHRoaXM7XHJcbiAgICAgICAgICAgIHNraXBUcnVtYm93eWcgPSAhIXNraXBUcnVtYm93eWcgfHwgJyc7XHJcblxyXG4gICAgICAgICAgICBpZiAoY21kICE9PSAnZHJvcGRvd24nKSB7XHJcbiAgICAgICAgICAgICAgICB0LiRlZC5mb2N1cygpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgdC5kb2MuZXhlY0NvbW1hbmQoJ3N0eWxlV2l0aENTUycsIGZhbHNlLCBmb3JjZUNzcyB8fCBmYWxzZSk7XHJcbiAgICAgICAgICAgIH0gY2F0Y2ggKGMpIHtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgIHRbY21kICsgc2tpcFRydW1ib3d5Z10ocGFyYW0pO1xyXG4gICAgICAgICAgICB9IGNhdGNoIChjKSB7XHJcbiAgICAgICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNtZChwYXJhbSk7XHJcbiAgICAgICAgICAgICAgICB9IGNhdGNoIChlMikge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjbWQgPT09ICdpbnNlcnRIb3Jpem9udGFsUnVsZScpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW0gPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChjbWQgPT09ICdmb3JtYXRCbG9jaycgJiYgdC5pc0lFKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtID0gJzwnICsgcGFyYW0gKyAnPic7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICB0LmRvYy5leGVjQ29tbWFuZChjbWQsIGZhbHNlLCBwYXJhbSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHQuc3luY0NvZGUoKTtcclxuICAgICAgICAgICAgICAgICAgICB0LnNlbWFudGljQ29kZShmYWxzZSwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGNtZCAhPT0gJ2Ryb3Bkb3duJykge1xyXG4gICAgICAgICAgICAgICAgICAgIHQudXBkYXRlQnV0dG9uUGFuZVN0YXR1cygpO1xyXG4gICAgICAgICAgICAgICAgICAgIHQuJGMudHJpZ2dlcigndGJ3Y2hhbmdlJyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LFxyXG5cclxuXHJcbiAgICAgICAgLy8gT3BlbiBhIG1vZGFsIGJveFxyXG4gICAgICAgIG9wZW5Nb2RhbDogZnVuY3Rpb24gKHRpdGxlLCBjb250ZW50KSB7XHJcbiAgICAgICAgICAgIHZhciB0ID0gdGhpcyxcclxuICAgICAgICAgICAgICAgIHByZWZpeCA9IHQuby5wcmVmaXg7XHJcblxyXG4gICAgICAgICAgICAvLyBObyBvcGVuIGEgbW9kYWwgYm94IHdoZW4gZXhpc3Qgb3RoZXIgbW9kYWwgYm94XHJcbiAgICAgICAgICAgIGlmICgkKCcuJyArIHByZWZpeCArICdtb2RhbC1ib3gnLCB0LiRib3gpLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAodC5vLmF1dG9ncm93T25FbnRlcikge1xyXG4gICAgICAgICAgICAgICAgdC5hdXRvZ3Jvd09uRW50ZXJEb250Q2xvc2UgPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0LnNhdmVSYW5nZSgpO1xyXG4gICAgICAgICAgICB0LnNob3dPdmVybGF5KCk7XHJcblxyXG4gICAgICAgICAgICAvLyBEaXNhYmxlIGFsbCBidG5QYW5lIGJ0bnNcclxuICAgICAgICAgICAgdC4kYnRuUGFuZS5hZGRDbGFzcyhwcmVmaXggKyAnZGlzYWJsZScpO1xyXG5cclxuICAgICAgICAgICAgLy8gQnVpbGQgb3V0IG9mIE1vZGFsQm94LCBpdCdzIHRoZSBtYXNrIGZvciBhbmltYXRpb25zXHJcbiAgICAgICAgICAgIHZhciAkbW9kYWwgPSAkKCc8ZGl2Lz4nLCB7XHJcbiAgICAgICAgICAgICAgICBjbGFzczogcHJlZml4ICsgJ21vZGFsICcgKyBwcmVmaXggKyAnZml4ZWQtdG9wJ1xyXG4gICAgICAgICAgICB9KS5jc3Moe1xyXG4gICAgICAgICAgICAgICAgdG9wOiB0LiRidG5QYW5lLmhlaWdodCgpXHJcbiAgICAgICAgICAgIH0pLmFwcGVuZFRvKHQuJGJveCk7XHJcblxyXG4gICAgICAgICAgICAvLyBDbGljayBvbiBvdmVybGF5IGNsb3NlIG1vZGFsIGJ5IGNhbmNlbGxpbmcgdGhlbVxyXG4gICAgICAgICAgICB0LiRvdmVybGF5Lm9uZSgnY2xpY2snLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAkbW9kYWwudHJpZ2dlcihDQU5DRUxfRVZFTlQpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIC8vIEJ1aWxkIHRoZSBmb3JtXHJcbiAgICAgICAgICAgIHZhciAkZm9ybSA9ICQoJzxmb3JtLz4nLCB7XHJcbiAgICAgICAgICAgICAgICBhY3Rpb246ICcnLFxyXG4gICAgICAgICAgICAgICAgaHRtbDogY29udGVudFxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgLm9uKCdzdWJtaXQnLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJG1vZGFsLnRyaWdnZXIoQ09ORklSTV9FVkVOVCk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIC5vbigncmVzZXQnLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJG1vZGFsLnRyaWdnZXIoQ0FOQ0VMX0VWRU5UKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgLm9uKCdzdWJtaXQgcmVzZXQnLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHQuby5hdXRvZ3Jvd09uRW50ZXIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdC5hdXRvZ3Jvd09uRW50ZXJEb250Q2xvc2UgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcblxyXG4gICAgICAgICAgICAvLyBCdWlsZCBNb2RhbEJveCBhbmQgYW5pbWF0ZSB0byBzaG93IHRoZW1cclxuICAgICAgICAgICAgdmFyICRib3ggPSAkKCc8ZGl2Lz4nLCB7XHJcbiAgICAgICAgICAgICAgICBjbGFzczogcHJlZml4ICsgJ21vZGFsLWJveCcsXHJcbiAgICAgICAgICAgICAgICBodG1sOiAkZm9ybVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgLmNzcyh7XHJcbiAgICAgICAgICAgICAgICAgICAgdG9wOiAnLScgKyB0LiRidG5QYW5lLm91dGVySGVpZ2h0KCkgKyAncHgnLFxyXG4gICAgICAgICAgICAgICAgICAgIG9wYWNpdHk6IDBcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAuYXBwZW5kVG8oJG1vZGFsKVxyXG4gICAgICAgICAgICAgICAgLmFuaW1hdGUoe1xyXG4gICAgICAgICAgICAgICAgICAgIHRvcDogMCxcclxuICAgICAgICAgICAgICAgICAgICBvcGFjaXR5OiAxXHJcbiAgICAgICAgICAgICAgICB9LCAxMDApO1xyXG5cclxuXHJcbiAgICAgICAgICAgIC8vIEFwcGVuZCB0aXRsZVxyXG4gICAgICAgICAgICAkKCc8c3Bhbi8+Jywge1xyXG4gICAgICAgICAgICAgICAgdGV4dDogdGl0bGUsXHJcbiAgICAgICAgICAgICAgICBjbGFzczogcHJlZml4ICsgJ21vZGFsLXRpdGxlJ1xyXG4gICAgICAgICAgICB9KS5wcmVwZW5kVG8oJGJveCk7XHJcblxyXG4gICAgICAgICAgICAkbW9kYWwuaGVpZ2h0KCRib3gub3V0ZXJIZWlnaHQoKSArIDEwKTtcclxuXHJcblxyXG4gICAgICAgICAgICAvLyBGb2N1cyBpbiBtb2RhbCBib3hcclxuICAgICAgICAgICAgJCgnaW5wdXQ6Zmlyc3QnLCAkYm94KS5mb2N1cygpO1xyXG5cclxuXHJcbiAgICAgICAgICAgIC8vIEFwcGVuZCBDb25maXJtIGFuZCBDYW5jZWwgYnV0dG9uc1xyXG4gICAgICAgICAgICB0LmJ1aWxkTW9kYWxCdG4oJ3N1Ym1pdCcsICRib3gpO1xyXG4gICAgICAgICAgICB0LmJ1aWxkTW9kYWxCdG4oJ3Jlc2V0JywgJGJveCk7XHJcblxyXG5cclxuICAgICAgICAgICAgJCh3aW5kb3cpLnRyaWdnZXIoJ3Njcm9sbCcpO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuICRtb2RhbDtcclxuICAgICAgICB9LFxyXG4gICAgICAgIC8vIEBwYXJhbSBuIGlzIG5hbWUgb2YgbW9kYWxcclxuICAgICAgICBidWlsZE1vZGFsQnRuOiBmdW5jdGlvbiAobiwgJG1vZGFsKSB7XHJcbiAgICAgICAgICAgIHZhciB0ID0gdGhpcyxcclxuICAgICAgICAgICAgICAgIHByZWZpeCA9IHQuby5wcmVmaXg7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gJCgnPGJ1dHRvbi8+Jywge1xyXG4gICAgICAgICAgICAgICAgY2xhc3M6IHByZWZpeCArICdtb2RhbC1idXR0b24gJyArIHByZWZpeCArICdtb2RhbC0nICsgbixcclxuICAgICAgICAgICAgICAgIHR5cGU6IG4sXHJcbiAgICAgICAgICAgICAgICB0ZXh0OiB0Lmxhbmdbbl0gfHwgblxyXG4gICAgICAgICAgICB9KS5hcHBlbmRUbygkKCdmb3JtJywgJG1vZGFsKSk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICAvLyBjbG9zZSBjdXJyZW50IG1vZGFsIGJveFxyXG4gICAgICAgIGNsb3NlTW9kYWw6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyIHQgPSB0aGlzLFxyXG4gICAgICAgICAgICAgICAgcHJlZml4ID0gdC5vLnByZWZpeDtcclxuXHJcbiAgICAgICAgICAgIHQuJGJ0blBhbmUucmVtb3ZlQ2xhc3MocHJlZml4ICsgJ2Rpc2FibGUnKTtcclxuICAgICAgICAgICAgdC4kb3ZlcmxheS5vZmYoKTtcclxuXHJcbiAgICAgICAgICAgIC8vIEZpbmQgdGhlIG1vZGFsIGJveFxyXG4gICAgICAgICAgICB2YXIgJG1vZGFsQm94ID0gJCgnLicgKyBwcmVmaXggKyAnbW9kYWwtYm94JywgdC4kYm94KTtcclxuXHJcbiAgICAgICAgICAgICRtb2RhbEJveC5hbmltYXRlKHtcclxuICAgICAgICAgICAgICAgIHRvcDogJy0nICsgJG1vZGFsQm94LmhlaWdodCgpXHJcbiAgICAgICAgICAgIH0sIDEwMCwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgJG1vZGFsQm94LnBhcmVudCgpLnJlbW92ZSgpO1xyXG4gICAgICAgICAgICAgICAgdC5oaWRlT3ZlcmxheSgpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHQucmVzdG9yZVJhbmdlKCk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICAvLyBQcmVmb3JtYXRlZCBidWlsZCBhbmQgbWFuYWdlbWVudCBtb2RhbFxyXG4gICAgICAgIG9wZW5Nb2RhbEluc2VydDogZnVuY3Rpb24gKHRpdGxlLCBmaWVsZHMsIGNtZCkge1xyXG4gICAgICAgICAgICB2YXIgdCA9IHRoaXMsXHJcbiAgICAgICAgICAgICAgICBwcmVmaXggPSB0Lm8ucHJlZml4LFxyXG4gICAgICAgICAgICAgICAgbGcgPSB0LmxhbmcsXHJcbiAgICAgICAgICAgICAgICBodG1sID0gJyc7XHJcblxyXG4gICAgICAgICAgICAkLmVhY2goZmllbGRzLCBmdW5jdGlvbiAoZmllbGROYW1lLCBmaWVsZCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGwgPSBmaWVsZC5sYWJlbCB8fCBmaWVsZE5hbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgbiA9IGZpZWxkLm5hbWUgfHwgZmllbGROYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgIGEgPSBmaWVsZC5hdHRyaWJ1dGVzIHx8IHt9O1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBhdHRyID0gT2JqZWN0LmtleXMoYSkubWFwKGZ1bmN0aW9uIChwcm9wKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHByb3AgKyAnPVwiJyArIGFbcHJvcF0gKyAnXCInO1xyXG4gICAgICAgICAgICAgICAgfSkuam9pbignICcpO1xyXG5cclxuICAgICAgICAgICAgICAgIGh0bWwgKz0gJzxsYWJlbD48aW5wdXQgdHlwZT1cIicgKyAoZmllbGQudHlwZSB8fCAndGV4dCcpICsgJ1wiIG5hbWU9XCInICsgbiArICdcIicgK1xyXG4gICAgICAgICAgICAgICAgICAgIChmaWVsZC50eXBlID09PSAnY2hlY2tib3gnICYmIGZpZWxkLnZhbHVlID8gJyBjaGVja2VkPVwiY2hlY2tlZFwiJyA6ICcgdmFsdWU9XCInICsgKGZpZWxkLnZhbHVlIHx8ICcnKS5yZXBsYWNlKC9cIi9nLCAnJnF1b3Q7JykpICtcclxuICAgICAgICAgICAgICAgICAgICAnXCInICsgYXR0ciArICc+PHNwYW4gY2xhc3M9XCInICsgcHJlZml4ICsgJ2lucHV0LWluZm9zXCI+PHNwYW4+JyArXHJcbiAgICAgICAgICAgICAgICAgICAgKGxnW2xdID8gbGdbbF0gOiBsKSArXHJcbiAgICAgICAgICAgICAgICAgICAgJzwvc3Bhbj48L3NwYW4+PC9sYWJlbD4nO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiB0Lm9wZW5Nb2RhbCh0aXRsZSwgaHRtbClcclxuICAgICAgICAgICAgICAgIC5vbihDT05GSVJNX0VWRU5ULCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyICRmb3JtID0gJCgnZm9ybScsICQodGhpcykpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWxpZCA9IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlcyA9IHt9O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAkLmVhY2goZmllbGRzLCBmdW5jdGlvbiAoZmllbGROYW1lLCBmaWVsZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbiA9IGZpZWxkLm5hbWUgfHwgZmllbGROYW1lO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyICRmaWVsZCA9ICQoJ2lucHV0W25hbWU9XCInICsgbiArICdcIl0nLCAkZm9ybSksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnB1dFR5cGUgPSAkZmllbGQuYXR0cigndHlwZScpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChpbnB1dFR5cGUudG9Mb3dlckNhc2UoKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnY2hlY2tib3gnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlc1tuXSA9ICRmaWVsZC5pcygnOmNoZWNrZWQnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ3JhZGlvJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZXNbbl0gPSAkZmllbGQuZmlsdGVyKCc6Y2hlY2tlZCcpLnZhbCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZXNbbl0gPSAkLnRyaW0oJGZpZWxkLnZhbCgpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBWYWxpZGF0ZSB2YWx1ZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZmllbGQucmVxdWlyZWQgJiYgdmFsdWVzW25dID09PSAnJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsaWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQuYWRkRXJyb3JPbk1vZGFsRmllbGQoJGZpZWxkLCB0LmxhbmcucmVxdWlyZWQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGZpZWxkLnBhdHRlcm4gJiYgIWZpZWxkLnBhdHRlcm4udGVzdCh2YWx1ZXNbbl0pKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWxpZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdC5hZGRFcnJvck9uTW9kYWxGaWVsZCgkZmllbGQsIGZpZWxkLnBhdHRlcm5FcnJvcik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbGlkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHQucmVzdG9yZVJhbmdlKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY21kKHZhbHVlcywgZmllbGRzKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdC5zeW5jQ29kZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdC4kYy50cmlnZ2VyKCd0YndjaGFuZ2UnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQuY2xvc2VNb2RhbCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5vZmYoQ09ORklSTV9FVkVOVCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgLm9uZShDQU5DRUxfRVZFTlQsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLm9mZihDT05GSVJNX0VWRU5UKTtcclxuICAgICAgICAgICAgICAgICAgICB0LmNsb3NlTW9kYWwoKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgYWRkRXJyb3JPbk1vZGFsRmllbGQ6IGZ1bmN0aW9uICgkZmllbGQsIGVycikge1xyXG4gICAgICAgICAgICB2YXIgcHJlZml4ID0gdGhpcy5vLnByZWZpeCxcclxuICAgICAgICAgICAgICAgICRsYWJlbCA9ICRmaWVsZC5wYXJlbnQoKTtcclxuXHJcbiAgICAgICAgICAgICRmaWVsZFxyXG4gICAgICAgICAgICAgICAgLm9uKCdjaGFuZ2Uga2V5dXAnLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJGxhYmVsLnJlbW92ZUNsYXNzKHByZWZpeCArICdpbnB1dC1lcnJvcicpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAkbGFiZWxcclxuICAgICAgICAgICAgICAgIC5hZGRDbGFzcyhwcmVmaXggKyAnaW5wdXQtZXJyb3InKVxyXG4gICAgICAgICAgICAgICAgLmZpbmQoJ2lucHV0K3NwYW4nKVxyXG4gICAgICAgICAgICAgICAgLmFwcGVuZChcclxuICAgICAgICAgICAgICAgICAgICAkKCc8c3Bhbi8+Jywge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjbGFzczogcHJlZml4ICsgJ21zZy1lcnJvcicsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IGVyclxyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIGdldERlZmF1bHRJbWdEYmxDbGlja0hhbmRsZXI6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyIHQgPSB0aGlzO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHZhciAkaW1nID0gJCh0aGlzKSxcclxuICAgICAgICAgICAgICAgICAgICBzcmMgPSAkaW1nLmF0dHIoJ3NyYycpLFxyXG4gICAgICAgICAgICAgICAgICAgIGJhc2U2NCA9ICcoQmFzZTY0KSc7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHNyYy5pbmRleE9mKCdkYXRhOmltYWdlJykgPT09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICBzcmMgPSBiYXNlNjQ7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIG9wdGlvbnMgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdXJsOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiAnVVJMJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHNyYyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWVcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIGFsdDoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogdC5sYW5nLmRlc2NyaXB0aW9uLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogJGltZy5hdHRyKCdhbHQnKVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHQuby5pbWFnZVdpZHRoTW9kYWxFZGl0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy53aWR0aCA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6ICRpbWcuYXR0cignd2lkdGgnKSA/ICRpbWcuYXR0cignd2lkdGgnKSA6ICcnXHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICB0Lm9wZW5Nb2RhbEluc2VydCh0LmxhbmcuaW5zZXJ0SW1hZ2UsIG9wdGlvbnMsIGZ1bmN0aW9uICh2KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHYuc3JjICE9PSBiYXNlNjQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJGltZy5hdHRyKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNyYzogdi51cmxcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICRpbWcuYXR0cih7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFsdDogdi5hbHRcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHQuby5pbWFnZVdpZHRoTW9kYWxFZGl0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXJzZUludCh2LndpZHRoKSA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRpbWcuYXR0cih7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IHYud2lkdGhcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJGltZy5yZW1vdmVBdHRyKCd3aWR0aCcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIC8vIFJhbmdlIG1hbmFnZW1lbnRcclxuICAgICAgICBzYXZlUmFuZ2U6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyIHQgPSB0aGlzLFxyXG4gICAgICAgICAgICAgICAgZG9jdW1lbnRTZWxlY3Rpb24gPSB0LmRvYy5nZXRTZWxlY3Rpb24oKTtcclxuXHJcbiAgICAgICAgICAgIHQucmFuZ2UgPSBudWxsO1xyXG5cclxuICAgICAgICAgICAgaWYgKGRvY3VtZW50U2VsZWN0aW9uLnJhbmdlQ291bnQpIHtcclxuICAgICAgICAgICAgICAgIHZhciBzYXZlZFJhbmdlID0gdC5yYW5nZSA9IGRvY3VtZW50U2VsZWN0aW9uLmdldFJhbmdlQXQoMCksXHJcbiAgICAgICAgICAgICAgICAgICAgcmFuZ2UgPSB0LmRvYy5jcmVhdGVSYW5nZSgpLFxyXG4gICAgICAgICAgICAgICAgICAgIHJhbmdlU3RhcnQ7XHJcbiAgICAgICAgICAgICAgICByYW5nZS5zZWxlY3ROb2RlQ29udGVudHModC4kZWRbMF0pO1xyXG4gICAgICAgICAgICAgICAgcmFuZ2Uuc2V0RW5kKHNhdmVkUmFuZ2Uuc3RhcnRDb250YWluZXIsIHNhdmVkUmFuZ2Uuc3RhcnRPZmZzZXQpO1xyXG4gICAgICAgICAgICAgICAgcmFuZ2VTdGFydCA9IChyYW5nZSArICcnKS5sZW5ndGg7XHJcbiAgICAgICAgICAgICAgICB0Lm1ldGFSYW5nZSA9IHtcclxuICAgICAgICAgICAgICAgICAgICBzdGFydDogcmFuZ2VTdGFydCxcclxuICAgICAgICAgICAgICAgICAgICBlbmQ6IHJhbmdlU3RhcnQgKyAoc2F2ZWRSYW5nZSArICcnKS5sZW5ndGhcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LFxyXG4gICAgICAgIHJlc3RvcmVSYW5nZTogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2YXIgdCA9IHRoaXMsXHJcbiAgICAgICAgICAgICAgICBtZXRhUmFuZ2UgPSB0Lm1ldGFSYW5nZSxcclxuICAgICAgICAgICAgICAgIHNhdmVkUmFuZ2UgPSB0LnJhbmdlLFxyXG4gICAgICAgICAgICAgICAgZG9jdW1lbnRTZWxlY3Rpb24gPSB0LmRvYy5nZXRTZWxlY3Rpb24oKSxcclxuICAgICAgICAgICAgICAgIHJhbmdlO1xyXG5cclxuICAgICAgICAgICAgaWYgKCFzYXZlZFJhbmdlKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChtZXRhUmFuZ2UgJiYgbWV0YVJhbmdlLnN0YXJ0ICE9PSBtZXRhUmFuZ2UuZW5kKSB7IC8vIEFsZ29yaXRobSBmcm9tIGh0dHA6Ly9qc2ZpZGRsZS5uZXQvV2VXeTcvMy9cclxuICAgICAgICAgICAgICAgIHZhciBjaGFySW5kZXggPSAwLFxyXG4gICAgICAgICAgICAgICAgICAgIG5vZGVTdGFjayA9IFt0LiRlZFswXV0sXHJcbiAgICAgICAgICAgICAgICAgICAgbm9kZSxcclxuICAgICAgICAgICAgICAgICAgICBmb3VuZFN0YXJ0ID0gZmFsc2UsXHJcbiAgICAgICAgICAgICAgICAgICAgc3RvcCA9IGZhbHNlO1xyXG5cclxuICAgICAgICAgICAgICAgIHJhbmdlID0gdC5kb2MuY3JlYXRlUmFuZ2UoKTtcclxuXHJcbiAgICAgICAgICAgICAgICB3aGlsZSAoIXN0b3AgJiYgKG5vZGUgPSBub2RlU3RhY2sucG9wKCkpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG5vZGUubm9kZVR5cGUgPT09IDMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG5leHRDaGFySW5kZXggPSBjaGFySW5kZXggKyBub2RlLmxlbmd0aDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFmb3VuZFN0YXJ0ICYmIG1ldGFSYW5nZS5zdGFydCA+PSBjaGFySW5kZXggJiYgbWV0YVJhbmdlLnN0YXJ0IDw9IG5leHRDaGFySW5kZXgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJhbmdlLnNldFN0YXJ0KG5vZGUsIG1ldGFSYW5nZS5zdGFydCAtIGNoYXJJbmRleCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3VuZFN0YXJ0ID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZm91bmRTdGFydCAmJiBtZXRhUmFuZ2UuZW5kID49IGNoYXJJbmRleCAmJiBtZXRhUmFuZ2UuZW5kIDw9IG5leHRDaGFySW5kZXgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJhbmdlLnNldEVuZChub2RlLCBtZXRhUmFuZ2UuZW5kIC0gY2hhckluZGV4KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0b3AgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNoYXJJbmRleCA9IG5leHRDaGFySW5kZXg7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNuID0gbm9kZS5jaGlsZE5vZGVzLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaSA9IGNuLmxlbmd0aDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlIChpID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaSAtPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbm9kZVN0YWNrLnB1c2goY25baV0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBkb2N1bWVudFNlbGVjdGlvbi5yZW1vdmVBbGxSYW5nZXMoKTtcclxuICAgICAgICAgICAgZG9jdW1lbnRTZWxlY3Rpb24uYWRkUmFuZ2UocmFuZ2UgfHwgc2F2ZWRSYW5nZSk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBnZXRSYW5nZVRleHQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMucmFuZ2UgKyAnJztcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICB1cGRhdGVCdXR0b25QYW5lU3RhdHVzOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciB0ID0gdGhpcyxcclxuICAgICAgICAgICAgICAgIHByZWZpeCA9IHQuby5wcmVmaXgsXHJcbiAgICAgICAgICAgICAgICB0YWdzID0gdC5nZXRUYWdzUmVjdXJzaXZlKHQuZG9jLmdldFNlbGVjdGlvbigpLmZvY3VzTm9kZSksXHJcbiAgICAgICAgICAgICAgICBhY3RpdmVDbGFzc2VzID0gcHJlZml4ICsgJ2FjdGl2ZS1idXR0b24gJyArIHByZWZpeCArICdhY3RpdmUnO1xyXG5cclxuICAgICAgICAgICAgJCgnLicgKyBwcmVmaXggKyAnYWN0aXZlLWJ1dHRvbicsIHQuJGJ0blBhbmUpLnJlbW92ZUNsYXNzKGFjdGl2ZUNsYXNzZXMpO1xyXG4gICAgICAgICAgICAkLmVhY2godGFncywgZnVuY3Rpb24gKGksIHRhZykge1xyXG4gICAgICAgICAgICAgICAgdmFyIGJ0bk5hbWUgPSB0LnRhZ1RvQnV0dG9uW3RhZy50b0xvd2VyQ2FzZSgpXSxcclxuICAgICAgICAgICAgICAgICAgICAkYnRuID0gJCgnLicgKyBwcmVmaXggKyBidG5OYW1lICsgJy1idXR0b24nLCB0LiRidG5QYW5lKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoJGJ0bi5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJGJ0bi5hZGRDbGFzcyhhY3RpdmVDbGFzc2VzKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJGJ0biA9ICQoJy4nICsgcHJlZml4ICsgJ2Ryb3Bkb3duIC4nICsgcHJlZml4ICsgYnRuTmFtZSArICctZHJvcGRvd24tYnV0dG9uJywgdC4kYm94KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRyb3Bkb3duQnRuTmFtZSA9ICRidG4ucGFyZW50KCkuZGF0YSgnZHJvcGRvd24nKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJCgnLicgKyBwcmVmaXggKyBkcm9wZG93bkJ0bk5hbWUgKyAnLWJ1dHRvbicsIHQuJGJveCkuYWRkQ2xhc3MoYWN0aXZlQ2xhc3Nlcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBnZXRUYWdzUmVjdXJzaXZlOiBmdW5jdGlvbiAoZWxlbWVudCwgdGFncykge1xyXG4gICAgICAgICAgICB2YXIgdCA9IHRoaXM7XHJcbiAgICAgICAgICAgIHRhZ3MgPSB0YWdzIHx8IChlbGVtZW50ICYmIGVsZW1lbnQudGFnTmFtZSA/IFtlbGVtZW50LnRhZ05hbWVdIDogW10pO1xyXG5cclxuICAgICAgICAgICAgaWYgKGVsZW1lbnQgJiYgZWxlbWVudC5wYXJlbnROb2RlKSB7XHJcbiAgICAgICAgICAgICAgICBlbGVtZW50ID0gZWxlbWVudC5wYXJlbnROb2RlO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRhZ3M7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHZhciB0YWcgPSBlbGVtZW50LnRhZ05hbWU7XHJcbiAgICAgICAgICAgIGlmICh0YWcgPT09ICdESVYnKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGFncztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAodGFnID09PSAnUCcgJiYgZWxlbWVudC5zdHlsZS50ZXh0QWxpZ24gIT09ICcnKSB7XHJcbiAgICAgICAgICAgICAgICB0YWdzLnB1c2goZWxlbWVudC5zdHlsZS50ZXh0QWxpZ24pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAkLmVhY2godC50YWdIYW5kbGVycywgZnVuY3Rpb24gKGksIHRhZ0hhbmRsZXIpIHtcclxuICAgICAgICAgICAgICAgIHRhZ3MgPSB0YWdzLmNvbmNhdCh0YWdIYW5kbGVyKGVsZW1lbnQsIHQpKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICB0YWdzLnB1c2godGFnKTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiB0LmdldFRhZ3NSZWN1cnNpdmUoZWxlbWVudCwgdGFncykuZmlsdGVyKGZ1bmN0aW9uICh0YWcpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0YWcgIT0gbnVsbDtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgLy8gUGx1Z2luc1xyXG4gICAgICAgIGluaXRQbHVnaW5zOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciB0ID0gdGhpcztcclxuICAgICAgICAgICAgdC5sb2FkZWRQbHVnaW5zID0gW107XHJcbiAgICAgICAgICAgICQuZWFjaCgkLnRydW1ib3d5Zy5wbHVnaW5zLCBmdW5jdGlvbiAobmFtZSwgcGx1Z2luKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIXBsdWdpbi5zaG91bGRJbml0IHx8IHBsdWdpbi5zaG91bGRJbml0KHQpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcGx1Z2luLmluaXQodCk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHBsdWdpbi50YWdIYW5kbGVyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHQudGFnSGFuZGxlcnMucHVzaChwbHVnaW4udGFnSGFuZGxlcik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHQubG9hZGVkUGx1Z2lucy5wdXNoKHBsdWdpbik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZGVzdHJveVBsdWdpbnM6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgJC5lYWNoKHRoaXMubG9hZGVkUGx1Z2lucywgZnVuY3Rpb24gKGksIHBsdWdpbikge1xyXG4gICAgICAgICAgICAgICAgaWYgKHBsdWdpbi5kZXN0cm95KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcGx1Z2luLmRlc3Ryb3koKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxufSkobmF2aWdhdG9yLCB3aW5kb3csIGRvY3VtZW50LCBqUXVlcnkpO1xyXG4iLCIvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICogdHJ1bWJvd3lnLmNvbG9ycy5qcyB2MS4yXG4gKiBDb2xvcnMgcGlja2VyIHBsdWdpbiBmb3IgVHJ1bWJvd3lnXG4gKiBodHRwOi8vYWxleC1kLmdpdGh1Yi5jb20vVHJ1bWJvd3lnXG4gKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICogQXV0aG9yIDogQWxleGFuZHJlIERlbW9kZSAoQWxleC1EKVxuICogICAgICAgICAgVHdpdHRlciA6IEBBbGV4YW5kcmVEZW1vZGVcbiAqICAgICAgICAgIFdlYnNpdGUgOiBhbGV4LWQuZnJcbiAqL1xuXG4oZnVuY3Rpb24gKCQpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICAkLmV4dGVuZCh0cnVlLCAkLnRydW1ib3d5Zywge1xuICAgICAgICBsYW5nczoge1xuICAgICAgICAgICAgLy8ganNoaW50IGNhbWVsY2FzZTpmYWxzZVxuICAgICAgICAgICAgY3M6IHtcbiAgICAgICAgICAgICAgICBmb3JlQ29sb3I6ICdCYXJ2YSB0ZXh0dScsXG4gICAgICAgICAgICAgICAgYmFja0NvbG9yOiAnQmFydmEgcG96YWTDrSdcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlbjoge1xuICAgICAgICAgICAgICAgIGZvcmVDb2xvcjogJ1RleHQgY29sb3InLFxuICAgICAgICAgICAgICAgIGJhY2tDb2xvcjogJ0JhY2tncm91bmQgY29sb3InXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZnI6IHtcbiAgICAgICAgICAgICAgICBmb3JlQ29sb3I6ICdDb3VsZXVyIGR1IHRleHRlJyxcbiAgICAgICAgICAgICAgICBiYWNrQ29sb3I6ICdDb3VsZXVyIGRlIGZvbmQnXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgbmw6IHtcbiAgICAgICAgICAgICAgICBmb3JlQ29sb3I6ICdUZWtzdGtsZXVyJyxcbiAgICAgICAgICAgICAgICBiYWNrQ29sb3I6ICdBY2h0ZXJncm9uZGtsZXVyJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNrOiB7XG4gICAgICAgICAgICAgICAgZm9yZUNvbG9yOiAnRmFyYmEgdGV4dHUnLFxuICAgICAgICAgICAgICAgIGJhY2tDb2xvcjogJ0ZhcmJhIHBvemFkaWEnXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgemhfY246IHtcbiAgICAgICAgICAgICAgICBmb3JlQ29sb3I6ICfmloflrZfpopzoibInLFxuICAgICAgICAgICAgICAgIGJhY2tDb2xvcjogJ+iDjOaZr+minOiJsidcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBydToge1xuICAgICAgICAgICAgICAgIGZvcmVDb2xvcjogJ9Cm0LLQtdGCINGC0LXQutGB0YLQsCcsXG4gICAgICAgICAgICAgICAgYmFja0NvbG9yOiAn0KbQstC10YIg0LLRi9C00LXQu9C10L3QuNGPINGC0LXQutGB0YLQsCdcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBqYToge1xuICAgICAgICAgICAgICAgIGZvcmVDb2xvcjogJ+aWh+Wtl+iJsicsXG4gICAgICAgICAgICAgICAgYmFja0NvbG9yOiAn6IOM5pmv6ImyJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHRyOiB7XG4gICAgICAgICAgICAgICAgZm9yZUNvbG9yOiAnWWF6xLEgcmVuZ2knLFxuICAgICAgICAgICAgICAgIGJhY2tDb2xvcjogJ0Fya2FwbGFuIHJlbmdpJ1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBqc2hpbnQgY2FtZWxjYXNlOnRydWVcblxuXG4gICAgZnVuY3Rpb24gaGV4KHgpIHtcbiAgICAgICAgcmV0dXJuICgnMCcgKyBwYXJzZUludCh4KS50b1N0cmluZygxNikpLnNsaWNlKC0yKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBjb2xvclRvSGV4KHJnYikge1xuICAgICAgICBpZiAocmdiLnNlYXJjaCgncmdiJykgPT09IC0xKSB7XG4gICAgICAgICAgICByZXR1cm4gcmdiLnJlcGxhY2UoJyMnLCAnJyk7XG4gICAgICAgIH0gZWxzZSBpZiAocmdiID09PSAncmdiYSgwLCAwLCAwLCAwKScpIHtcbiAgICAgICAgICAgIHJldHVybiAndHJhbnNwYXJlbnQnO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmdiID0gcmdiLm1hdGNoKC9ecmdiYT9cXCgoXFxkKyksXFxzKihcXGQrKSxcXHMqKFxcZCspKD86LFxccyooXFxkKykpP1xcKSQvKTtcbiAgICAgICAgICAgIHJldHVybiBoZXgocmdiWzFdKSArIGhleChyZ2JbMl0pICsgaGV4KHJnYlszXSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBjb2xvclRhZ0hhbmRsZXIoZWxlbWVudCwgdHJ1bWJvd3lnKSB7XG4gICAgICAgIHZhciB0YWdzID0gW107XG5cbiAgICAgICAgaWYgKCFlbGVtZW50LnN0eWxlKSB7XG4gICAgICAgICAgICByZXR1cm4gdGFncztcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGJhY2tncm91bmQgY29sb3JcbiAgICAgICAgaWYgKGVsZW1lbnQuc3R5bGUuYmFja2dyb3VuZENvbG9yICE9PSAnJykge1xuICAgICAgICAgICAgdmFyIGJhY2tDb2xvciA9IGNvbG9yVG9IZXgoZWxlbWVudC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IpO1xuICAgICAgICAgICAgaWYgKHRydW1ib3d5Zy5vLnBsdWdpbnMuY29sb3JzLmNvbG9yTGlzdC5pbmRleE9mKGJhY2tDb2xvcikgPj0gMCkge1xuICAgICAgICAgICAgICAgIHRhZ3MucHVzaCgnYmFja0NvbG9yJyArIGJhY2tDb2xvcik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRhZ3MucHVzaCgnYmFja0NvbG9yRnJlZScpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gdGV4dCBjb2xvclxuICAgICAgICB2YXIgZm9yZUNvbG9yO1xuICAgICAgICBpZiAoZWxlbWVudC5zdHlsZS5jb2xvciAhPT0gJycpIHtcbiAgICAgICAgICAgIGZvcmVDb2xvciA9IGNvbG9yVG9IZXgoZWxlbWVudC5zdHlsZS5jb2xvcik7XG4gICAgICAgIH0gZWxzZSBpZiAoZWxlbWVudC5oYXNBdHRyaWJ1dGUoJ2NvbG9yJykpIHtcbiAgICAgICAgICAgIGZvcmVDb2xvciA9IGNvbG9yVG9IZXgoZWxlbWVudC5nZXRBdHRyaWJ1dGUoJ2NvbG9yJykpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChmb3JlQ29sb3IpIHtcbiAgICAgICAgICAgIGlmICh0cnVtYm93eWcuby5wbHVnaW5zLmNvbG9ycy5jb2xvckxpc3QuaW5kZXhPZihmb3JlQ29sb3IpID49IDApIHtcbiAgICAgICAgICAgICAgICB0YWdzLnB1c2goJ2ZvcmVDb2xvcicgKyBmb3JlQ29sb3IpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0YWdzLnB1c2goJ2ZvcmVDb2xvckZyZWUnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0YWdzO1xuICAgIH1cblxuICAgIHZhciBkZWZhdWx0T3B0aW9ucyA9IHtcbiAgICAgICAgY29sb3JMaXN0OiBbJ2ZmZmZmZicsICcwMDAwMDAnLCAnZWVlY2UxJywgJzFmNDk3ZCcsICc0ZjgxYmQnLCAnYzA1MDRkJywgJzliYmI1OScsICc4MDY0YTInLCAnNGJhY2M2JywgJ2Y3OTY0NicsICdmZmZmMDAnLCAnZjJmMmYyJywgJzdmN2Y3ZicsICdkZGQ5YzMnLCAnYzZkOWYwJywgJ2RiZTVmMScsICdmMmRjZGInLCAnZWJmMWRkJywgJ2U1ZTBlYycsICdkYmVlZjMnLCAnZmRlYWRhJywgJ2ZmZjJjYScsICdkOGQ4ZDgnLCAnNTk1OTU5JywgJ2M0YmQ5NycsICc4ZGIzZTInLCAnYjhjY2U0JywgJ2U1YjliNycsICdkN2UzYmMnLCAnY2NjMWQ5JywgJ2I3ZGRlOCcsICdmYmQ1YjUnLCAnZmZlNjk0JywgJ2JmYmZiZicsICczZjNmM2YnLCAnOTM4OTUzJywgJzU0OGRkNCcsICc5NWIzZDcnLCAnZDk5Njk0JywgJ2MzZDY5YicsICdiMmEyYzcnLCAnYjdkZGU4JywgJ2ZhYzA4ZicsICdmMmMzMTQnLCAnYTVhNWE1JywgJzI2MjYyNicsICc0OTQ0MjknLCAnMTczNjVkJywgJzM2NjA5MicsICc5NTM3MzQnLCAnNzY5MjNjJywgJzVmNDk3YScsICc5MmNkZGMnLCAnZTM2YzA5JywgJ2MwOTEwMCcsICc3ZjdmN2YnLCAnMGMwYzBjJywgJzFkMWIxMCcsICcwZjI0M2UnLCAnMjQ0MDYxJywgJzYzMjQyMycsICc0ZjYxMjgnLCAnM2YzMTUxJywgJzMxODU5YicsICc5NzQ4MDYnLCAnN2Y2MDAwJ11cbiAgICB9O1xuXG4gICAgLy8gQWRkIGFsbCBjb2xvcnMgaW4gdHdvIGRyb3Bkb3duc1xuICAgICQuZXh0ZW5kKHRydWUsICQudHJ1bWJvd3lnLCB7XG4gICAgICAgIHBsdWdpbnM6IHtcbiAgICAgICAgICAgIGNvbG9yOiB7XG4gICAgICAgICAgICAgICAgaW5pdDogZnVuY3Rpb24gKHRydW1ib3d5Zykge1xuICAgICAgICAgICAgICAgICAgICB0cnVtYm93eWcuby5wbHVnaW5zLmNvbG9ycyA9IHRydW1ib3d5Zy5vLnBsdWdpbnMuY29sb3JzIHx8IGRlZmF1bHRPcHRpb25zO1xuICAgICAgICAgICAgICAgICAgICB2YXIgZm9yZUNvbG9yQnRuRGVmID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRyb3Bkb3duOiBidWlsZERyb3Bkb3duKCdmb3JlQ29sb3InLCB0cnVtYm93eWcpXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgYmFja0NvbG9yQnRuRGVmID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRyb3Bkb3duOiBidWlsZERyb3Bkb3duKCdiYWNrQ29sb3InLCB0cnVtYm93eWcpXG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgICAgIHRydW1ib3d5Zy5hZGRCdG5EZWYoJ2ZvcmVDb2xvcicsIGZvcmVDb2xvckJ0bkRlZik7XG4gICAgICAgICAgICAgICAgICAgIHRydW1ib3d5Zy5hZGRCdG5EZWYoJ2JhY2tDb2xvcicsIGJhY2tDb2xvckJ0bkRlZik7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB0YWdIYW5kbGVyOiBjb2xvclRhZ0hhbmRsZXJcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgZnVuY3Rpb24gYnVpbGREcm9wZG93bihmbiwgdHJ1bWJvd3lnKSB7XG4gICAgICAgIHZhciBkcm9wZG93biA9IFtdO1xuXG4gICAgICAgICQuZWFjaCh0cnVtYm93eWcuby5wbHVnaW5zLmNvbG9ycy5jb2xvckxpc3QsIGZ1bmN0aW9uIChpLCBjb2xvcikge1xuICAgICAgICAgICAgdmFyIGJ0biA9IGZuICsgY29sb3IsXG4gICAgICAgICAgICAgICAgYnRuRGVmID0ge1xuICAgICAgICAgICAgICAgICAgICBmbjogZm4sXG4gICAgICAgICAgICAgICAgICAgIGZvcmNlQ3NzOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBwYXJhbTogJyMnICsgY29sb3IsXG4gICAgICAgICAgICAgICAgICAgIHN0eWxlOiAnYmFja2dyb3VuZC1jb2xvcjogIycgKyBjb2xvciArICc7J1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB0cnVtYm93eWcuYWRkQnRuRGVmKGJ0biwgYnRuRGVmKTtcbiAgICAgICAgICAgIGRyb3Bkb3duLnB1c2goYnRuKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdmFyIHJlbW92ZUNvbG9yQnV0dG9uTmFtZSA9IGZuICsgJ1JlbW92ZScsXG4gICAgICAgICAgICByZW1vdmVDb2xvckJ0bkRlZiA9IHtcbiAgICAgICAgICAgICAgICBmbjogJ3JlbW92ZUZvcm1hdCcsXG4gICAgICAgICAgICAgICAgcGFyYW06IGZuLFxuICAgICAgICAgICAgICAgIHN0eWxlOiAnYmFja2dyb3VuZC1pbWFnZTogdXJsKGRhdGE6aW1hZ2UvcG5nO2Jhc2U2NCxpVkJPUncwS0dnb0FBQUFOU1VoRVVnQUFBQVFBQUFBRUNBWUFBQUNwOFo1K0FBQUFHMGxFUVZRSVcyTmtRQUFmRUpNUm13Qllob0dCWVF0TUJZb0FBRHppQXAwanRKVGdBQUFBQUVsRlRrU3VRbUNDKTsnXG4gICAgICAgICAgICB9O1xuICAgICAgICB0cnVtYm93eWcuYWRkQnRuRGVmKHJlbW92ZUNvbG9yQnV0dG9uTmFtZSwgcmVtb3ZlQ29sb3JCdG5EZWYpO1xuICAgICAgICBkcm9wZG93bi5wdXNoKHJlbW92ZUNvbG9yQnV0dG9uTmFtZSk7XG5cbiAgICAgICAgLy8gYWRkIGZyZWUgY29sb3IgYnRuXG4gICAgICAgIHZhciBmcmVlQ29sb3JCdXR0b25OYW1lID0gZm4gKyAnRnJlZScsXG4gICAgICAgICAgICBmcmVlQ29sb3JCdG5EZWYgPSB7XG4gICAgICAgICAgICAgICAgZm46IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgdHJ1bWJvd3lnLm9wZW5Nb2RhbEluc2VydCh0cnVtYm93eWcubGFuZ1tmbl0sXG4gICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sb3I6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6IGZuLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogJyNGRkZGRkYnXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNhbGxiYWNrXG4gICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAodmFsdWVzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ1bWJvd3lnLmV4ZWNDbWQoZm4sIHZhbHVlcy5jb2xvcik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB0ZXh0OiAnIycsXG4gICAgICAgICAgICAgICAgLy8gc3R5bGUgYWRqdXN0IGZvciBkaXNwbGF5aW5nIHRoZSB0ZXh0XG4gICAgICAgICAgICAgICAgc3R5bGU6ICd0ZXh0LWluZGVudDogMDtsaW5lLWhlaWdodDogMjBweDtwYWRkaW5nOiAwIDVweDsnXG4gICAgICAgICAgICB9O1xuICAgICAgICB0cnVtYm93eWcuYWRkQnRuRGVmKGZyZWVDb2xvckJ1dHRvbk5hbWUsIGZyZWVDb2xvckJ0bkRlZik7XG4gICAgICAgIGRyb3Bkb3duLnB1c2goZnJlZUNvbG9yQnV0dG9uTmFtZSk7XG5cbiAgICAgICAgcmV0dXJuIGRyb3Bkb3duO1xuICAgIH1cbn0pKGpRdWVyeSk7XG4iLCIvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICogdHJ1bWJvd3lnLmJhc2U2NC5qcyB2MS4wXG4gKiBCYXNlNjQgcGx1Z2luIGZvciBUcnVtYm93eWdcbiAqIGh0dHA6Ly9hbGV4LWQuZ2l0aHViLmNvbS9UcnVtYm93eWdcbiAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gKiBBdXRob3IgOiBDeXJpbCBCaWVuY291cnQgKGxpemFyZEspXG4gKi9cblxuKGZ1bmN0aW9uICgkKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgdmFyIGlzU3VwcG9ydGVkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdHlwZW9mIEZpbGVSZWFkZXIgIT09ICd1bmRlZmluZWQnO1xuICAgIH07XG5cbiAgICB2YXIgaXNWYWxpZEltYWdlID0gZnVuY3Rpb24gKHR5cGUpIHtcbiAgICAgICAgcmV0dXJuIC9eZGF0YTppbWFnZVxcL1thLXpdPy9pLnRlc3QodHlwZSk7XG4gICAgfTtcblxuICAgICQuZXh0ZW5kKHRydWUsICQudHJ1bWJvd3lnLCB7XG4gICAgICAgIGxhbmdzOiB7XG4gICAgICAgICAgICAvLyBqc2hpbnQgY2FtZWxjYXNlOmZhbHNlXG4gICAgICAgICAgICBlbjoge1xuICAgICAgICAgICAgICAgIGJhc2U2NDogJ0ltYWdlIGFzIGJhc2U2NCcsXG4gICAgICAgICAgICAgICAgZmlsZTogJ0ZpbGUnLFxuICAgICAgICAgICAgICAgIGVyckZpbGVSZWFkZXJOb3RTdXBwb3J0ZWQ6ICdGaWxlUmVhZGVyIGlzIG5vdCBzdXBwb3J0ZWQgYnkgeW91ciBicm93c2VyLicsXG4gICAgICAgICAgICAgICAgZXJySW52YWxpZEltYWdlOiAnSW52YWxpZCBpbWFnZSBmaWxlLidcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBmcjoge1xuICAgICAgICAgICAgICAgIGJhc2U2NDogJ0ltYWdlIGVuIGJhc2U2NCcsXG4gICAgICAgICAgICAgICAgZmlsZTogJ0ZpY2hpZXInXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY3M6IHtcbiAgICAgICAgICAgICAgICBiYXNlNjQ6ICdWbG/Fvml0IG9icsOhemVrJyxcbiAgICAgICAgICAgICAgICBmaWxlOiAnU291Ym9yJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHpoX2NuOiB7XG4gICAgICAgICAgICAgICAgYmFzZTY0OiAn5Zu+54mH77yIQmFzZTY057yW56CB77yJJyxcbiAgICAgICAgICAgICAgICBmaWxlOiAn5paH5Lu2J1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG5sOiB7XG4gICAgICAgICAgICAgICAgYmFzZTY0OiAnQWZiZWVsZGluZyBpbmxpbmUnLFxuICAgICAgICAgICAgICAgIGZpbGU6ICdCZXN0YW5kJyxcbiAgICAgICAgICAgICAgICBlcnJGaWxlUmVhZGVyTm90U3VwcG9ydGVkOiAnVXcgYnJvd3NlciBvbmRlcnN0ZXVudCBkZXplIGZ1bmN0aW9uYWxpdGVpdCBuaWV0LicsXG4gICAgICAgICAgICAgICAgZXJySW52YWxpZEltYWdlOiAnRGUgZ2Vrb3plbiBhZmJlZWxkaW5nIGlzIG9uZ2VsZGlnLidcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBydToge1xuICAgICAgICAgICAgICAgIGJhc2U2NDogJ9CY0LfQvtCx0YDQsNC20LXQvdC40LUg0LrQsNC6INC60L7QtCDQsiBiYXNlNjQnLFxuICAgICAgICAgICAgICAgIGZpbGU6ICfQpNCw0LnQuycsXG4gICAgICAgICAgICAgICAgZXJyRmlsZVJlYWRlck5vdFN1cHBvcnRlZDogJ0ZpbGVSZWFkZXIg0L3QtSDQv9C+0LTQtNC10YDQttC40LLQsNC10YLRgdGPINCy0LDRiNC40Lwg0LHRgNCw0YPQt9C10YDQvtC8LicsXG4gICAgICAgICAgICAgICAgZXJySW52YWxpZEltYWdlOiAn0J3QtdC00L7Qv9GD0YHRgtC40LzRi9C5INGE0LDQudC7INC40LfQvtCx0YDQsNC20LXQvdC40Y8uJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGphOiB7XG4gICAgICAgICAgICAgICAgYmFzZTY0OiAn55S75YOPIChCYXNlNjTlvaLlvI8pJyxcbiAgICAgICAgICAgICAgICBmaWxlOiAn44OV44Kh44Kk44OrJyxcbiAgICAgICAgICAgICAgICBlcnJGaWxlUmVhZGVyTm90U3VwcG9ydGVkOiAn44GC44Gq44Gf44Gu44OW44Op44Km44K244O844GvRmlsZVJlYWRlcuOCkuOCteODneODvOODiOOBl+OBpuOBhOOBvuOBm+OCkycsXG4gICAgICAgICAgICAgICAgZXJySW52YWxpZEltYWdlOiAn55S75YOP5b2i5byP44GM5q2j44GX44GP44GC44KK44G+44Gb44KTJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHRyOiB7XG4gICAgICAgICAgICAgICAgYmFzZTY0OiAnQmFzZTY0IG9sYXJhayByZXNpbScsXG4gICAgICAgICAgICAgICAgZmlsZTogJ0Rvc3lhJyxcbiAgICAgICAgICAgICAgICBlcnJGaWxlUmVhZGVyTm90U3VwcG9ydGVkOiAnRmlsZVJlYWRlciB0YXJhecSxY8SxbsSxeiB0YXJhZsSxbmRhbiBkZXN0ZWtsZW5taXlvci4nLFxuICAgICAgICAgICAgICAgIGVyckludmFsaWRJbWFnZTogJ0dlw6dlcnNpeiByZXNpbSBkb3N5YXPEsS4nXG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIC8vIGpzaGludCBjYW1lbGNhc2U6dHJ1ZVxuXG4gICAgICAgIHBsdWdpbnM6IHtcbiAgICAgICAgICAgIGJhc2U2NDoge1xuICAgICAgICAgICAgICAgIHNob3VsZEluaXQ6IGlzU3VwcG9ydGVkLFxuICAgICAgICAgICAgICAgIGluaXQ6IGZ1bmN0aW9uICh0cnVtYm93eWcpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGJ0bkRlZiA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzU3VwcG9ydGVkOiBpc1N1cHBvcnRlZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGZuOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ1bWJvd3lnLnNhdmVSYW5nZSgpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGZpbGU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyICRtb2RhbCA9IHRydW1ib3d5Zy5vcGVuTW9kYWxJbnNlcnQoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRpdGxlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRydW1ib3d5Zy5sYW5nLmJhc2U2NCxcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBGaWVsZHNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdmaWxlJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdHRyaWJ1dGVzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjY2VwdDogJ2ltYWdlLyonXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFsdDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiAnZGVzY3JpcHRpb24nLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0cnVtYm93eWcuZ2V0UmFuZ2VUZXh0KClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBDYWxsYmFja1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAodmFsdWVzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZlJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZSZWFkZXIub25sb2FkZW5kID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNWYWxpZEltYWdlKGUudGFyZ2V0LnJlc3VsdCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ1bWJvd3lnLmV4ZWNDbWQoJ2luc2VydEltYWdlJywgZlJlYWRlci5yZXN1bHQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKFsnaW1nW3NyYz1cIicsIGZSZWFkZXIucmVzdWx0LCAnXCJdOm5vdChbYWx0XSknXS5qb2luKCcnKSwgdHJ1bWJvd3lnLiRib3gpLmF0dHIoJ2FsdCcsIHZhbHVlcy5hbHQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnVtYm93eWcuY2xvc2VNb2RhbCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRydW1ib3d5Zy5hZGRFcnJvck9uTW9kYWxGaWVsZChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJ2lucHV0W3R5cGU9ZmlsZV0nLCAkbW9kYWwpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ1bWJvd3lnLmxhbmcuZXJySW52YWxpZEltYWdlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZlJlYWRlci5yZWFkQXNEYXRhVVJMKGZpbGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJ2lucHV0W3R5cGU9ZmlsZV0nKS5vbignY2hhbmdlJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZSA9IGUudGFyZ2V0LmZpbGVzWzBdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgICAgIHRydW1ib3d5Zy5hZGRCdG5EZWYoJ2Jhc2U2NCcsIGJ0bkRlZik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSk7XG59KShqUXVlcnkpO1xuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAqIHRydW1ib3d5Zy5ub2VtYmVkLmpzIHYxLjBcbiAqIG5vRW1iZWQgcGx1Z2luIGZvciBUcnVtYm93eWdcbiAqIGh0dHA6Ly9hbGV4LWQuZ2l0aHViLmNvbS9UcnVtYm93eWdcbiAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gKiBBdXRob3IgOiBKYWtlIEpvaG5zIChqYWtlam9obnMpXG4gKi9cblxuKGZ1bmN0aW9uICgkKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgdmFyIGRlZmF1bHRPcHRpb25zID0ge1xuICAgICAgICBwcm94eTogJ2h0dHBzOi8vbm9lbWJlZC5jb20vZW1iZWQ/bm93cmFwPW9uJyxcbiAgICAgICAgdXJsRmlsZWQ6ICd1cmwnLFxuICAgICAgICBkYXRhOiBbXSxcbiAgICAgICAgc3VjY2VzczogdW5kZWZpbmVkLFxuICAgICAgICBlcnJvcjogdW5kZWZpbmVkXG4gICAgfTtcblxuICAgICQuZXh0ZW5kKHRydWUsICQudHJ1bWJvd3lnLCB7XG4gICAgICAgIGxhbmdzOiB7XG4gICAgICAgICAgICBlbjoge1xuICAgICAgICAgICAgICAgIG5vZW1iZWQ6ICdOb2VtYmVkJyxcbiAgICAgICAgICAgICAgICBub2VtYmVkRXJyb3I6ICdFcnJvcidcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzazoge1xuICAgICAgICAgICAgICAgIG5vZW1iZWRFcnJvcjogJ0NoeWJhJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGZyOiB7XG4gICAgICAgICAgICAgICAgbm9lbWJlZEVycm9yOiAnRXJyZXVyJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNzOiB7XG4gICAgICAgICAgICAgICAgbm9lbWJlZEVycm9yOiAnQ2h5YmEnXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcnU6IHtcbiAgICAgICAgICAgICAgICBub2VtYmVkRXJyb3I6ICfQntGI0LjQsdC60LAnXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgamE6IHtcbiAgICAgICAgICAgICAgICBub2VtYmVkRXJyb3I6ICfjgqjjg6njg7wnXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdHI6IHtcbiAgICAgICAgICAgICAgICBub2VtYmVkRXJyb3I6ICdIYXRhJ1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHBsdWdpbnM6IHtcbiAgICAgICAgICAgIG5vZW1iZWQ6IHtcbiAgICAgICAgICAgICAgICBpbml0OiBmdW5jdGlvbiAodHJ1bWJvd3lnKSB7XG4gICAgICAgICAgICAgICAgICAgIHRydW1ib3d5Zy5vLnBsdWdpbnMubm9lbWJlZCA9ICQuZXh0ZW5kKHRydWUsIHt9LCBkZWZhdWx0T3B0aW9ucywgdHJ1bWJvd3lnLm8ucGx1Z2lucy5ub2VtYmVkIHx8IHt9KTtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgYnRuRGVmID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgZm46IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgJG1vZGFsID0gdHJ1bWJvd3lnLm9wZW5Nb2RhbEluc2VydChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGl0bGVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ1bWJvd3lnLmxhbmcubm9lbWJlZCxcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBGaWVsZHNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICdVUkwnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ2FsbGJhY2tcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQuYWpheCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiB0cnVtYm93eWcuby5wbHVnaW5zLm5vZW1iZWQucHJveHksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ0dFVCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogZGF0YSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWNoZTogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVR5cGU6ICdqc29uJyxcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IHRydW1ib3d5Zy5vLnBsdWdpbnMubm9lbWJlZC5zdWNjZXNzIHx8IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLmh0bWwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRydW1ib3d5Zy5leGVjQ21kKCdpbnNlcnRIVE1MJywgZGF0YS5odG1sKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRydW1ib3d5Zy5jbG9zZU1vZGFsKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCAyNTApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ1bWJvd3lnLmFkZEVycm9yT25Nb2RhbEZpZWxkKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJ2lucHV0W3R5cGU9dGV4dF0nLCAkbW9kYWwpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEuZXJyb3JcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yOiB0cnVtYm93eWcuby5wbHVnaW5zLm5vZW1iZWQuZXJyb3IgfHwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnVtYm93eWcuYWRkRXJyb3JPbk1vZGFsRmllbGQoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCdpbnB1dFt0eXBlPXRleHRdJywgJG1vZGFsKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRydW1ib3d5Zy5sYW5nLm5vZW1iZWRFcnJvclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgICAgICB0cnVtYm93eWcuYWRkQnRuRGVmKCdub2VtYmVkJywgYnRuRGVmKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9KTtcbn0pKGpRdWVyeSk7XG4iXX0=
